

<!DOCTYPE html>
<!-- source: docs/source/python_api/mlflow.pyfunc.rst -->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mlflow.pyfunc</title>
  
   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="canonical" href="https://mlflow.org/docs/latest/python_api/mlflow.pyfunc.html">
  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    

    

  
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/cards.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/grids.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/mobile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/simple-cards.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="MLflow 2.17.1.dev0 documentation" href="../index.html"/>
        <link rel="up" title="Python API" href="index.html"/>
        <link rel="next" title="mlflow.pyspark.ml" href="/mlflow.pyspark.ml.html"/>
        <link rel="prev" title="mlflow.prophet" href="/mlflow.prophet.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>
<script type="text/javascript" src="../_static/jquery.js"></script>
<script type="text/javascript" src="../_static/underscore.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
<script type="text/javascript" src="../_static/languagesections.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script type="text/javascript" src="../_static/runllm.js"></script>

<body class="wy-body-for-nav" role="document">
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../index.html" class="wy-nav-top-logo"
      ><img src="../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">2.17.1.dev0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
  </form>
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../index.html" class="main-navigation-home"><img src="../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mlflow.html">mlflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.html#mlflow-tracing-apis">MLflow Tracing APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.artifacts.html">mlflow.artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.autogen.html">mlflow.autogen</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.catboost.html">mlflow.catboost</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.client.html">mlflow.client</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.config.html">mlflow.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.data.html">mlflow.data</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.deployments.html">mlflow.deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.diviner.html">mlflow.diviner</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.dspy.html">mlflow.dspy</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.entities.html">mlflow.entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.environment_variables.html">mlflow.environment_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.fastai.html">mlflow.fastai</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.gateway.html">mlflow.gateway</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.gluon.html">mlflow.gluon</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.h2o.html">mlflow.h2o</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.johnsnowlabs.html">mlflow.johnsnowlabs</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.keras.html">mlflow.keras</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.langchain.html">mlflow.langchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.lightgbm.html">mlflow.lightgbm</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.llama_index.html">mlflow.llama_index</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.metrics.html">mlflow.metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.mleap.html">mlflow.mleap</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.models.html">mlflow.models</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.onnx.html">mlflow.onnx</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.openai.html">mlflow.openai</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.paddle.html">mlflow.paddle</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.pmdarima.html">mlflow.pmdarima</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.projects.html">mlflow.projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.promptflow.html">mlflow.promptflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.prophet.html">mlflow.prophet</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mlflow.pyfunc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#inference-api">Inference API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filesystem-format">Filesystem format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mlmodel-configuration">MLModel configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#models-from-code-for-custom-models">Models From Code for Custom Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-pyfunc-models">Creating custom Pyfunc models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#workflows">Workflows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#which-workflow-is-right-for-my-use-case">Which workflow is right for my use case?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#function-based-model-vs-class-based-model">Function-based Model vs Class-based Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-based-model">Function-based Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#class-based-model">Class-based Model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.pyspark.ml.html">mlflow.pyspark.ml</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.pytorch.html">mlflow.pytorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.recipes.html">mlflow.recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.sagemaker.html">mlflow.sagemaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.sentence_transformers.html">mlflow.sentence_transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.server.html">mlflow.server</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.shap.html">mlflow.shap</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.sklearn.html">mlflow.sklearn</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.spacy.html">mlflow.spacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.spark.html">mlflow.spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.statsmodels.html">mlflow.statsmodels</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.system_metrics.html">mlflow.system_metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.tensorflow.html">mlflow.tensorflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.tracing.html">mlflow.tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.transformers.html">mlflow.transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.types.html">mlflow.types</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.utils.html">mlflow.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlflow.xgboost.html">mlflow.xgboost</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#log-levels">Log Levels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest-api.html">REST API</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="index.html">Python API</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>mlflow.pyfunc</li>
    
    
    <!-- <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/python_api/mlflow.pyfunc.rst" class="fa fa-github"> Edit on GitHub</a>
    </li> -->
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <div class="section" id="module-mlflow.pyfunc">
<span id="mlflow-pyfunc"></span><h1>mlflow.pyfunc<a class="headerlink" href="#module-mlflow.pyfunc" title="Permalink to this headline"> </a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">python_function</span></code> model flavor serves as a default model interface for MLflow Python models.
Any MLflow Python model is expected to be loadable as a <code class="docutils literal notranslate"><span class="pre">python_function</span></code> model.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc</span></code> module defines a generic <a class="reference internal" href="#pyfunc-filesystem-format"><span class="std std-ref">filesystem format</span></a> for Python models and provides utilities for saving to and loading from
this format. The format is self contained in the sense that it includes all necessary information
for anyone to load it and use it. Dependencies are either stored directly with the model or
referenced via a Conda environment.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc</span></code> module also defines utilities for creating custom <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> models
using frameworks and inference logic that may not be natively included in MLflow. See
<a class="reference internal" href="#pyfunc-create-custom"><span class="std std-ref">Models From Code for Custom Models</span></a>.</p>
<div class="section" id="inference-api">
<span id="pyfunc-inference-api"></span><h2>Inference API<a class="headerlink" href="#inference-api" title="Permalink to this headline"> </a></h2>
<p>Python function models are loaded as an instance of <a class="reference internal" href="#mlflow.pyfunc.PyFuncModel" title="mlflow.pyfunc.PyFuncModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PyFuncModel</span></code></a>, which is an MLflow wrapper around the model implementation and model
metadata (MLmodel file). You can score the model by calling the <a class="reference internal" href="#mlflow.pyfunc.PyFuncModel.predict" title="mlflow.pyfunc.PyFuncModel.predict"><code class="xref py py-func docutils literal notranslate"><span class="pre">predict()</span></code></a> method, which has the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predict</span><span class="p">(</span>
  <span class="n">model_input</span><span class="p">:</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="p">(</span><span class="n">csc_matrix</span> <span class="o">|</span> <span class="n">csr_matrix</span><span class="p">),</span>
  <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pandas</span><span class="o">.</span><span class="p">(</span><span class="n">Series</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">|</span> <span class="n">List</span> <span class="o">|</span> <span class="n">Dict</span> <span class="o">|</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
</pre></div>
</div>
<p>All PyFunc models will support <cite>pandas.DataFrame</cite> as input and PyFunc deep learning models will
also support tensor inputs in the form of Dict[str, numpy.ndarray] (named tensors) and
<cite>numpy.ndarrays</cite> (unnamed tensors).</p>
<p>Here are some examples of supported inference types, assuming we have the correct <code class="docutils literal notranslate"><span class="pre">model</span></code> object
loaded.</p>
<table class="colwidths-given wrap-table docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Input Type</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">x_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">x2</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">scipy.sparse.csc_matrix</span></code> or <code class="docutils literal notranslate"><span class="pre">scipy.sparse.csr_matrix</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>

<span class="n">x_new</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>

<span class="n">x_new</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>python <code class="docutils literal notranslate"><span class="pre">List</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_new</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>python <code class="docutils literal notranslate"><span class="pre">Dict</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_new</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">x2</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pyspark.sql.DataFrame</span></code></p></td>
<td><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>  <span class="c1"># List of tuples</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">])</span>  <span class="c1"># Specify column name</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="filesystem-format">
<span id="pyfunc-filesystem-format"></span><h2>Filesystem format<a class="headerlink" href="#filesystem-format" title="Permalink to this headline"> </a></h2>
<p>The Pyfunc format is defined as a directory structure containing all required data, code, and
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">dst</span><span class="o">-</span><span class="n">path</span><span class="o">/</span>
    <span class="o">./</span><span class="n">MLmodel</span><span class="p">:</span> <span class="n">configuration</span>
    <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">code</span> <span class="n">packaged</span> <span class="k">with</span> <span class="n">the</span> <span class="n">model</span> <span class="p">(</span><span class="n">specified</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">MLmodel</span> <span class="n">file</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">data</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">data</span> <span class="n">packaged</span> <span class="k">with</span> <span class="n">the</span> <span class="n">model</span> <span class="p">(</span><span class="n">specified</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">MLmodel</span> <span class="n">file</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">env</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">Conda</span> <span class="n">environment</span> <span class="n">definition</span> <span class="p">(</span><span class="n">specified</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">MLmodel</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
<p>The directory structure may contain additional contents that can be referenced by the <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code>
configuration.</p>
<div class="section" id="mlmodel-configuration">
<span id="pyfunc-model-config"></span><h3>MLModel configuration<a class="headerlink" href="#mlmodel-configuration" title="Permalink to this headline"> </a></h3>
<p>A Python model contains an <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file in <strong>python_function</strong> format in its root with the
following parameters:</p>
<ul>
<li><dl>
<dt>loader_module [required]:</dt><dd><p>Python module that can load the model. Expected as module identifier
e.g. <code class="docutils literal notranslate"><span class="pre">mlflow.sklearn</span></code>, it will be imported using <code class="docutils literal notranslate"><span class="pre">importlib.import_module</span></code>.
The imported module must contain a function with the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_load_pyfunc</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">string</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="n">pyfunc</span> <span class="n">model</span> <span class="n">implementation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The path argument is specified by the <code class="docutils literal notranslate"><span class="pre">data</span></code> parameter and may refer to a file or
directory. The model implementation is expected to be an object with a
<code class="docutils literal notranslate"><span class="pre">predict</span></code> method with the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predict</span><span class="p">(</span>
  <span class="n">model_input</span><span class="p">:</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
  <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="p">(</span><span class="n">csc_matrix</span> <span class="o">|</span> <span class="n">csr_matrix</span><span class="p">),</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
  <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pandas</span><span class="o">.</span><span class="p">(</span><span class="n">Series</span> <span class="o">|</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">|</span> <span class="n">List</span> <span class="o">|</span> <span class="n">Dict</span> <span class="o">|</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>code [optional]:</dt><dd><p>Relative path to a directory containing the code packaged with this model.
All files and directories inside this directory are added to the Python path
prior to importing the model loader.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>data [optional]:</dt><dd><p>Relative path to a file or directory containing model data.
The path is passed to the model loader.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>env [optional]:</dt><dd><p>Relative path to an exported Conda environment. If present this environment
should be activated prior to running the model.</p>
</dd>
</dl>
</li>
<li><p>Optionally, any additional parameters necessary for interpreting the serialized model in
<code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> format.</p></li>
</ul>
<p class="rubric">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="n">example</span><span class="o">/</span><span class="n">sklearn_iris</span><span class="o">/</span><span class="n">mlruns</span><span class="o">/</span><span class="n">run1</span><span class="o">/</span><span class="n">outputs</span><span class="o">/</span><span class="n">linear</span><span class="o">-</span><span class="n">lr</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── MLmodel
├── code
│   ├── sklearn_iris.py
│
├── data
│   └── model.pkl
└── mlflow_env.yml
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">example</span><span class="o">/</span><span class="n">sklearn_iris</span><span class="o">/</span><span class="n">mlruns</span><span class="o">/</span><span class="n">run1</span><span class="o">/</span><span class="n">outputs</span><span class="o">/</span><span class="n">linear</span><span class="o">-</span><span class="n">lr</span><span class="o">/</span><span class="n">MLmodel</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python_function</span><span class="p">:</span>
  <span class="n">code</span><span class="p">:</span> <span class="n">code</span>
  <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">pkl</span>
  <span class="n">loader_module</span><span class="p">:</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span>
  <span class="n">env</span><span class="p">:</span> <span class="n">mlflow_env</span><span class="o">.</span><span class="n">yml</span>
  <span class="n">main</span><span class="p">:</span> <span class="n">sklearn_iris</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="models-from-code-for-custom-models">
<span id="pyfunc-create-custom"></span><h2>Models From Code for Custom Models<a class="headerlink" href="#models-from-code-for-custom-models" title="Permalink to this headline"> </a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>MLflow 2.12.2 introduced the feature “models from code”, which greatly simplifies the process
of serializing and deploying custom models through the use of script serialization. It is
strongly recommended to migrate custom model implementations to this new paradigm to avoid the
limitations and complexity of serializing with cloudpickle.
You can learn more about models from code within the
<a class="reference external" href="../model/models-from-code.html">Models From Code Guide</a>.</p>
</div>
<p>The section below illustrates the process of using the legacy serializer for custom Pyfunc models.
Models from code will provide a far simpler experience for logging of your models.</p>
</div>
<div class="section" id="creating-custom-pyfunc-models">
<h2>Creating custom Pyfunc models<a class="headerlink" href="#creating-custom-pyfunc-models" title="Permalink to this headline"> </a></h2>
<p>MLflow’s persistence modules provide convenience functions for creating models with the
<code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> flavor in a variety of machine learning frameworks (scikit-learn, Keras, Pytorch, and
more); however, they do not cover every use case. For example, you may want to create an MLflow
model with the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> flavor using a framework that MLflow does not natively support.
Alternatively, you may want to build an MLflow model that executes custom logic when evaluating
queries, such as preprocessing and postprocessing routines. Therefore, <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc</span></code>
provides utilities for creating <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> models from arbitrary code and model data.</p>
<p>The <a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_model()</span></code></a> and <a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">log_model()</span></code></a> methods are designed to support multiple workflows
for creating custom <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> models that incorporate custom inference logic and artifacts
that the logic may require.</p>
<p>An <cite>artifact</cite> is a file or directory, such as a serialized model or a CSV. For example, a
serialized TensorFlow graph is an artifact. An MLflow model directory is also an artifact.</p>
<div class="section" id="workflows">
<span id="pyfunc-create-custom-workflows"></span><h3>Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline"> </a></h3>
<p><a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_model()</span></code></a> and <a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">log_model()</span></code></a> support the following workflows:</p>
<ol class="arabic">
<li><p>Programmatically defining a new MLflow model, including its attributes and artifacts.</p>
<p>Given a set of artifact URIs, <a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_model()</span></code></a> and <a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">log_model()</span></code></a> can
automatically download artifacts from their URIs and create an MLflow model directory.</p>
<p>In this case, you must define a Python class which inherits from <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a>,
defining <code class="docutils literal notranslate"><span class="pre">predict()</span></code> and, optionally, <code class="docutils literal notranslate"><span class="pre">load_context()</span></code>. An instance of this class is
specified via the <code class="docutils literal notranslate"><span class="pre">python_model</span></code> parameter; it is automatically serialized and deserialized
as a Python class, including all of its attributes.</p>
</li>
<li><p>Interpreting pre-existing data as an MLflow model.</p>
<p>If you already have a directory containing model data, <a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_model()</span></code></a> and
<a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">log_model()</span></code></a> can import the data as an MLflow model. The <code class="docutils literal notranslate"><span class="pre">data_path</span></code> parameter
specifies the local filesystem path to the directory containing model data.</p>
<p>In this case, you must provide a Python module, called a <cite>loader module</cite>. The
loader module defines a <code class="docutils literal notranslate"><span class="pre">_load_pyfunc()</span></code> method that performs the following tasks:</p>
<ul class="simple">
<li><p>Load data from the specified <code class="docutils literal notranslate"><span class="pre">data_path</span></code>. For example, this process may include
deserializing pickled Python objects or models or parsing CSV files.</p></li>
<li><p>Construct and return a pyfunc-compatible model wrapper. As in the first
use case, this wrapper must define a <code class="docutils literal notranslate"><span class="pre">predict()</span></code> method that is used to evaluate
queries. <code class="docutils literal notranslate"><span class="pre">predict()</span></code> must adhere to the <a class="reference internal" href="#pyfunc-inference-api"><span class="std std-ref">Inference API</span></a>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">loader_module</span></code> parameter specifies the name of your loader module.</p>
<p>For an example loader module implementation, refer to the <a class="reference external" href="https://github.com/mlflow/mlflow/blob/74d75109aaf2975f5026104d6125bb30f4e3f744/mlflow/sklearn.py#L200-L205">loader module
implementation in mlflow.sklearn</a>.</p>
</li>
</ol>
</div>
<div class="section" id="which-workflow-is-right-for-my-use-case">
<span id="pyfunc-create-custom-selecting-workflow"></span><h3>Which workflow is right for my use case?<a class="headerlink" href="#which-workflow-is-right-for-my-use-case" title="Permalink to this headline"> </a></h3>
<p>We consider the first workflow to be more user-friendly and generally recommend it for the
following reasons:</p>
<ul class="simple">
<li><p>It automatically resolves and collects specified model artifacts.</p></li>
<li><p>It automatically serializes and deserializes the <code class="docutils literal notranslate"><span class="pre">python_model</span></code> instance and all of
its attributes, reducing the amount of user logic that is required to load the model</p></li>
<li><p>You can create Models using logic that is defined in the <code class="docutils literal notranslate"><span class="pre">__main__</span></code> scope. This allows
custom models to be constructed in interactive environments, such as notebooks and the Python
REPL.</p></li>
</ul>
<p>You may prefer the second, lower-level workflow for the following reasons:</p>
<ul class="simple">
<li><p>Inference logic is always persisted as code, rather than a Python object. This makes logic
easier to inspect and modify later.</p></li>
<li><p>If you have already collected all of your model data in a single location, the second
workflow allows it to be saved in MLflow format directly, without enumerating constituent
artifacts.</p></li>
</ul>
</div>
</div>
<div class="section" id="function-based-model-vs-class-based-model">
<h2>Function-based Model vs Class-based Model<a class="headerlink" href="#function-based-model-vs-class-based-model" title="Permalink to this headline"> </a></h2>
<p>When creating custom PyFunc models, you can choose between two different interfaces:
a function-based model and a class-based model. In short, a function-based model is simply a
python function that does not take additional params. The class-based model, on the other hand,
is subclass of <code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> that supports several required and optional
methods. If your use case is simple and fits within a single predict function, a funcion-based
approach is recommended. If you need more power, such as custom serialization, custom data
processing, or to override additional methods, you should use the class-based implementation.</p>
<p>Before looking at code examples, it’s important to note that both methods are serialized via
<a class="reference external" href="https://github.com/cloudpipe/cloudpickle">cloudpickle</a>. cloudpickle can serialize Python
functions, lambda functions, and locally defined classes and functions inside other functions. This
makes cloudpickle especially useful for parallel and distributed computing where code objects need
to be sent over network to execute on remote workers, which is a common deployment paradigm for
MLflow.</p>
<p>That said, cloudpickle has some limitations.</p>
<ul class="simple">
<li><p><strong>Environment Dependency</strong>: cloudpickle does not capture the full execution environment, so in
MLflow we must pass <code class="docutils literal notranslate"><span class="pre">pip_requirements</span></code>, <code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code>, or an <code class="docutils literal notranslate"><span class="pre">input_example</span></code>,
the latter of which is used to infer environment dependencies. For more, refer to
<a class="reference external" href="https://mlflow.org/docs/latest/model/dependencies.html">the model dependency docs</a>.</p></li>
<li><p><strong>Object Support</strong>: cloudpickle does not serialize objects outside of the Python data model.
Some relevant examples include raw files and database connections. If your program depends on
these, be sure to log ways to reference these objects along with your model.</p></li>
</ul>
<div class="section" id="function-based-model">
<h3>Function-based Model<a class="headerlink" href="#function-based-model" title="Permalink to this headline"> </a></h3>
<p>If you’re looking to serialize a simple python function without additional dependent methods, you
can simply log a predict method via the keyword argument <code class="docutils literal notranslate"><span class="pre">python_model</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function-based model only supports a function with a single input argument. If you would like
to pass more arguments or additional inference parameters, please use the class-based model
below.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="c1"># Define a simple function to log</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model_input</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model_input</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>


<span class="c1"># Save the function as a model</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">predict</span><span class="p">,</span> <span class="n">pip_requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">])</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">active_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>

<span class="c1"># Load the model from the tracking server and perform inference</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/model&quot;</span><span class="p">)</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="class-based-model">
<h3>Class-based Model<a class="headerlink" href="#class-based-model" title="Permalink to this headline"> </a></h3>
<p>If you’re looking to serialize a more complex object, for instance a class that handles
preprocessing, complex prediction logic, or custom serialization, you should subclass the
<code class="docutils literal notranslate"><span class="pre">PythonModel</span></code> class. MLflow has tutorials on building custom PyFunc models, as shown
<a class="reference external" href="https://mlflow.org/docs/latest/traditional-ml/creating-custom-pyfunc/index.html">here</a>,
so instead of duplicating that information, in this example we’ll recreate the above functionality
to highlight the differences. Note that this PythonModel implementation is overly complex and
we would recommend using the functional-based Model instead for this simple case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="c1"># Save the function as a model</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">(),</span> <span class="n">pip_requirements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">active_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>

<span class="c1"># Load the model from the tracking server and perform inference</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;runs:/</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/model&quot;</span><span class="p">)</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction:</span>
    <span class="p">{</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)}</span><span class="s2">&quot;)</span>
</pre></div>
</div>
<p>The primary difference between the this implementation and the function-based implementation above
is that the predict method is wrapped with a class, has the <code class="docutils literal notranslate"><span class="pre">self</span></code> parameter,
and has the <code class="docutils literal notranslate"><span class="pre">params</span></code> parameter that defaults to None. Note that function-based models don’t
support additional params.</p>
<p>In summary, use the function-based Model when you have a simple function to serialize.
If you need more power, use  the class-based model.</p>
<dl class="py class">
<dt id="mlflow.pyfunc.EnvType">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">EnvType</span></code><a class="reference internal" href="../_modules/mlflow/pyfunc.html#EnvType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.EnvType" title="Permalink to this definition"> </a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt id="mlflow.pyfunc.EnvType.CONDA">
<code class="sig-name descname"><span class="pre">CONDA</span></code><em class="property"> <span class="pre">=</span> <span class="pre">'conda'</span></em><a class="headerlink" href="#mlflow.pyfunc.EnvType.CONDA" title="Permalink to this definition"> </a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="mlflow.pyfunc.EnvType.VIRTUALENV">
<code class="sig-name descname"><span class="pre">VIRTUALENV</span></code><em class="property"> <span class="pre">=</span> <span class="pre">'virtualenv'</span></em><a class="headerlink" href="#mlflow.pyfunc.EnvType.VIRTUALENV" title="Permalink to this definition"> </a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mlflow.pyfunc.PyFuncModel">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">PyFuncModel</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_meta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">mlflow.models.model.Model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_impl</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predict_fn</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'predict'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predict_stream_fn</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#PyFuncModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel" title="Permalink to this definition"> </a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>MLflow ‘python function’ model.</p>
<p>Wrapper around model implementation and metadata. This class is not meant to be constructed
directly. Instead, instances of this class are constructed and returned from
<a class="reference internal" href="#mlflow.pyfunc.load_model" title="mlflow.pyfunc.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_model()</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">model_impl</span></code> can be any Python object that implements the <a class="reference external" href="https://mlflow.org/docs/latest/python_api/mlflow.pyfunc.html#pyfunc-inference-api">Pyfunc interface</a>, and is
returned by invoking the model’s <code class="docutils literal notranslate"><span class="pre">loader_module</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">model_meta</span></code> contains model metadata loaded from the MLmodel file.</p>
<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.get_raw_model">
<code class="sig-name descname"><span class="pre">get_raw_model</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#PyFuncModel.get_raw_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.get_raw_model" title="Permalink to this definition"> </a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This function may change or be removed in a future release without warning.</p>
</div>
<p>Get the underlying raw model if the model wrapper implemented <cite>get_raw_model</cite> function.</p>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.loader_module">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">loader_module</span></code><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.loader_module" title="Permalink to this definition"> </a></dt>
<dd><p>Model’s flavor configuration</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This property may change or be removed in a future release without warning.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.metadata">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">metadata</span></code><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.metadata" title="Permalink to this definition"> </a></dt>
<dd><p>Model metadata.</p>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.model_config">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">model_config</span></code><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.model_config" title="Permalink to this definition"> </a></dt>
<dd><p>Model’s flavor configuration</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This property may change or be removed in a future release without warning.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.predict">
<code class="sig-name descname"><span class="pre">predict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">,</span> </span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span> </span><span class="pre">csc_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">csr_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">bytes</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">,</span> </span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#PyFuncModel.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.predict" title="Permalink to this definition"> </a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.predict_stream">
<code class="sig-name descname"><span class="pre">predict_stream</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">,</span> </span><span class="pre">bytes</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#PyFuncModel.predict_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.predict_stream" title="Permalink to this definition"> </a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PyFuncModel.unwrap_python_model">
<code class="sig-name descname"><span class="pre">unwrap_python_model</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#PyFuncModel.unwrap_python_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PyFuncModel.unwrap_python_model" title="Permalink to this definition"> </a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This function may change or be removed in a future release without warning.</p>
</div>
<p>Unwrap the underlying Python model object.</p>
<p>This method is useful for accessing custom model functions, while still being able to
leverage the MLflow designed workflow through the <cite>predict()</cite> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The underlying wrapped model object</p>
</dd>
</dl>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id5" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>


<span class="c1"># define a custom model</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_custom_function</span><span class="p">(</span><span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">my_custom_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_input</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># do something with the model input</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="n">some_input</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># save the model</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">())</span>

<span class="c1"># load the model</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">loaded_model</span><span class="p">))</span>  <span class="c1"># &lt;class &#39;mlflow.pyfunc.model.PyFuncModel&#39;&gt;</span>
<span class="n">unwrapped_model</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">unwrap_python_model</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">unwrapped_model</span><span class="p">))</span>  <span class="c1"># &lt;class &#39;__main__.MyModel&#39;&gt;</span>

<span class="c1"># does not work, only predict() is exposed</span>
<span class="c1"># print(loaded_model.my_custom_function(some_input))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unwrapped_model</span><span class="o">.</span><span class="n">my_custom_function</span><span class="p">(</span><span class="n">some_input</span><span class="p">))</span>  <span class="c1"># works</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">some_input</span><span class="p">))</span>  <span class="c1"># works</span>

<span class="c1"># works, but None is needed for context arg</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unwrapped_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">some_input</span><span class="p">))</span>
</pre></div>
</div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.add_to_model">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">add_to_model</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conda_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">python_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_code_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#add_to_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.add_to_model" title="Permalink to this definition"> </a></dt>
<dd><p>Add a <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> spec to the model configuration.</p>
<p>Defines <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> configuration schema. Caller can use this to create a valid <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> model
flavor out of an existing directory structure. For example, other model flavors can use this to
specify how to use their output as a <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All paths are relative to the exported model root directory.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – Existing model.</p></li>
<li><p><strong>loader_module</strong> – The module to be used to load the model.</p></li>
<li><p><strong>data</strong> – Path to the model data.</p></li>
<li><p><strong>code</strong> – Path to the code dependencies.</p></li>
<li><p><strong>conda_env</strong> – Conda environment.</p></li>
<li><p><strong>python_env</strong> – Python environment.</p></li>
<li><p><strong>model_config</strong> – <p>The model configuration to apply to the model. This configuration
is available during model loading.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
<li><p><strong>model_code_path</strong> – Path to the model code.</p></li>
<li><p><strong>kwargs</strong> – Additional key-value pairs to include in the <code class="docutils literal notranslate"><span class="pre">pyfunc</span></code> flavor specification.
Values must be YAML-serializable.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Updated model configuration.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.get_model_dependencies">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">get_model_dependencies</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pip'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#get_model_dependencies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.get_model_dependencies" title="Permalink to this definition"> </a></dt>
<dd><p>Downloads the model dependencies and returns the path to requirements.txt or conda.yaml file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This API downloads all the model artifacts to the local filesystem. This may take
a long time for large models. To avoid this overhead, use
<code class="docutils literal notranslate"><span class="pre">mlflow.artifacts.download_artifacts(&quot;&lt;model_uri&gt;/requirements.txt&quot;)</span></code> or
<code class="docutils literal notranslate"><span class="pre">mlflow.artifacts.download_artifacts(&quot;&lt;model_uri&gt;/conda.yaml&quot;)</span></code> instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_uri</strong> – The uri of the model to get dependencies from.</p></li>
<li><p><strong>format</strong> – The format of the returned dependency file. If the <code class="docutils literal notranslate"><span class="pre">&quot;pip&quot;</span></code> format is
specified, the path to a pip <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file is returned.
If the <code class="docutils literal notranslate"><span class="pre">&quot;conda&quot;</span></code> format is specified, the path to a <code class="docutils literal notranslate"><span class="pre">&quot;conda.yaml&quot;</span></code>
file is returned . If the <code class="docutils literal notranslate"><span class="pre">&quot;pip&quot;</span></code> format is specified but the model
was not saved with a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file, the <code class="docutils literal notranslate"><span class="pre">pip</span></code> section
of the model’s <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> file is extracted instead, and any
additional conda dependencies are ignored. Default value is <code class="docutils literal notranslate"><span class="pre">&quot;pip&quot;</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The local filesystem path to either a pip <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file
(if <code class="docutils literal notranslate"><span class="pre">format=&quot;pip&quot;</span></code>) or a <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> file (if <code class="docutils literal notranslate"><span class="pre">format=&quot;conda&quot;</span></code>)
specifying the model’s dependencies.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.load_model">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">load_model</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_uri</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppress_warnings</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_config</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">,</span> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#mlflow.pyfunc.PyFuncModel" title="mlflow.pyfunc.PyFuncModel"><span class="pre">mlflow.pyfunc.PyFuncModel</span></a><a class="reference internal" href="../_modules/mlflow/pyfunc.html#load_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.load_model" title="Permalink to this definition"> </a></dt>
<dd><p>Load a model stored in Python function format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_uri</strong> – <p>The location, in URI format, of the MLflow model. For example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/Users/me/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relative/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3://my_bucket/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runs:/&lt;mlflow_run_id&gt;/run-relative/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;model_version&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;stage&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mlflow-artifacts:/path/to/model</span></code></p></li>
</ul>
<p>For more information about supported URI schemes, see
<a class="reference external" href="https://www.mlflow.org/docs/latest/concepts.html#artifact-locations">Referencing Artifacts</a>.</p>
</p></li>
<li><p><strong>suppress_warnings</strong> – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, non-fatal warning messages associated with the model
loading process will be suppressed. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, these warning messages will be
emitted.</p></li>
<li><p><strong>dst_path</strong> – The local filesystem path to which to download the model artifact.
This directory must already exist. If unspecified, a local output
path will be created.</p></li>
<li><p><strong>model_config</strong> – <p>The model configuration to apply to the model. This configuration
is available during model loading. The configuration can be passed as a file path,
or a dict with string keys.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.load_pyfunc">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">load_pyfunc</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppress_warnings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#load_pyfunc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.load_pyfunc" title="Permalink to this definition"> </a></dt>
<dd><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_pyfunc</span></code> is deprecated since 1.0. This method will be removed in a future release. Use <code class="docutils literal notranslate"><span class="pre">mlflow.pyfunc.load_model</span></code> instead.</p>
</div>
<p>Load a model stored in Python function format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_uri</strong> – <p>The location, in URI format, of the MLflow model. For example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/Users/me/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relative/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3://my_bucket/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runs:/&lt;mlflow_run_id&gt;/run-relative/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;model_version&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;stage&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mlflow-artifacts:/path/to/model</span></code></p></li>
</ul>
<p>For more information about supported URI schemes, see
<a class="reference external" href="https://www.mlflow.org/docs/latest/concepts.html#artifact-locations">Referencing Artifacts</a>.</p>
</p></li>
<li><p><strong>suppress_warnings</strong> – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, non-fatal warning messages associated with the model
loading process will be suppressed. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, these warning messages will be
emitted.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.log_model">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">log_model</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">artifact_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_module</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_paths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infer_code_paths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conda_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">python_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">registered_model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signature</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">mlflow.models.signature.ModelSignature</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_example</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">,</span> </span><span class="pre">csr_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">csc_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">bytes</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">await_registration_for</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pip_requirements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_pip_requirements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example_no_conversion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">streamable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">mlflow.models.resources.Resource</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#log_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.log_model" title="Permalink to this definition"> </a></dt>
<dd><p>Log a Pyfunc model with custom inference logic and optional data dependencies as an MLflow
artifact for the current run.</p>
<p>For information about the workflows that this method supports, see <a class="reference internal" href="#pyfunc-create-custom-workflows"><span class="std std-ref">Workflows for
creating custom pyfunc models</span></a> and
<a class="reference internal" href="#pyfunc-create-custom-selecting-workflow"><span class="std std-ref">Which workflow is right for my use case?</span></a>.
You cannot specify the parameters for the second workflow: <code class="docutils literal notranslate"><span class="pre">loader_module</span></code>, <code class="docutils literal notranslate"><span class="pre">data_path</span></code>
and the parameters for the first workflow: <code class="docutils literal notranslate"><span class="pre">python_model</span></code>, <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> together.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>artifact_path</strong> – The run-relative artifact path to which to log the Python model.</p></li>
<li><p><strong>loader_module</strong> – <p>The name of the Python module that is used to load the model
from <code class="docutils literal notranslate"><span class="pre">data_path</span></code>. This module must define a method with the prototype
<code class="docutils literal notranslate"><span class="pre">_load_pyfunc(data_path)</span></code>. If not <code class="docutils literal notranslate"><span class="pre">None</span></code>, this module and its
dependencies must be included in one of the following locations:</p>
<ul>
<li><p>The MLflow library.</p></li>
<li><p>Package(s) listed in the model’s Conda environment, specified by
the <code class="docutils literal notranslate"><span class="pre">conda_env</span></code> parameter.</p></li>
<li><p>One or more of the files specified by the <code class="docutils literal notranslate"><span class="pre">code_path</span></code> parameter.</p></li>
</ul>
</p></li>
<li><p><strong>data_path</strong> – Path to a file or directory containing model data.</p></li>
<li><p><strong>code_path</strong> – <strong>Deprecated</strong> The legacy argument for defining dependent code. This argument is
replaced by <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> and will be removed in a future version of MLflow.</p></li>
<li><p><strong>code_paths</strong> – <p>A list of local filesystem paths to Python file dependencies (or directories
containing file dependencies). These files are <em>prepended</em> to the system path when the model
is loaded. Files declared as dependencies for a given model should have relative
imports declared from a common root path if multiple files are defined with import dependencies
between them to avoid import errors when loading the model.</p>
<p>You can leave <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> argument unset but set <code class="docutils literal notranslate"><span class="pre">infer_code_paths</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> to let MLflow
infer the model code paths. See <code class="docutils literal notranslate"><span class="pre">infer_code_paths</span></code> argument doc for details.</p>
<p>For a detailed explanation of <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> functionality, recommended usage patterns and
limitations, see the
<a class="reference external" href="https://mlflow.org/docs/latest/model/dependencies.html?highlight=code_paths#saving-extra-code-with-an-mlflow-model">code_paths usage guide</a>.</p>
</p></li>
<li><p><strong>infer_code_paths</strong> – <dl class="simple">
<dt>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, MLflow automatically infers model code paths. The inferred</dt><dd><p>code path files only include necessary python module files. Only python code files
under current working directory are automatically inferrable. Default value is
<code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please ensure that the custom python module code does not contain sensitive data such as
credential token strings, otherwise they might be included in the automatic inferred code
path files and be logged to MLflow artifact repository.</p>
<p>If your custom python module depends on non-python files (e.g. a JSON file) with a relative
path to the module code file path, the non-python files can’t be automatically inferred as the
code path file. To address this issue, you should put all used non-python files outside
your custom code directory.</p>
<p>If a python code file is loaded as the python <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, then this code file can’t be
inferred as the code path file. If your model depends on classes / functions defined in
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, you should use <cite>cloudpickle</cite> to dump your model instance in order to pickle
classes / functions in <code class="docutils literal notranslate"><span class="pre">__main__</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future release without warning.</p>
</div>
</p></li>
<li><p><strong>conda_env</strong> – <p>Either a dictionary representation of a Conda environment or the path to a conda
environment yaml file. If provided, this describes the environment this model should be run in.
At a minimum, it should specify the dependencies contained in <a class="reference internal" href="#mlflow.pyfunc.get_default_conda_env" title="mlflow.pyfunc.get_default_conda_env"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_conda_env()</span></code></a>.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, a conda environment with pip requirements inferred by
<a class="reference internal" href="mlflow.models.html#mlflow.models.infer_pip_requirements" title="mlflow.models.infer_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.infer_pip_requirements()</span></code></a> is added
to the model. If the requirement inference fails, it falls back to using
<a class="reference internal" href="#mlflow.pyfunc.get_default_pip_requirements" title="mlflow.pyfunc.get_default_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_pip_requirements()</span></code></a>. pip requirements from <code class="docutils literal notranslate"><span class="pre">conda_env</span></code> are written to a pip
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file and the full conda environment is written to <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>.
The following is an <em>example</em> dictionary representation of a conda environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;mlflow-env&quot;</span><span class="p">,</span>
    <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conda-forge&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;python=3.8.15&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;scikit-learn==x.y.z&quot;</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>python_model</strong> – <p>An instance of a subclass of <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> or a callable object with a single
argument (see the examples below). The passed-in object is serialized using the
CloudPickle library. The python_model can also be a file path to the PythonModel
which defines the model from code artifact rather than serializing the model object.
Any dependencies of the class should be included in one of the
following locations:</p>
<ul>
<li><p>The MLflow library.</p></li>
<li><p>Package(s) listed in the model’s Conda environment, specified by the <code class="docutils literal notranslate"><span class="pre">conda_env</span></code>
parameter.</p></li>
<li><p>One or more of the files specified by the <code class="docutils literal notranslate"><span class="pre">code_path</span></code> parameter.</p></li>
</ul>
<p>Note: If the class is imported from another module, as opposed to being defined in the
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> scope, the defining module should also be included in one of the listed
locations.</p>
<p><strong>Examples</strong></p>
<p>Class model</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">(),</span>
    <span class="p">)</span>


<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]))</span>  <span class="c1"># -&gt; [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span>
</pre></div>
</div>
<p>Functional model</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: Functional model support is experimental and may change or be removed
in a future release without warning.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">predict</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
    <span class="p">)</span>


<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]))</span>  <span class="c1"># -&gt; [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span>
</pre></div>
</div>
<p>Model from code</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: Model from code model support is experimental and may change or
be removed in a future release without warning.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># code.py</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="n">mlflow</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">MyModel</span><span class="p">())</span>

<span class="c1"># log_model.py</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="s2">&quot;code.py&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>If the <cite>predict</cite> method or function has type annotations, MLflow automatically
constructs a model signature based on the type annotations (unless the <code class="docutils literal notranslate"><span class="pre">signature</span></code>
argument is explicitly specified), and converts the input value to the specified type
before passing it to the function. Currently, the following type annotations are
supported:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">List[str]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List[Dict[str,</span> <span class="pre">str]]</span></code></p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>artifacts</strong> – <p>A dictionary containing <code class="docutils literal notranslate"><span class="pre">&lt;name,</span> <span class="pre">artifact_uri&gt;</span></code> entries. Remote artifact URIs
are resolved to absolute filesystem paths, producing a dictionary of
<code class="docutils literal notranslate"><span class="pre">&lt;name,</span> <span class="pre">absolute_path&gt;</span></code> entries. <code class="docutils literal notranslate"><span class="pre">python_model</span></code> can reference these
resolved entries as the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> property of the <code class="docutils literal notranslate"><span class="pre">context</span></code> parameter
in <a class="reference internal" href="#mlflow.pyfunc.PythonModel.load_context" title="mlflow.pyfunc.PythonModel.load_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">PythonModel.load_context()</span></code></a>
and <a class="reference internal" href="#mlflow.pyfunc.PythonModel.predict" title="mlflow.pyfunc.PythonModel.predict"><code class="xref py py-func docutils literal notranslate"><span class="pre">PythonModel.predict()</span></code></a>.
For example, consider the following <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;my_file&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://my-bucket/path/to/my/file&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">&quot;my_file&quot;</span></code> artifact is downloaded from S3. The
<code class="docutils literal notranslate"><span class="pre">python_model</span></code> can then refer to <code class="docutils literal notranslate"><span class="pre">&quot;my_file&quot;</span></code> as an absolute filesystem
path via <code class="docutils literal notranslate"><span class="pre">context.artifacts[&quot;my_file&quot;]</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no artifacts are added to the model.</p>
</p></li>
<li><p><strong>registered_model_name</strong> – This argument may change or be removed in a
future release without warning. If given, create a model
version under <code class="docutils literal notranslate"><span class="pre">registered_model_name</span></code>, also creating a
registered model if one with the given name does not exist.</p></li>
<li><p><strong>signature</strong> – <p><a class="reference internal" href="mlflow.models.html#mlflow.models.ModelSignature" title="mlflow.models.ModelSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelSignature</span></code></a>
describes model input and output <a class="reference internal" href="mlflow.types.html#mlflow.types.Schema" title="mlflow.types.Schema"><code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code></a>.
The model signature can be <a class="reference internal" href="mlflow.models.html#mlflow.models.infer_signature" title="mlflow.models.infer_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inferred</span></code></a>
from datasets with valid model input (e.g. the training dataset with target
column omitted) and valid model output (e.g. model predictions generated on
the training dataset), for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_column</span><span class="p">(</span><span class="s2">&quot;target_label&quot;</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># compute model predictions</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
</p></li>
<li><p><strong>input_example</strong> – one or several instances of valid model input. The input example is used
as a hint of what data to feed the model. It will be converted to a Pandas
DataFrame and then serialized to json using the Pandas split-oriented
format, or a numpy array where the example will be serialized to json
by converting it to a list. Bytes are base64-encoded. When the <code class="docutils literal notranslate"><span class="pre">signature</span></code> parameter is
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the input example is used to infer a model signature.</p></li>
<li><p><strong>await_registration_for</strong> – Number of seconds to wait for the model version to finish
being created and is in <code class="docutils literal notranslate"><span class="pre">READY</span></code> status. By default, the function
waits for five minutes. Specify 0 or None to skip waiting.</p></li>
<li><p><strong>pip_requirements</strong> – Either an iterable of pip requirement strings
(e.g. <code class="docutils literal notranslate"><span class="pre">[&quot;scikit-learn&quot;,</span> <span class="pre">&quot;-r</span> <span class="pre">requirements.txt&quot;,</span> <span class="pre">&quot;-c</span> <span class="pre">constraints.txt&quot;]</span></code>) or the string path to
a pip requirements file on the local filesystem (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;requirements.txt&quot;</span></code>). If provided, this
describes the environment this model should be run in. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, a default list of requirements
is inferred by <a class="reference internal" href="mlflow.models.html#mlflow.models.infer_pip_requirements" title="mlflow.models.infer_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.infer_pip_requirements()</span></code></a> from the current software environment.
If the requirement inference fails, it falls back to using <a class="reference internal" href="#mlflow.pyfunc.get_default_pip_requirements" title="mlflow.pyfunc.get_default_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_pip_requirements()</span></code></a>.
Both requirements and constraints are automatically parsed and written to <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and
<code class="docutils literal notranslate"><span class="pre">constraints.txt</span></code> files, respectively, and stored as part of the model. Requirements are also
written to the <code class="docutils literal notranslate"><span class="pre">pip</span></code> section of the model’s conda environment (<code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>) file.</p></li>
<li><p><strong>extra_pip_requirements</strong> – <p>Either an iterable of pip
requirement strings
(e.g. <code class="docutils literal notranslate"><span class="pre">[&quot;pandas&quot;,</span> <span class="pre">&quot;-r</span> <span class="pre">requirements.txt&quot;,</span> <span class="pre">&quot;-c</span> <span class="pre">constraints.txt&quot;]</span></code>) or the string path to
a pip requirements file on the local filesystem (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;requirements.txt&quot;</span></code>). If provided, this
describes additional pip requirements that are appended to a default set of pip requirements
generated automatically based on the user’s current software environment. Both requirements and
constraints are automatically parsed and written to <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">constraints.txt</span></code>
files, respectively, and stored as part of the model. Requirements are also written to the <code class="docutils literal notranslate"><span class="pre">pip</span></code>
section of the model’s conda environment (<code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>) file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The following arguments can’t be specified at the same time:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">conda_env</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip_requirements</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code></p></li>
</ul>
</div>
<p><a class="reference external" href="https://github.com/mlflow/mlflow/blob/master/examples/pip_requirements/pip_requirements.py">This example</a> demonstrates how to specify pip requirements using
<code class="docutils literal notranslate"><span class="pre">pip_requirements</span></code> and <code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code>.</p>
</p></li>
<li><p><strong>metadata</strong> – Custom metadata dictionary passed to the model and stored in the MLmodel file.</p></li>
<li><p><strong>model_config</strong> – <p>The model configuration to apply to the model. This configuration
is available during model loading.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
<li><p><strong>example_no_conversion</strong> – This parameter is deprecated and will be removed in a future release.
It’s no longer used and can be safely removed. Input examples are not converted anymore.</p></li>
<li><p><strong>streamable</strong> – A boolean value indicating if the model supports streaming prediction,
If None, MLflow will try to inspect if the model supports streaming
by checking if <cite>predict_stream</cite> method exists. Default None.</p></li>
<li><p><strong>resources</strong> – <dl class="simple">
<dt>A list of model resources or a resources.yaml file containing a list of</dt><dd><p>resources required to serve the model.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="mlflow.models.html#mlflow.models.model.ModelInfo" title="mlflow.models.model.ModelInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelInfo</span></code></a> instance that contains the
metadata of the logged model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.save_model">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">save_model</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_module</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_paths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infer_code_paths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conda_env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mlflow_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">python_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">artifacts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signature</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">mlflow.models.signature.ModelSignature</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_example</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">,</span> </span><span class="pre">csr_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">csc_matrix</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">bytes</span><span class="p"><span class="pre">,</span> </span><span class="pre">tuple</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pip_requirements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_pip_requirements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example_no_conversion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">streamable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">mlflow.models.resources.Resource</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#save_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.save_model" title="Permalink to this definition"> </a></dt>
<dd><p>Save a Pyfunc model with custom inference logic and optional data dependencies to a path on the
local filesystem.</p>
<p>For information about the workflows that this method supports, please see <a class="reference internal" href="#pyfunc-create-custom-workflows"><span class="std std-ref">“workflows for
creating custom pyfunc models”</span></a> and
<a class="reference internal" href="#pyfunc-create-custom-selecting-workflow"><span class="std std-ref">“which workflow is right for my use case?”</span></a>.
Note that the parameters for the second workflow: <code class="docutils literal notranslate"><span class="pre">loader_module</span></code>, <code class="docutils literal notranslate"><span class="pre">data_path</span></code> and the
parameters for the first workflow: <code class="docutils literal notranslate"><span class="pre">python_model</span></code>, <code class="docutils literal notranslate"><span class="pre">artifacts</span></code>, cannot be
specified together.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – The path to which to save the Python model.</p></li>
<li><p><strong>loader_module</strong> – <p>The name of the Python module that is used to load the model
from <code class="docutils literal notranslate"><span class="pre">data_path</span></code>. This module must define a method with the prototype
<code class="docutils literal notranslate"><span class="pre">_load_pyfunc(data_path)</span></code>. If not <code class="docutils literal notranslate"><span class="pre">None</span></code>, this module and its
dependencies must be included in one of the following locations:</p>
<ul>
<li><p>The MLflow library.</p></li>
<li><p>Package(s) listed in the model’s Conda environment, specified by
the <code class="docutils literal notranslate"><span class="pre">conda_env</span></code> parameter.</p></li>
<li><p>One or more of the files specified by the <code class="docutils literal notranslate"><span class="pre">code_path</span></code> parameter.</p></li>
</ul>
</p></li>
<li><p><strong>data_path</strong> – Path to a file or directory containing model data.</p></li>
<li><p><strong>code_path</strong> – <strong>Deprecated</strong> The legacy argument for defining dependent code. This argument is
replaced by <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> and will be removed in a future version of MLflow.</p></li>
<li><p><strong>code_paths</strong> – <p>A list of local filesystem paths to Python file dependencies (or directories
containing file dependencies). These files are <em>prepended</em> to the system path when the model
is loaded. Files declared as dependencies for a given model should have relative
imports declared from a common root path if multiple files are defined with import dependencies
between them to avoid import errors when loading the model.</p>
<p>You can leave <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> argument unset but set <code class="docutils literal notranslate"><span class="pre">infer_code_paths</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> to let MLflow
infer the model code paths. See <code class="docutils literal notranslate"><span class="pre">infer_code_paths</span></code> argument doc for details.</p>
<p>For a detailed explanation of <code class="docutils literal notranslate"><span class="pre">code_paths</span></code> functionality, recommended usage patterns and
limitations, see the
<a class="reference external" href="https://mlflow.org/docs/latest/model/dependencies.html?highlight=code_paths#saving-extra-code-with-an-mlflow-model">code_paths usage guide</a>.</p>
</p></li>
<li><p><strong>infer_code_paths</strong> – <dl class="simple">
<dt>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, MLflow automatically infers model code paths. The inferred</dt><dd><p>code path files only include necessary python module files. Only python code files
under current working directory are automatically inferrable. Default value is
<code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please ensure that the custom python module code does not contain sensitive data such as
credential token strings, otherwise they might be included in the automatic inferred code
path files and be logged to MLflow artifact repository.</p>
<p>If your custom python module depends on non-python files (e.g. a JSON file) with a relative
path to the module code file path, the non-python files can’t be automatically inferred as the
code path file. To address this issue, you should put all used non-python files outside
your custom code directory.</p>
<p>If a python code file is loaded as the python <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, then this code file can’t be
inferred as the code path file. If your model depends on classes / functions defined in
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, you should use <cite>cloudpickle</cite> to dump your model instance in order to pickle
classes / functions in <code class="docutils literal notranslate"><span class="pre">__main__</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future release without warning.</p>
</div>
</p></li>
<li><p><strong>conda_env</strong> – <p>Either a dictionary representation of a Conda environment or the path to a conda
environment yaml file. If provided, this describes the environment this model should be run in.
At a minimum, it should specify the dependencies contained in <a class="reference internal" href="#mlflow.pyfunc.get_default_conda_env" title="mlflow.pyfunc.get_default_conda_env"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_conda_env()</span></code></a>.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, a conda environment with pip requirements inferred by
<a class="reference internal" href="mlflow.models.html#mlflow.models.infer_pip_requirements" title="mlflow.models.infer_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.infer_pip_requirements()</span></code></a> is added
to the model. If the requirement inference fails, it falls back to using
<a class="reference internal" href="#mlflow.pyfunc.get_default_pip_requirements" title="mlflow.pyfunc.get_default_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_pip_requirements()</span></code></a>. pip requirements from <code class="docutils literal notranslate"><span class="pre">conda_env</span></code> are written to a pip
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file and the full conda environment is written to <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>.
The following is an <em>example</em> dictionary representation of a conda environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;mlflow-env&quot;</span><span class="p">,</span>
    <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conda-forge&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;python=3.8.15&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;scikit-learn==x.y.z&quot;</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>mlflow_model</strong> – <a class="reference internal" href="mlflow.models.html#mlflow.models.Model" title="mlflow.models.Model"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mlflow.models.Model</span></code></a> configuration to which to add the
<strong>python_function</strong> flavor.</p></li>
<li><p><strong>python_model</strong> – <p>An instance of a subclass of <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> or a callable object with a single
argument (see the examples below). The passed-in object is serialized using the
CloudPickle library. The python_model can also be a file path to the PythonModel
which defines the model from code artifact rather than serializing the model object.
Any dependencies of the class should be included in one of the
following locations:</p>
<ul>
<li><p>The MLflow library.</p></li>
<li><p>Package(s) listed in the model’s Conda environment, specified by the <code class="docutils literal notranslate"><span class="pre">conda_env</span></code>
parameter.</p></li>
<li><p>One or more of the files specified by the <code class="docutils literal notranslate"><span class="pre">code_path</span></code> parameter.</p></li>
</ul>
<p>Note: If the class is imported from another module, as opposed to being defined in the
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> scope, the defining module should also be included in one of the listed
locations.</p>
<p><strong>Examples</strong></p>
<p>Class model</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">MyModel</span><span class="p">(),</span> <span class="n">input_example</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]))</span>  <span class="c1"># -&gt; [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span>
</pre></div>
</div>
<p>Functional model</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: Functional model support is experimental and may change or be removed
in a future release without warning.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">python_model</span><span class="o">=</span><span class="n">predict</span><span class="p">,</span> <span class="n">input_example</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]))</span>  <span class="c1"># -&gt; [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span>
</pre></div>
</div>
<p>Model from code</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: Model from code model support is experimental and may change or
be removed in a future release without warning.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># code.py</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">mlflow</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">PythonModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">model_input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_input</span><span class="p">]</span>


<span class="n">mlflow</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">MyModel</span><span class="p">())</span>

<span class="c1"># log_model.py</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">python_model</span><span class="o">=</span><span class="s2">&quot;code.py&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>If the <cite>predict</cite> method or function has type annotations, MLflow automatically
constructs a model signature based on the type annotations (unless the <code class="docutils literal notranslate"><span class="pre">signature</span></code>
argument is explicitly specified), and converts the input value to the specified type
before passing it to the function. Currently, the following type annotations are
supported:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">List[str]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List[Dict[str,</span> <span class="pre">str]]</span></code></p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>artifacts</strong> – <p>A dictionary containing <code class="docutils literal notranslate"><span class="pre">&lt;name,</span> <span class="pre">artifact_uri&gt;</span></code> entries. Remote artifact URIs
are resolved to absolute filesystem paths, producing a dictionary of
<code class="docutils literal notranslate"><span class="pre">&lt;name,</span> <span class="pre">absolute_path&gt;</span></code> entries. <code class="docutils literal notranslate"><span class="pre">python_model</span></code> can reference these
resolved entries as the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> property of the <code class="docutils literal notranslate"><span class="pre">context</span></code> parameter
in <a class="reference internal" href="#mlflow.pyfunc.PythonModel.load_context" title="mlflow.pyfunc.PythonModel.load_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">PythonModel.load_context()</span></code></a>
and <a class="reference internal" href="#mlflow.pyfunc.PythonModel.predict" title="mlflow.pyfunc.PythonModel.predict"><code class="xref py py-func docutils literal notranslate"><span class="pre">PythonModel.predict()</span></code></a>.
For example, consider the following <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;my_file&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://my-bucket/path/to/my/file&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">&quot;my_file&quot;</span></code> artifact is downloaded from S3. The
<code class="docutils literal notranslate"><span class="pre">python_model</span></code> can then refer to <code class="docutils literal notranslate"><span class="pre">&quot;my_file&quot;</span></code> as an absolute filesystem
path via <code class="docutils literal notranslate"><span class="pre">context.artifacts[&quot;my_file&quot;]</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no artifacts are added to the model.</p>
</p></li>
<li><p><strong>signature</strong> – <p><a class="reference internal" href="mlflow.models.html#mlflow.models.ModelSignature" title="mlflow.models.ModelSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelSignature</span></code></a>
describes model input and output <a class="reference internal" href="mlflow.types.html#mlflow.types.Schema" title="mlflow.types.Schema"><code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code></a>.
The model signature can be <a class="reference internal" href="mlflow.models.html#mlflow.models.infer_signature" title="mlflow.models.infer_signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inferred</span></code></a>
from datasets with valid model input (e.g. the training dataset with target
column omitted) and valid model output (e.g. model predictions generated on
the training dataset), for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_column</span><span class="p">(</span><span class="s2">&quot;target_label&quot;</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># compute model predictions</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
</p></li>
<li><p><strong>input_example</strong> – one or several instances of valid model input. The input example is used
as a hint of what data to feed the model. It will be converted to a Pandas
DataFrame and then serialized to json using the Pandas split-oriented
format, or a numpy array where the example will be serialized to json
by converting it to a list. Bytes are base64-encoded. When the <code class="docutils literal notranslate"><span class="pre">signature</span></code> parameter is
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the input example is used to infer a model signature.</p></li>
<li><p><strong>pip_requirements</strong> – Either an iterable of pip requirement strings
(e.g. <code class="docutils literal notranslate"><span class="pre">[&quot;scikit-learn&quot;,</span> <span class="pre">&quot;-r</span> <span class="pre">requirements.txt&quot;,</span> <span class="pre">&quot;-c</span> <span class="pre">constraints.txt&quot;]</span></code>) or the string path to
a pip requirements file on the local filesystem (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;requirements.txt&quot;</span></code>). If provided, this
describes the environment this model should be run in. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, a default list of requirements
is inferred by <a class="reference internal" href="mlflow.models.html#mlflow.models.infer_pip_requirements" title="mlflow.models.infer_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.models.infer_pip_requirements()</span></code></a> from the current software environment.
If the requirement inference fails, it falls back to using <a class="reference internal" href="#mlflow.pyfunc.get_default_pip_requirements" title="mlflow.pyfunc.get_default_pip_requirements"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_default_pip_requirements()</span></code></a>.
Both requirements and constraints are automatically parsed and written to <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and
<code class="docutils literal notranslate"><span class="pre">constraints.txt</span></code> files, respectively, and stored as part of the model. Requirements are also
written to the <code class="docutils literal notranslate"><span class="pre">pip</span></code> section of the model’s conda environment (<code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>) file.</p></li>
<li><p><strong>extra_pip_requirements</strong> – <p>Either an iterable of pip
requirement strings
(e.g. <code class="docutils literal notranslate"><span class="pre">[&quot;pandas&quot;,</span> <span class="pre">&quot;-r</span> <span class="pre">requirements.txt&quot;,</span> <span class="pre">&quot;-c</span> <span class="pre">constraints.txt&quot;]</span></code>) or the string path to
a pip requirements file on the local filesystem (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;requirements.txt&quot;</span></code>). If provided, this
describes additional pip requirements that are appended to a default set of pip requirements
generated automatically based on the user’s current software environment. Both requirements and
constraints are automatically parsed and written to <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">constraints.txt</span></code>
files, respectively, and stored as part of the model. Requirements are also written to the <code class="docutils literal notranslate"><span class="pre">pip</span></code>
section of the model’s conda environment (<code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code>) file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The following arguments can’t be specified at the same time:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">conda_env</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip_requirements</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code></p></li>
</ul>
</div>
<p><a class="reference external" href="https://github.com/mlflow/mlflow/blob/master/examples/pip_requirements/pip_requirements.py">This example</a> demonstrates how to specify pip requirements using
<code class="docutils literal notranslate"><span class="pre">pip_requirements</span></code> and <code class="docutils literal notranslate"><span class="pre">extra_pip_requirements</span></code>.</p>
</p></li>
<li><p><strong>metadata</strong> – Custom metadata dictionary passed to the model and stored in the MLmodel file.</p></li>
<li><p><strong>model_config</strong> – <p>The model configuration to apply to the model. This configuration
is available during model loading.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
<li><p><strong>example_no_conversion</strong> – This parameter is deprecated and will be removed in a future release.
It’s no longer used and can be safely removed. Input examples are not converted anymore.</p></li>
<li><p><strong>streamable</strong> – A boolean value indicating if the model supports streaming prediction,
If None, MLflow will try to inspect if the model supports streaming
by checking if <cite>predict_stream</cite> method exists. Default None.</p></li>
<li><p><strong>resources</strong> – <dl class="simple">
<dt>A list of model resources or a resources.yaml file containing a list of</dt><dd><p>resources required to serve the model.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This parameter may change or be removed in a future
release without warning.</p>
</div>
</p></li>
<li><p><strong>kwargs</strong> – Extra keyword arguments.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.spark_udf">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">spark_udf</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'local'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_env</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc.html#spark_udf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.spark_udf" title="Permalink to this definition"> </a></dt>
<dd><p>A Spark UDF that can be used to invoke the Python function formatted model.</p>
<p>Parameters passed to the UDF are forwarded to the model as a DataFrame where the column names
are ordinals (0, 1, …). On some versions of Spark (3.0 and above), it is also possible to
wrap the input in a struct. In that case, the data will be passed as a DataFrame with column
names given by the struct definition (e.g. when invoked as my_udf(struct(‘x’, ‘y’)), the model
will get the data as a pandas DataFrame with 2 columns ‘x’ and ‘y’).</p>
<p>If a model contains a signature with tensor spec inputs, you will need to pass a column of
array type as a corresponding UDF argument. The column values of which must be one dimensional
arrays. The UDF will reshape the column values to the required shape with ‘C’ order
(i.e. read / write the elements using C-like index order) and cast the values as the required
tensor spec type.</p>
<p>If a model contains a signature, the UDF can be called without specifying column name
arguments. In this case, the UDF will be called with column names from signature, so the
evaluation dataframe’s column names must match the model signature’s column names.</p>
<p>The predictions are filtered to contain only the columns that can be represented as the
<code class="docutils literal notranslate"><span class="pre">result_type</span></code>. If the <code class="docutils literal notranslate"><span class="pre">result_type</span></code> is string or array of strings, all predictions are
converted to string. If the result type is not an array type, the left most column with
matching type is returned.</p>
<p>NOTE: Inputs of type <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.DateType</span></code> are not supported on earlier versions of
Spark (2.4 and below).</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id6" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">struct</span>

<span class="n">predict</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">spark_udf</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="s2">&quot;/my/local/model&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">predict</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spark</strong> – A SparkSession object.</p></li>
<li><p><strong>model_uri</strong> – <p>The location, in URI format, of the MLflow model with the
<a class="reference internal" href="#module-mlflow.pyfunc" title="mlflow.pyfunc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mlflow.pyfunc</span></code></a> flavor. For example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/Users/me/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relative/path/to/local/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3://my_bucket/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runs:/&lt;mlflow_run_id&gt;/run-relative/path/to/model</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;model_version&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models:/&lt;model_name&gt;/&lt;stage&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mlflow-artifacts:/path/to/model</span></code></p></li>
</ul>
<p>For more information about supported URI schemes, see
<a class="reference external" href="https://www.mlflow.org/docs/latest/concepts.html#artifact-locations">Referencing Artifacts</a>.</p>
</p></li>
<li><p><strong>result_type</strong> – <p>the return type of the user-defined function. The value can be either a
<code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.DataType</span></code> object or a DDL-formatted type string. Only a primitive
type, an array <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.ArrayType</span></code> of primitive type, or a struct type
containing fields of above 2 kinds of types are allowed.
If unspecified, it tries to infer result type from model signature
output schema, if model output schema is not available, it fallbacks to use <code class="docutils literal notranslate"><span class="pre">double</span></code>
type.</p>
<p>The following classes of result type are supported:</p>
<ul>
<li><p>”int” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.IntegerType</span></code>: The leftmost integer that can fit in an
<code class="docutils literal notranslate"><span class="pre">int32</span></code> or an exception if there is none.</p></li>
<li><p>”long” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.LongType</span></code>: The leftmost long integer that can fit in an
<code class="docutils literal notranslate"><span class="pre">int64</span></code> or an exception if there is none.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayType(IntegerType|LongType)</span></code>: All integer columns that can fit into the
requested size.</p></li>
<li><p>”float” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.FloatType</span></code>: The leftmost numeric result cast to
<code class="docutils literal notranslate"><span class="pre">float32</span></code> or an exception if there is none.</p></li>
<li><p>”double” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.DoubleType</span></code>: The leftmost numeric result cast to
<code class="docutils literal notranslate"><span class="pre">double</span></code> or an exception if there is none.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayType(FloatType|DoubleType)</span></code>: All numeric columns cast to the requested type or
an exception if there are no numeric columns.</p></li>
<li><p>”string” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.StringType</span></code>: The leftmost column converted to
<code class="docutils literal notranslate"><span class="pre">string</span></code>.</p></li>
<li><p>”boolean” or “bool” or <code class="docutils literal notranslate"><span class="pre">pyspark.sql.types.BooleanType</span></code>: The leftmost column
converted to <code class="docutils literal notranslate"><span class="pre">bool</span></code> or an exception if there is none.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayType(StringType)</span></code>: All columns converted to <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p></li>
<li><p>”field1 FIELD1_TYPE, field2 FIELD2_TYPE, …”: A struct type containing multiple
fields separated by comma, each field type must be one of types listed above.</p></li>
</ul>
</p></li>
<li><p><strong>env_manager</strong> – <p>The environment manager to use in order to create the python environment
for model inference. Note that environment is only restored in the context
of the PySpark UDF; the software environment outside of the UDF is
unaffected. Default value is <code class="docutils literal notranslate"><span class="pre">local</span></code>, and the following values are
supported:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>: Use virtualenv to restore the python environment that
was used to train the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conda</span></code>: (Recommended) Use Conda to restore the software environment
that was used to train the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local</span></code>: Use the current Python environment for model inference, which
may differ from the environment used to train the model and may lead to
errors or invalid predictions.</p></li>
</ul>
</p></li>
<li><p><strong>params</strong> – Additional parameters to pass to the model for inference.</p></li>
<li><p><strong>extra_env</strong> – Extra environment variables to pass to the UDF executors.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Spark UDF that applies the model’s <code class="docutils literal notranslate"><span class="pre">predict</span></code> method to the data and returns a
type specified by <code class="docutils literal notranslate"><span class="pre">result_type</span></code>, which by default is a double.</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<dl class="py function">
<dt id="mlflow.pyfunc.get_default_pip_requirements">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">get_default_pip_requirements</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#get_default_pip_requirements"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.get_default_pip_requirements" title="Permalink to this definition"> </a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of default pip requirements for MLflow Models produced by this flavor. Calls to
<a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_model()</span></code></a> and <a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">log_model()</span></code></a> produce a pip environment that, at minimum,
contains these requirements.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="mlflow.pyfunc.get_default_conda_env">
<code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">get_default_conda_env</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#get_default_conda_env"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.get_default_conda_env" title="Permalink to this definition"> </a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The default Conda environment for MLflow Models produced by calls to
<a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_model()</span></code></a>
and <a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">log_model()</span></code></a> when a user-defined subclass of
<a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> is provided.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="mlflow.pyfunc.PythonModelContext">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">PythonModelContext</span></code><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#PythonModelContext"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PythonModelContext" title="Permalink to this definition"> </a></dt>
<dd><p>A collection of artifacts that a <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> can use when performing inference.
<a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> objects are created <em>implicitly</em> by the
<a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_model()</span></code></a> and
<a class="reference internal" href="#mlflow.pyfunc.log_model" title="mlflow.pyfunc.log_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">log_model()</span></code></a> persistence methods, using the contents specified
by the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> parameter of these methods.</p>
<dl class="py method">
<dt id="mlflow.pyfunc.PythonModelContext.artifacts">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">artifacts</span></code><a class="headerlink" href="#mlflow.pyfunc.PythonModelContext.artifacts" title="Permalink to this definition"> </a></dt>
<dd><p>A dictionary containing <code class="docutils literal notranslate"><span class="pre">&lt;name,</span> <span class="pre">artifact_path&gt;</span></code> entries, where <code class="docutils literal notranslate"><span class="pre">artifact_path</span></code> is an
absolute filesystem path to the artifact.</p>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PythonModelContext.model_config">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">model_config</span></code><a class="headerlink" href="#mlflow.pyfunc.PythonModelContext.model_config" title="Permalink to this definition"> </a></dt>
<dd><p>A dictionary containing <code class="docutils literal notranslate"><span class="pre">&lt;config,</span> <span class="pre">value&gt;</span></code> entries, where <code class="docutils literal notranslate"><span class="pre">config</span></code> is the name
of the model configuration keys and <code class="docutils literal notranslate"><span class="pre">value</span></code> is the value of the given configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This property may change or be removed in a future release without warning.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mlflow.pyfunc.PythonModel">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">PythonModel</span></code><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#PythonModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PythonModel" title="Permalink to this definition"> </a></dt>
<dd><p>Represents a generic Python model that evaluates inputs and produces API-compatible outputs.
By subclassing <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a>, users can create customized MLflow models with the
“python_function” (“pyfunc”) flavor, leveraging custom inference logic and artifact
dependencies.</p>
<dl class="py method">
<dt id="mlflow.pyfunc.PythonModel.load_context">
<code class="sig-name descname"><span class="pre">load_context</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#PythonModel.load_context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PythonModel.load_context" title="Permalink to this definition"> </a></dt>
<dd><p>Loads artifacts from the specified <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> that can be used by
<a class="reference internal" href="#mlflow.pyfunc.PythonModel.predict" title="mlflow.pyfunc.PythonModel.predict"><code class="xref py py-func docutils literal notranslate"><span class="pre">predict()</span></code></a> when evaluating inputs. When loading an MLflow model with
<a class="reference internal" href="#mlflow.pyfunc.load_model" title="mlflow.pyfunc.load_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_model()</span></code></a>, this method is called as soon as the <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> is
constructed.</p>
<p>The same <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> will also be available during calls to
<a class="reference internal" href="#mlflow.pyfunc.PythonModel.predict" title="mlflow.pyfunc.PythonModel.predict"><code class="xref py py-func docutils literal notranslate"><span class="pre">predict()</span></code></a>, but it may be more efficient to override this method
and load artifacts from the context at model load time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>context</strong> – A <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> instance containing artifacts that the model
can use to perform inference.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PythonModel.predict">
<em class="property"><span class="pre">abstract</span> </em><code class="sig-name descname"><span class="pre">predict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#PythonModel.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PythonModel.predict" title="Permalink to this definition"> </a></dt>
<dd><p>Evaluates a pyfunc-compatible input and produces a pyfunc-compatible output.
For more information about the pyfunc input/output API, see the <a class="reference internal" href="#pyfunc-inference-api"><span class="std std-ref">Inference API</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context</strong> – A <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> instance containing artifacts that the model
can use to perform inference.</p></li>
<li><p><strong>model_input</strong> – A pyfunc-compatible input for the model to evaluate.</p></li>
<li><p><strong>params</strong> – Additional parameters to pass to the model for inference.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.PythonModel.predict_stream">
<code class="sig-name descname"><span class="pre">predict_stream</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#PythonModel.predict_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.PythonModel.predict_stream" title="Permalink to this definition"> </a></dt>
<dd><p>Evaluates a pyfunc-compatible input and produces an iterator of output.
For more information about the pyfunc input API, see the <a class="reference internal" href="#pyfunc-inference-api"><span class="std std-ref">Inference API</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context</strong> – A <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> instance containing artifacts that the model
can use to perform inference.</p></li>
<li><p><strong>model_input</strong> – A pyfunc-compatible input for the model to evaluate.</p></li>
<li><p><strong>params</strong> – Additional parameters to pass to the model for inference.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="mlflow.pyfunc.ChatModel">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mlflow.pyfunc.</span></code><code class="sig-name descname"><span class="pre">ChatModel</span></code><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#ChatModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.ChatModel" title="Permalink to this definition"> </a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: This class may change or be removed in a future release without warning.</p>
</div>
<p>A subclass of <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> that makes it more convenient to implement models
that are compatible with popular LLM chat APIs. By subclassing <a class="reference internal" href="#mlflow.pyfunc.ChatModel" title="mlflow.pyfunc.ChatModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatModel</span></code></a>,
users can create MLflow models with a <code class="docutils literal notranslate"><span class="pre">predict()</span></code> method that is more convenient
for chat tasks than the generic <a class="reference internal" href="#mlflow.pyfunc.PythonModel" title="mlflow.pyfunc.PythonModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModel</span></code></a> API. ChatModels automatically
define input/output signatures and an input example, so manually specifying these values
when calling <a class="reference internal" href="#mlflow.pyfunc.save_model" title="mlflow.pyfunc.save_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mlflow.pyfunc.save_model()</span></code></a> is not necessary.</p>
<p>See the documentation of the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> method below for details on that parameters and
outputs that are expected by the <code class="docutils literal notranslate"><span class="pre">ChatModel</span></code> API.</p>
<dl class="py method">
<dt id="mlflow.pyfunc.ChatModel.predict">
<em class="property"><span class="pre">abstract</span> </em><code class="sig-name descname"><span class="pre">predict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><span class="pre">mlflow.types.llm.ChatMessage</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><span class="pre">mlflow.types.llm.ChatParams</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatResponse" title="mlflow.types.llm.ChatResponse"><span class="pre">mlflow.types.llm.ChatResponse</span></a><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#ChatModel.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.ChatModel.predict" title="Permalink to this definition"> </a></dt>
<dd><p>Evaluates a chat input and produces a chat output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context</strong> – A <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> instance containing artifacts that the model
can use to perform inference.</p></li>
<li><p><strong>messages</strong> (List[<a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code></a>]) – A list of <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code></a>
objects representing chat history.</p></li>
<li><p><strong>params</strong> (<a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatParams</span></code></a>) – A <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatParams</span></code></a> object
containing various parameters used to modify model behavior during
inference.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatResponse" title="mlflow.types.llm.ChatResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatResponse</span></code></a> object containing
the model’s response(s), as well as other metadata.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mlflow.pyfunc.ChatModel.predict_stream">
<code class="sig-name descname"><span class="pre">predict_stream</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><span class="pre">mlflow.types.llm.ChatMessage</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><span class="pre">mlflow.types.llm.ChatParams</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatResponse" title="mlflow.types.llm.ChatResponse"><span class="pre">mlflow.types.llm.ChatResponse</span></a><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../_modules/mlflow/pyfunc/model.html#ChatModel.predict_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlflow.pyfunc.ChatModel.predict_stream" title="Permalink to this definition"> </a></dt>
<dd><p>Evaluates a chat input and produces a chat output.
Overrides this function to implement a real stream prediction.
By default, this function just yields result of <cite>predict</cite> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context</strong> – A <a class="reference internal" href="#mlflow.pyfunc.PythonModelContext" title="mlflow.pyfunc.PythonModelContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonModelContext</span></code></a> instance containing artifacts that the model
can use to perform inference.</p></li>
<li><p><strong>messages</strong> (List[<a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code></a>]) – A list of <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatMessage" title="mlflow.types.llm.ChatMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code></a>
objects representing chat history.</p></li>
<li><p><strong>params</strong> (<a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatParams</span></code></a>) – A <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatParams" title="mlflow.types.llm.ChatParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatParams</span></code></a> object
containing various parameters used to modify model behavior during
inference.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An iterator over <a class="reference internal" href="mlflow.types.html#mlflow.types.llm.ChatResponse" title="mlflow.types.llm.ChatResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatResponse</span></code></a> object
containing the model’s response(s), as well as other metadata.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mlflow.prophet.html" class="btn btn-neutral" title="mlflow.prophet" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="mlflow.pyspark.ml.html" class="btn btn-neutral" title="mlflow.pyspark.ml" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../',
      VERSION:'2.17.1.dev0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      LINK_SUFFIX: '.html',
      HAS_SOURCE:  true
    };
  </script>

  

  <script type="text/javascript" src="../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../_static/clippy.svg";</script>
  <script type="text/javascript" src="../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  

  
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        // Get the code block designator class entries
        const allHighlights = document.querySelectorAll('.highlight');
        // Disable copyable links for notebook cell numbering and for cell outputs
        const highlights = Array.from(allHighlights).filter(highlight => !highlight.closest('.highlight-none') && 
            !highlight.closest('.nboutput'));
    
        highlights.forEach(function(highlight) {
            const copyIcon = document.createElement('span');
            copyIcon.classList.add('copy-icon');
            copyIcon.innerHTML = '&#xf0ea;';

            copyIcon.addEventListener('click', function() {
                const code = highlight.querySelector('pre').textContent;
                copyToClipboard(code);

                // Flash effect on click
                this.style.color = '#0194E2';
                setTimeout(() => {
                    this.style.color = ''; 
                }, 100);

                // Display "Code copied to clipboard" near the clicked icon
                const message = document.createElement('span');
                message.textContent = "Copied!";
                message.classList.add('copy-message'); 

                // Append the message to the icon
                this.appendChild(message);

                setTimeout(() => {
                    this.removeChild(message);
                }, 500);
            });

            highlight.appendChild(copyIcon);
        });
    });
  </script>


<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Force download for notebook-download-btn
        const downloadButtons = document.querySelectorAll('.notebook-download-btn');
        downloadButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default behavior

                // Fetch the raw content of the notebook from GitHub
                fetch(button.href)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.style.display = 'none';
                        link.href = url;
                        const filename = button.href.split('/').pop();
                        link.download = filename; 

                        document.body.appendChild(link);
                        link.click();

                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(link);
                    })
                    .catch(err => console.error('Error fetching the notebook:', err));
            });
        });
    });
</script> 
</body>
</html>