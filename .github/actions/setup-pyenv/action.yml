name: "setup-pyenv"
description: "Setup pyenv"
runs:
  using: "composite"
  steps:
    ########## Ubuntu ##########
    # Note: We no longer install build tools since we're using uv for Python management
    # This action now only installs the pyenv binary for MLflow compatibility
    - name: Install pyenv (binary only)
      if: runner.os == 'Linux'
      shell: bash
      run: |
        # Use the official pyenv installer which is fast (~2 seconds)
        curl -fsSL https://pyenv.run | bash
    - name: Setup environment variables
      if: runner.os == 'Linux'
      shell: bash
      run: |
        PYENV_ROOT="$HOME/.pyenv"
        PYENV_BIN="$PYENV_ROOT/bin"
        echo "$PYENV_BIN" >> $GITHUB_PATH
        echo "PYENV_ROOT=$PYENV_ROOT" >> $GITHUB_ENV
    - name: Check pyenv version
      if: runner.os == 'Linux'
      shell: bash
      run: |
        pyenv --version

    ########## Windows ##########
    # Note: Windows support for pyenv - only installing binary
    - name: Install pyenv
      if: runner.os == 'Windows'
      shell: bash
      run: |
        uv pip install pyenv-win --target $HOME\\.pyenv
    - name: Setup environment variables
      if: runner.os == 'Windows'
      shell: bash
      run: |
        echo "PYENV=$USERPROFILE\.pyenv\pyenv-win\\" >> $GITHUB_ENV
        echo "PYENV_ROOT=$USERPROFILE\.pyenv\pyenv-win\\" >> $GITHUB_ENV
        echo "PYENV_HOME=$USERPROFILE\.pyenv\pyenv-win\\" >> $GITHUB_ENV
        echo "$USERPROFILE\.pyenv\pyenv-win\\bin\\" >> $GITHUB_PATH
    - name: Check pyenv version
      if: runner.os == 'Windows'
      shell: bash
      run: |
        pyenv --version

    - name: Install virtualenv
      shell: bash
      run: |
        uv pip install virtualenv
