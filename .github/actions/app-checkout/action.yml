name: "app-checkout"
description: "Creates a GitHub App token, checks out a repository, and configures git identity as mlflow-app[bot]"
inputs:
  repository:
    description: "Repository name with owner. For example, mlflow/mlflow"
    required: false
  ref:
    description: "The branch, tag or SHA to checkout"
    required: false
  fetch-depth:
    description: "Number of commits to fetch. 0 indicates all history for all branches and tags"
    required: false
    default: "1"
runs:
  using: "composite"
  steps:
    - uses: actions/create-github-app-token@67018539274d69449ef7c02e8e71183d1719ab42 # v2.1.4
      id: app-token
      with:
        app-id: ${{ secrets.APP_ID }}
        # See https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/managing-private-keys-for-github-apps
        # for how to rotate the private key
        private-key: ${{ secrets.APP_PRIVATE_KEY }}
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      with:
        repository: ${{ inputs.repository }}
        ref: ${{ inputs.ref }}
        fetch-depth: ${{ inputs.fetch-depth }}
        token: ${{ steps.app-token.outputs.token }}
    - name: Configure git identity
      shell: bash
      run: |
        git config user.name 'mlflow-app[bot]'
        git config user.email 'mlflow-app[bot]@users.noreply.github.com'
