# Upload Test Durations - Write Path
#
# This action handles the "write" side of MLflow's test duration system.
# It moves the updated duration file and uploads it as a CI artifact.
#
# Usage:
#   - uses: ./.github/actions/upload-test-durations
#     with:
#       job_name: 'python'
#
# This expects /tmp/{job_name}_group_${{ matrix.group }}_durations.json to exist
# (created by pytest-split during test execution with --store-durations).

name: "Upload Test Durations"
description: "Move and upload test duration artifacts for future CI runs"

inputs:
  job_name:
    description: "Job name for duration files (e.g. python, pyfunc, models)"
    required: true

runs:
  using: "composite"
  steps:
    - name: Prepare duration artifact
      shell: bash
      run: |
        # Move the updated duration file to the expected location for artifact upload
        mv /tmp/${{ inputs.job_name }}_group_${{ matrix.group }}_durations.json group_${{ matrix.group }}_durations.json

    - name: Upload test duration artifact
      uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
      if: always()
      with:
        name: test-durations-${{ inputs.job_name }}-group-${{ matrix.group }}
        path: group_${{ matrix.group }}_durations.json
        retention-days: 7
