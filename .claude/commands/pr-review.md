---
allowed-tools: Read, Skill, Bash, Grep, Glob, mcp__review__fetch_diff, mcp__review__add_pr_review_comment
description: Review a GitHub pull request and add review comments for issues found
---

# Review Pull Request

Automatically review a GitHub pull request and provide feedback on code quality, style guide violations, and potential bugs.

## Usage

```
/pr-review
```

## Instructions

### 1. Auto-detect PR context

- First check for environment variables:
  - If `PR_NUMBER` and `GITHUB_REPOSITORY` are set, read them and parse `GITHUB_REPOSITORY` as `owner/repo` and use `PR_NUMBER` directly
- Otherwise:
  - Use `gh pr view --json url -q '.url'` to get PR info for the current branch and parse to extract owner, repo, and PR number
- If neither method works, inform the user that no PR was found and exit

### 2. Prepare for Review

- Use `mcp__review__fetch_diff` tool to fetch the PR diff
- If the diff includes changes to .py files:
  1. Read `dev/guides/python.md` to understand **all** rules and their exceptions
  2. Create a checklist listing each style guide rule with its exceptions before reviewing
  3. Use this checklist to ensure all rules are checked consistently

### 3. Review for Style Guide Violations (if applicable)

- Carefully examine ONLY the changed lines (added or modified) in the diff
- Go through each rule in your checklist one by one and check it against the changed lines
- Ignore unchanged/context lines and pre-existing code

### 4. Review for Bugs and Code Quality Issues

- Carefully examine ONLY the changed lines (added or modified) in the diff
- Check for potential bugs, code quality issues, and common mistakes
- Ignore unchanged/context lines and pre-existing code

### 5. Decision Point

- If NO issues found -> Report that no issues were found and exit
- If issues found -> Continue to step 6

### 6. Add Review Comments

- Use `mcp__review__add_pr_review_comment` tool for each issue found
- ONLY comment on lines that are marked as added (+) or modified in the diff
- Never comment on unchanged context lines or pre-existing code
- **For repetitive issues**: When the same issue appears on many lines (e.g., missing type hints, consistent style violations), leave a representative comment or group similar issues rather than flagging every instance. This avoids overwhelming PR authors with repetitive feedback.
- Prefer GitHub suggestion code blocks for simple fixes (typos, imports, formatting) using ` ```suggestion ` format (three backticks followed by "suggestion") so maintainers can apply with one click.
- Keep indentation: In ` ```suggestion ` blocks, copy the original leading spaces/tabs exactly (only change them if that's the actual fix). Avoid extra blank lines and include only the lines you intend to modify.

### Comment Parameters

- **Single-line**: Set `subject_type` to `line`, specify `line`
- **Multi-line**: Set `subject_type` to `line`, specify both `start_line` and `line`

### Comment Format

- Use suggestion blocks for direct fixes (preferred when possible) or triple backticks for code examples
- Be specific about the issue and why the change is needed
- For bugs, explain the potential problem and suggested fix clearly
- For typos, clearly indicate the correct spelling (e.g., "Typo: 'varabel' should be 'variable'")
- For grouped issues, mention how many instances were found (e.g., "This function and 3 others are missing type hints")
- Include `ðŸ¤– Generated by Claude` at the end of each comment
