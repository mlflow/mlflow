"use strict";(self.webpackChunkdatabricks_mlModelTraceRenderer=self.webpackChunkdatabricks_mlModelTraceRenderer||[]).push([[560],{88560:(e,t,r)=>{r.r(t),r.d(t,{CodeSnippetRenderMode:()=>ex,INFERENCE_TABLE_RESPONSE_COLUMN_KEY:()=>eg,INFERENCE_TABLE_TRACE_COLUMN_KEY:()=>eh,MLFLOW_TRACE_SCHEMA_VERSION_KEY:()=>ef,ModelIconType:()=>eE,ModelSpanType:()=>ey,ModelTraceChildToParentFrameMessage:()=>ou,ModelTraceContextProvider:()=>oy,ModelTraceExplorer:()=>ot,ModelTraceExplorerFrameRenderer:()=>of,ModelTraceExplorerOSSNotebookRenderer:()=>oa,ModelTraceParentToChildFrameMessage:()=>op,ModelTraceSpanType:()=>ev,getIsMlflowTraceUIEnabled:()=>ec,getModelTraceId:()=>eG,getModelTraceSpanEndTime:()=>eK,getModelTraceSpanId:()=>ez,getModelTraceSpanParentId:()=>e$,getModelTraceSpanStartTime:()=>eH,getTraceArtifact:()=>oi,isModelTrace:()=>eJ,isV3ModelTraceSpan:()=>eW,useModelTraceContext:()=>oh});var n=r(43760),i=r(44582),o=r.n(i),a=r(65724),s=r(71213),l=r(93556),c=r(14410),d=r.n(c);let u=o().createContext({tags:{},contextChain:[],contextList:[]});var p=r(15534),m=r(3472);let f=(0,i.createContext)({esComponent:m.Es.UiInfra,errorBoundaryId:"__default"});function g(){return(0,i.useContext)(f)}let h=(0,i.createContext)({UNSAFE_logErrorInPanelBoundary:()=>{}});function y(e,t){let r=(0,i.useRef)([]),{esComponent:n,errorBoundaryId:o}=g();return(0,i.useCallback)((i,a)=>{let s=Object.keys(a),l=Object.keys(i).filter(e=>s.includes(e)&&!r.current.includes(e));l.length>0&&(r.current.push(...l),p.iT.sev2(l.some(e=>"esComponent"===e)?m.Es.UiObservability:n,t,`Error boundary: ${o}, record event context chain: ${e.join(",")}, duplicate tags: ${l.join(",")}. Please follow go/recordeventduplicatetags to resolve.
Call stack: ${Error().stack}`,!0))},[e,t,n,o])}let E=Symbol("NOT_INITIALIZED");var v=r(94093),x=r(9913);let b="rit_comp_id";var T=r(29139),_=function(e){return e.INITIAL_LOAD="INITIAL_LOAD",e.NAVIGATION="NAVIGATION",e.INTERACTION="INTERACTION",e.MEASUREMENT="MEASUREMENT",e.PANEL_BOUNDARY="PANEL_BOUNDARY",e.WINDOW_ON_ERROR="WINDOW_ON_ERROR",e}({}),S=r(57903);function I(e){switch(e.entityType){case"page":return{type:S.jZ.EntityType_Type.PAGE,sub_type:void 0,entity_id:e.entityId,entity_view_id:e.entityViewId};case"component":return{type:S.jZ.EntityType_Type.COMPONENT,sub_type:function(e){switch(e){case"accordion":return S.jZ.EntitySubType_Type.ACCORDION;case"alert":return S.jZ.EntitySubType_Type.ALERT;case"banner":return S.jZ.EntitySubType_Type.BANNER;case"button":return S.jZ.EntitySubType_Type.BUTTON;case"card":return S.jZ.EntitySubType_Type.CARD;case"checkbox":return S.jZ.EntitySubType_Type.CHECKBOX;case"context_menu_checkbox_item":return S.jZ.EntitySubType_Type.CONTEXT_MENU_CHECKBOX_ITEM;case"context_menu_item":return S.jZ.EntitySubType_Type.CONTEXT_MENU_ITEM;case"context_menu_radio_group":return S.jZ.EntitySubType_Type.CONTEXT_MENU_RADIO_GROUP;case"dialog_combobox":return S.jZ.EntitySubType_Type.DIALOG_COMBOBOX;case"div":return S.jZ.EntitySubType_Type.DIV;case"drawer_content":return S.jZ.EntitySubType_Type.DRAWER_CONTENT;case"dropdown_menu_checkbox_item":return S.jZ.EntitySubType_Type.DROPDOWN_MENU_CHECKBOX_ITEM;case"dropdown_menu_item":return S.jZ.EntitySubType_Type.DROPDOWN_MENU_ITEM;case"dropdown_menu_radio_group":return S.jZ.EntitySubType_Type.DROPDOWN_MENU_RADIO_GROUP;case"file_input":return S.jZ.EntitySubType_Type.FILE_INPUT;case"form":return S.jZ.EntitySubType_Type.FORM;case"input":return S.jZ.EntitySubType_Type.INPUT;case"legacy_select":return S.jZ.EntitySubType_Type.LEGACY_SELECT;case"link":return S.jZ.EntitySubType_Type.LINK;case"listbox":return S.jZ.EntitySubType_Type.LISTBOX;case"modal":return S.jZ.EntitySubType_Type.MODAL;case"notification":return S.jZ.EntitySubType_Type.NOTIFICATION;case"pagination":return S.jZ.EntitySubType_Type.PAGINATION;case"pill_control":return S.jZ.EntitySubType_Type.PILL_CONTROL;case"popover":return S.jZ.EntitySubType_Type.POPOVER;case"preview_card":return S.jZ.EntitySubType_Type.PREVIEW_CARD;case"radio":return S.jZ.EntitySubType_Type.RADIO;case"radio_group":return S.jZ.EntitySubType_Type.RADIO_GROUP;case"react_select":return S.jZ.EntitySubType_Type.REACT_SELECT;case"segmented_control_group":return S.jZ.EntitySubType_Type.SEGMENTED_CONTROL_GROUP;case"simple_select":return S.jZ.EntitySubType_Type.SIMPLE_SELECT;case"switch":return S.jZ.EntitySubType_Type.SWITCH;case"table_header":return S.jZ.EntitySubType_Type.TABLE_HEADER;case"tabs":return S.jZ.EntitySubType_Type.TABS;case"tag":return S.jZ.EntitySubType_Type.TAG;case"text_area":return S.jZ.EntitySubType_Type.TEXT_AREA;case"toggle_button":return S.jZ.EntitySubType_Type.TOGGLE_BUTTON;case"tooltip":return S.jZ.EntitySubType_Type.TOOLTIP;case"typeahead_combobox":return S.jZ.EntitySubType_Type.TYPEAHEAD_COMBOBOX;case"typography_link":return S.jZ.EntitySubType_Type.TYPOGRAPHY_LINK}}(e.entitySubType),entity_id:e.entityId,entity_view_id:e.entityViewId};case"interaction":return{type:S.jZ.EntityType_Type.INTERACTION,sub_type:function(e){switch(e){case _.INITIAL_LOAD:return S.jZ.EntitySubType_Type.INITIAL_LOAD;case _.NAVIGATION:return S.jZ.EntitySubType_Type.NAVIGATION;case _.INTERACTION:return S.jZ.EntitySubType_Type.INTERACTION;case _.MEASUREMENT:return S.jZ.EntitySubType_Type.MEASUREMENT;case _.PANEL_BOUNDARY:return S.jZ.EntitySubType_Type.PANEL_BOUNDARY;case _.WINDOW_ON_ERROR:return S.jZ.EntitySubType_Type.WINDOW_ON_ERROR}}(e.entitySubType),entity_id:e.entityId}}}function A(e){return void 0!==e.valueBoolean?{value_boolean:e.valueBoolean}:void 0!==e.valueString?{value_string:e.valueString}:void 0!==e.valueNumber?{value_number:e.valueNumber}:void 0!==e.valueFiles?{value_multi_file_metadata:{file_metadata_list:e.valueFiles.map(e=>({mime_type:e.type,byte_size:e.size}))}}:{}}let R=new Set(["clusterLogDestination","availabilityZone","availability","clusterLogRegion","virtualClusterSize","performanceMode","manualModeEnableAutoscaling","autoterminationEnabled","autoModeSparkVersion","manualModeSparkVersion","runtimeEngine","nodeTypeId","driverNodeTypeId","instancePoolId","driverInstancePoolId","numWorkers","minWorkers","maxWorkers","autoterminationMinutes","dataSecurityMode","useMlRuntime","singleNode","useDocker","ebsVolumeType","ebsVolumeCount","ebsVolumeSize","localSsdCount"]),Y=new Set(["language"]),w={SimpleClusterCreateForm:R,SimpleClusterEditForm:R,"lakeflow.create-pipeline-landing-page.create-single-file-pipeline":Y,"lakeflow.create-pipeline-landing-page.create-pipeline-templates":Y,"lakeflow.add-pipeline-asset.modal.submit":new Set(["language","fileType","template","hasFromDataset"])};function N(e){switch(typeof e){case"boolean":return{value_boolean:e};case"number":return{value_number:e};case"string":return{value_string:e};default:return}}function M(e){let t={...e.customContext,interactionSubject:e.eventPayload.interactionSubject,rootInteractionId:e.eventPayload.rootInteractionId,interactionId:e.eventPayload.interactionId,eventType:e.eventType,eventClientSource:e.eventClientSource,entityType:e.eventEntity.entityType,entitySubType:e.eventEntity.entitySubType,entityId:e.eventEntity.entityId};switch(e.eventType){case"page_view":{let{productEntityChain:r,urlParams:n,...i}=e.eventPayload,o=r?.map(e=>`${e.type}:${e.id}`).join(",");return{...t,pageId:e.eventEntity.entityId,productEntityChain:o,...i,...n}}case"page_clipboard_cut":case"page_clipboard_copy":case"page_clipboard_paste":return{...t,referrerComponentType:e.eventPayload.referrerEntity?.entitySubType,referrerComponentId:e.eventPayload.referrerEntity?.entityId};case"component_click":case"component_view":case"component_zoom":return{...t,componentType:e.eventEntity.entitySubType,componentId:e.eventEntity.entityId};case"component_value_change":return{...t,componentType:e.eventEntity.entitySubType,componentId:e.eventEntity.entityId,valueChangeEventValueBoolean:e.eventPayload.valueBoolean,valueChangeEventValueString:e.eventPayload.valueString,valueChangeEventValueNumber:e.eventPayload.valueNumber};case"form_submit":return{...t,referrerComponentType:e.eventPayload.submissionTriggerEntity?.entitySubType,referrerComponentId:e.eventPayload.submissionTriggerEntity?.entityId};case"interaction_phase":return{...t,interactionPhaseName:e.eventPayload.interactionPhaseName,interactionPhaseStatus:e.eventPayload.interactionPhaseStatus,interactionPhaseType:e.eventPayload.interactionPhaseType}}}function C(e){return{type:function(e){switch(e){case"page_view":return S.jZ.EventType_Type.PAGE_VIEW;case"page_clipboard_cut":return S.jZ.EventType_Type.CLIPBOARD_CUT;case"page_clipboard_copy":return S.jZ.EventType_Type.CLIPBOARD_COPY;case"page_clipboard_paste":return S.jZ.EventType_Type.CLIPBOARD_PASTE;case"component_click":return S.jZ.EventType_Type.COMPONENT_CLICK;case"component_value_change":return S.jZ.EventType_Type.COMPONENT_VALUE_CHANGE;case"component_view":return S.jZ.EventType_Type.COMPONENT_VIEW;case"component_zoom":return S.jZ.EventType_Type.COMPONENT_ZOOM;case"interaction_phase":return S.jZ.EventType_Type.INTERACTION_PHASE;case"form_submit":return S.jZ.EventType_Type.FORM_SUBMIT}}(e.eventType),client_source:function(e){switch(e){case"adhoc":case"dropzone":return S.jZ.EventClientSource_Type.ADHOC;case"design_system":return S.jZ.EventClientSource_Type.DESIGN_SYSTEM;case"legacy_router":return S.jZ.EventClientSource_Type.LEGACY_ROUTER;case"react_interaction_tracing":return S.jZ.EventClientSource_Type.REACT_INTERACTION_TRACING;case"unified_router":return S.jZ.EventClientSource_Type.UNIFIED_ROUTER;case"error_logging":return S.jZ.EventClientSource_Type.ERROR_LOGGING}}(e.eventClientSource),entity:I(e.eventEntity),payload:(()=>{let t={interaction_subject:e.eventPayload.interactionSubject,interaction_id:e.eventPayload.interactionId,root_interaction_id:e.eventPayload.rootInteractionId,parent_id:e.eventPayload.interactionId?.slice(0,16)};switch(e.eventType){case"page_view":let{utmSourceUrlParam:r,utmMediumUrlParam:n,utmCampaignUrlParam:i,utmAdGroupUrlParam:o,utmContentUrlParam:a,utmOfferUrlParam:s,utmAdUrlParam:l,sisuIntentUrlParam:c,itmDataUrlParam:d,scidUrlParam:u,sisuDbxSourceUrlParam:p,sisuRlAidUrlParam:m,sisuGclidUrlParam:f,sisuMsclkidUrlParam:g,sisuFblidUrlParam:h,sisuLiFatIdUrlParam:y,sisuTwclidUrlParam:E,sisuRdtCidUrlParam:v,fullscreenWidgetUrlParam:x,...b}=e.eventPayload.urlParams??{},T={utm_source:e.eventPayload.urlParams?.utmSourceUrlParam,utm_medium:e.eventPayload.urlParams?.utmMediumUrlParam,utm_campaign:e.eventPayload.urlParams?.utmCampaignUrlParam,utm_ad_group:e.eventPayload.urlParams?.utmAdGroupUrlParam,utm_content:e.eventPayload.urlParams?.utmContentUrlParam,utm_offer:e.eventPayload.urlParams?.utmOfferUrlParam,utm_ad_url:e.eventPayload.urlParams?.utmAdUrlParam,sisu_intent:e.eventPayload.urlParams?.sisuIntentUrlParam,itm_data:e.eventPayload.urlParams?.itmDataUrlParam,scid:e.eventPayload.urlParams?.scidUrlParam,sisu_dbx_source:e.eventPayload.urlParams?.sisuDbxSourceUrlParam,sisu_rl_aid:e.eventPayload.urlParams?.sisuRlAidUrlParam,sisu_gclid:e.eventPayload.urlParams?.sisuGclidUrlParam,sisu_msclkid:e.eventPayload.urlParams?.sisuMsclkidUrlParam,sisu_fbclid:e.eventPayload.urlParams?.sisuFblidUrlParam,sisu_li_fat_id:e.eventPayload.urlParams?.sisuLiFatIdUrlParam,sisu_twclid:e.eventPayload.urlParams?.sisuTwclidUrlParam,sisu_rdt_cid:e.eventPayload.urlParams?.sisuRdtCidUrlParam,fullscreen_widget:e.eventPayload.urlParams?.fullscreenWidgetUrlParam,...b};return{...t,page_view_payload:{referrer_component_id:e.eventPayload.referrerComponentId,browser_screen_height:e.eventPayload.browserScreenHeight,browser_screen_width:e.eventPayload.browserScreenWidth,url_params:Object.values(T).some(e=>void 0!==e)?T:void 0}};case"page_clipboard_cut":return{...t,clipboard_cut_payload:{referrer_entity:e.eventPayload.referrerEntity?I(e.eventPayload.referrerEntity):void 0}};case"page_clipboard_copy":return{...t,clipboard_copy_payload:{referrer_entity:e.eventPayload.referrerEntity?I(e.eventPayload.referrerEntity):void 0}};case"page_clipboard_paste":return{...t,clipboard_paste_payload:{referrer_entity:e.eventPayload.referrerEntity?I(e.eventPayload.referrerEntity):void 0}};case"component_click":case"component_zoom":return t;case"component_value_change":let _=A(e.eventPayload);return{...t,component_value_change_payload:{..._,value_payload:_}};case"component_view":{let r=A(e.eventPayload);return{...t,component_view_payload:{value_payload:r}}}case"form_submit":return{...t,form_submit_payload:{submission_trigger_entity:e.eventPayload.submissionTriggerEntity?I(e.eventPayload.submissionTriggerEntity):void 0,form_property_values:function(e,t,r){if(void 0===t&&void 0===r||void 0===e||!w[e])return;let n={};return w[e].forEach(e=>{let i=t?.[e],o=r?.[e];(void 0!==i||void 0!==o)&&(n[e]={initial_value:N(i),final_value:N(o)})}),n}(e.eventEntity.entityId,e.eventPayload.initialPropertyValues,e.eventPayload.finalPropertyValues)}};case"interaction_phase":let R=function(e){switch(e){case"start":return S.jZ.InteractionPhaseType_Type.START;case"in_progress":return S.jZ.InteractionPhaseType_Type.IN_PROGRESS;case"complete":return S.jZ.InteractionPhaseType_Type.COMPLETE}}(e.eventPayload.interactionPhaseType);return{...t,interaction_phase_payload:{name:e.eventPayload.interactionPhaseName,type:R,status:function(e){switch(e){case"success":return S.jZ.Status_Type.SUCCESS;case"failure":return S.jZ.Status_Type.FAILURE;case"cancelled":return S.jZ.Status_Type.CANCELLED;case"interrupted":return S.jZ.Status_Type.INTERRUPTED;case"timed_out":return S.jZ.Status_Type.TIMED_OUT}}(e.eventPayload.interactionPhaseStatus),duration_millis:R===S.jZ.InteractionPhaseType_Type.COMPLETE&&e.eventPayload.duration?Math.round(10*e.eventPayload.duration)/10:void 0,exception:e.eventPayload.exception,exception_metadata:e.eventPayload.exceptionMetadata,causes:e.eventPayload.causes}}}})(),custom_context:e.customContextProto}}function O(e,t,r){D(e,t,{...r,eventClientSource:"adhoc"})}function D(e,t,r){if((0,T.W)("databricks.fe.observability.recordProtoBeforeEvent",!0)){t&&t({observability_log:C(r)}),e("uiAnalyticsEvent",M(r));return}e("uiAnalyticsEvent",M(r)),t&&t({observability_log:C(r)})}let k=new WeakMap,L=null;function P(){return L?k.get(L):null}function F(e){return k.get(U(e))||null}function U(e){if("nativeEvent"in e)return e.nativeEvent;return e}let B={onClick:"component_click",onSubmit:"form_submit",onValueChange:"component_value_change",onView:"component_view"},j=e=>{let{recordEvent:t,recordProto:r,startInteraction:n}=e;return(0,i.useCallback)(e=>{let{eventType:i,componentType:o,componentId:a,componentSubType:s,value:l,shouldStartInteraction:c,event:d,mode:u,referrerComponent:f,isInteractionSubject:g,formPropertyValues:h,componentViewId:y}=e,E=null,v=B[i],T=function(e,t,r){return{interactionName:`${b}:${e}:component:${t}:${r}`,componentType:t,componentId:r}}(v,o,a),_=null;if(d?.defaultPrevented&&"form_submit"!==v||"skip"===u)return;if(c){let e=!0;if("form_submit"===v){let t=d?F(d):void 0;e=!t;let r=(t=t??P())?function(e){if(!e.startsWith(`${b}:`))return null;return{interactionName:e,componentType:e.split(":")[3],componentId:e.split(":")[4]}}(t.name):null;t&&r&&("button"===r.componentType||"dropdown_menu_item"===r.componentType)&&(_=t,f||(f={id:r.componentId,type:r.componentType}))}_||(_=n(T.interactionName,void 0,void 0,void 0,{isInteractionSubject:!1})),e&&_&&d&&function(e,t){if(!t)return p.iT.sev2(m.Es.UiInfra,"Experimental: set-interaction-for-event-with-null",Error("cannot set null interaction for event"));let r=U(e);k.has(r)&&p.iT.sev2(m.Es.UiObservability,"Experimental: event-has-interaction-associated-already",{eventType:r.type,existing:k.get(r)?.name,new:t?.name,stack:Error().stack}),L=r,k.set(r,t),queueMicrotask(()=>{r===L&&(L=null)})}(d,_)}if("associate_event_only"===u)return;switch(v){case"component_click":E={eventType:v,eventClientSource:"design_system",eventEntity:{entityType:"component",entitySubType:o,entityId:a,entityViewId:y},eventPayload:{interactionSubject:g??!0,interactionId:_?.id,rootInteractionId:_?.rootInteractionId}};break;case"form_submit":E={eventType:v,eventClientSource:"design_system",eventEntity:{entityType:"component",entitySubType:o,entityId:a},eventPayload:{interactionSubject:!0,interactionId:_?.id,rootInteractionId:_?.rootInteractionId,submissionTriggerEntity:f?{entityType:"component",entitySubType:f.type,entityId:f.id}:void 0,initialPropertyValues:h?.initial,finalPropertyValues:h?.final}};break;case"component_value_change":E={eventType:v,eventClientSource:"design_system",eventEntity:{entityType:"component",entitySubType:o,entityId:a,entityViewId:y},eventPayload:{interactionSubject:!0,valueBoolean:"boolean"==typeof l?l:void 0,valueString:"string"==typeof l?l:void 0,valueNumber:"number"==typeof l?l:void 0}};break;case"component_view":if(E={eventType:v,eventClientSource:"design_system",eventEntity:{entityType:"component",entitySubType:o,entityId:a,entityViewId:y},eventPayload:{interactionSubject:!0,valueBoolean:"boolean"==typeof l?l:void 0,valueString:"string"==typeof l?l:void 0,valueNumber:"number"==typeof l?l:void 0}},[x.v_.Alert,x.v_.Banner,x.v_.Notification].includes(o)&&s===x.NI.Error){let e=`Experimental: DuBois-${o} High Erroring Rate`;t(p.CW,{eventId:e},`Experimental: DuBois-${o} component being viewed at a high rate on ${a}`)}}E?D(t,r,E):p.iT.sev2(m.Es.UiObservability,"InternalDesignSystemEventProvider/UnknownEventType",{eventType:i,componentType:o,componentId:a})},[t,r,n])};var W=r(44263);function z(e,t,r,n){if(r&&e(r??{},t),r&&n){let e=Object.keys(r),t=Object.keys(n);d()(0===e.filter(e=>t.includes(e)).length,`Cannot specify a tag in both the tags and as override. Tags: ${e.join(",")}, overrides: ${t.join(",")}`)}return r||n?{...t,...r,...n}:t}let $={};function H(){let{tags:e,contextChain:t}=(0,i.useContext)(u),r=y(t,"DuplicateRecordEventInvocationTag"),n=(0,i.useCallback)((t,n)=>z(r,e,t,n),[r,e]);return{contextTags:e,mergeTags:n}}function K(){let e=function(){let{mergeTags:e}=H();return(0,i.useCallback)(t=>{let{metric:r,tags:n,overrides:i,eventData:o}=t,a=e(n,i);(0,W.y)(r,a,o)},[e])}();return(0,i.useCallback)((t,r,n)=>e({metric:t,tags:r,eventData:n}),[e])}var G=r(56134),V=r.n(G),Z=function(e){return e.GLOBAL="global",e.WEBAPP_APP_ROOT="webapp_app_root",e.WEBAPP_LOGIN_ROOT="webapp_login_root",e.WEBAPP_REACT_ROOT="webapp_react_root",e.PLATFORM_ROUTER_PAGE_VIEW="platform_router_page_view",e.PLATFORM_ROUTER_PAGE_ID="platform_router_page_id",e.SCHEMA_BROWSER_OPTIONS="schema_browser_options",e.SCHEMA_BROWSER_LOCATION_ID="schema_browser_location_id",e.SCHEMA_BROWSER_PANEL_ID="schema_browser_panel_id",e.SCHEMA_BROWSER_TREE_ID="schema_browser_tree_id",e.SEARCH_PAGE="search_page",e.SEARCH_PAGE_RESULT="search_page_result",e.NAVIGATIONAL_SEARCH_BAR="navigational_search_bar",e.INGESTION_CONNECTIONS_MODAL_ID="ingestion_connections_modal_id",e.INGESTION_CREATE_TABLE_VOLUME="ingestion_create_table_volume",e.INGESTION_CREATE_OR_MODIFY_TABLE_PAGE_ID="ingestion_create_or_modify_table_page_id",e.INGESTION_CREATE_OR_MODIFY_TABLE_ID="ingestion_create_or_modify_table_id",e.INGESTION_CREATE_TABLE_EXTERNAL_LOCATIONS_PAGE_ID="ingestion_create_table_external_locations_page_id",e.INGESTION_CREATE_TABLE_EXTERNAL_LOCATIONS_ID="ingestion_create_table_external_locations_id",e.INGESTION_NEW_PIPELINE_PAGE_ID="ingestion_new_pipeline_page_id",e.INGESTION_PREVIEW_TABLE_ID="ingestion_preview_table_id",e.INGESTION_FILE_UPLOADER_ID="ingestion_file_uploader_id",e.INGESTION_VOLUME_UPLOAD_ID="ingestion_volume_upload_id",e.INGESTION_ADD_DATA_PAGE_ID="ingestion_add_data_page_id",e.INGESTION_QUERY_SOURCE_ALERTS_ID="ingestion_query_source_alerts_id",e.INGESTION_SETUP_WIZARD_ID="ingestion_setup_wizard_id",e.INGESTION_DRAWER_ID="ingestion_drawer_id",e.DATA_EXPLORER_UI="data_explorer_ui",e.SQL_EDITOR_TAB_ID="sql_editor_tab_id",e.SQL_EDITOR_TABS_COUNT_ID="sql_editor_tabs_count_id",e.SISU_APP_ROOT="sisu_app_root",e.ANALYTICS_CONTAINER="analytics_container",e.PRODUCT_ENTITY_CONTAINER="product_entity_container",e.PANEL_BOUNDARY="panel_boundary",e.ACCOUNTS_CONSOLE_LOGIN_ROOT="accounts_console_login_root",e.BILLING_UPGRADE_MODAL="billing_upgrade_modal",e.FEATURE_PREVIEW_PAGE_ID="feature_preview_page_id",e.WEBAPP_DARK_MODE_PROMPT_MODAL="webapp_dark_mode_prompt_modal",e.ASSET_LIST_ITEM="homepage_asset_list_item",e.BROWSE_ASSET_SELECTOR="browse_asset_selector",e.BROWSE_ASSET_SELECTOR_SECTION="browse_asset_selector_section",e.BROWSE_ASSET_SELECTOR_SUBSECTION="browse_asset_selector_subsection",e.BROWSE_FAVORITES_TABLE="browse_favorite_table",e.BROWSE_POPULAR_TABLE="browse_popular_table",e.ACCOUNTS_CONSOLE_CREATE_WORKSPACE_MODAL="accounts_console_create_workspace_modal",e.DATA_SHARING="data_sharing",e.AI_PLAYGROUND="ai_playground",e.UI_DEPLOYABLE="ui_deployable",e.WAREHOUSE_UI_MONITORING_TAB="warehouse_ui_monitoring_tab",e.ASSISTANT_QUICKFIX="assistant_quickfix",e.ASSISTANT_EDIT="assistant_edit",e.ASSISTANT_CELL_MAGIC="assistant_cell_magic",e.PIPELINE_CONTEXT="pipeline_context",e.MLFLOW_CONTEXT="mlflow_context",e.ALERT_UTILS="alert_utils",e.DISCOVER_PAGE_ITEM="discover_page_item",e}({});let J={DUMMY_TEST_CONTEXT:["context.server_context.client_ip"],[Z.ANALYTICS_CONTAINER]:["context.analytics_context.analytics_container_context","context.client_context.context_error_boundary_id","context.client_context.es_component"],[Z.PLATFORM_ROUTER_PAGE_ID]:["context.client_context.page_id","context.client_context.page_info_context.record_event_context_page_id"],[Z.PLATFORM_ROUTER_PAGE_VIEW]:["context.client_context.page_view_id","context.client_context.page_info_context.record_event_context_page_view_id"],[Z.PRODUCT_ENTITY_CONTAINER]:["context.analytics_context.product_entity_context"]};var q=r(29371);let X=void 0,Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=new Set;return Object.keys(e).forEach(n=>{let i=[...t,n].join(".");"object"==typeof e[n]&&null!==e[n]?Q(e[n],[...t,n]).forEach(e=>r.add(e)):r.add(i)}),r},ee=(e,t)=>J[e]?.some(e=>t.startsWith(e))??!1;function et(e,t,r,n,i){let o=Q(e),a=new Set,s=new Set,l=t.map(t=>{let r=t.recordProtoContextFunc(e);return{id:t.id,result:r,paths:Q(r)}});l.forEach(e=>{let{paths:t,id:r}=e;t.forEach(e=>{ee(r,e)&&o.has(e)&&s.add(e)})});let c=V().merge(e,...l.map(e=>e.result));return l.forEach(e=>{let{id:t,paths:r}=e;r.forEach(e=>{o.has(e)?ee(t,e)||a.add(e):o.add(e)})}),s.size>0&&(0,T.W)("databricks.fe.observability.protoContextualAlerts",!1)&&p.iT.sev2(m.Es.UiObservability,"experimental-AllowlistedRecordProtoPropertyViolation",`Error boundary: ${n}, record event context chain: ${i.join(",")}, allowlisted properties modified by main object: ${[...s].join(",")}. Please follow go/recordprotoallowlistviolation to resolve.
Call stack: ${Error().stack}`,!0),a.delete("context.client_context.page_info_context.active_record_event_context_id"),a.size>0&&(0,T.W)("databricks.fe.observability.protoContextualAlerts",!1)&&p.iT.sev2(m.Es.UiObservability,"experimental-DuplicateRecordProtoProperty",`Error boundary: ${n}, record event context chain: ${i.join(",")}, duplicate proto properties: ${[...a].join(",")}. Please follow go/recordprotoduplicateproperties to resolve.
Call stack: ${Error().stack}`,!0),c}function er(){let{esComponent:e,errorBoundaryId:t}=g(),{contextList:r,contextChain:n}=(0,i.useContext)(u);return(0,i.useCallback)(i=>(0,q.FU)(r.length>0?et({entry:i},r,e,t,n):{entry:i}),[n,t,e,r])}let en=o().createContext({getCurrentInteraction:()=>null,startInteraction:()=>null});function ei(){let{esComponent:e,errorBoundaryId:t}=g(),{mergeTags:r}=H(),n=(0,i.useContext)(en),o=function(){let{esComponent:e,errorBoundaryId:t}=g(),{contextList:r,contextChain:n}=(0,i.useContext)(u);return(0,i.useCallback)((i,o)=>{let a=r.length>0?et({entry:i},r,e,t,n):{entry:i},s=o?o(a):a;return(0,q.FU)(s)},[n,t,e,r])}();return(0,i.useMemo)(()=>({...n,startInteraction:(i,a,s,l,c)=>{let d=r({errorBoundaryId:t},{...l,esComponent:e}),u={...c,useRecordProtoWithOverridesFn:o};return n.startInteraction(i,a,s,d,u)}}),[e,n,r,t,o])}function eo(e){let{children:t}=e,r=function(){let{tags:e,contextChain:t}=(0,i.useContext)(u),r=y(t,"DuplicateRecordEventInvocationTag"),n=(0,i.useRef)($);(0,i.useLayoutEffect)(()=>{n.current=e},[e]);let o=(0,i.useCallback)((e,t)=>(d()(n.current!==$,"mergeTagsStable called before layout effects ran. mergeTagsStable should only be called in response to user actions or in useEffect."),z(r,n.current,e,t)),[r]);return(0,i.useCallback)((e,t,r)=>{let n=o(t);(0,W.y)(e,n,r)},[o])}(),o=function(){let{esComponent:e,errorBoundaryId:t}=g(),{contextList:r,contextChain:n}=(0,i.useContext)(u),o=(0,i.useRef)(X);return(0,i.useLayoutEffect)(()=>{o.current=r},[r]),(0,i.useCallback)(r=>(0,q.FU)(o.current?et({entry:r},o.current,e,t,n):{entry:r}),[n,t,e])}(),{startInteraction:a}=function(){let{esComponent:e,errorBoundaryId:t}=g(),{mergeTags:r}=function(){let{tags:e,contextChain:t}=(0,i.useContext)(u),r=y(t,"DuplicateRecordEventInvocationTag"),n=(0,i.useRef)($);return(0,i.useLayoutEffect)(()=>{n.current=e},[e]),{mergeTags:(0,i.useCallback)((e,t)=>(d()(n.current!==$,"mergeTagsStable called before layout effects ran. mergeTagsStable should only be called in response to user actions or in useEffect."),z(r,n.current,e,t)),[r])}}(),n=(0,i.useContext)(en),o=n.startInteraction,a=function(){let{esComponent:e,errorBoundaryId:t}=g(),{contextList:r,contextChain:n}=(0,i.useContext)(u),o=(0,i.useRef)(X);return(0,i.useLayoutEffect)(()=>{o.current=r},[r]),(0,i.useCallback)((r,i)=>{let a=o.current?et({entry:r},o.current,e,t,n):{entry:r},s=i?i(a):a;return(0,q.FU)(s)},[n,t,e])}(),s=(0,i.useCallback)((n,i,s,l,c)=>o(n,i,s,r({errorBoundaryId:t},{...l,esComponent:e}),c?{...c,useRecordProtoWithOverridesFn:a}:{useRecordProtoWithOverridesFn:a}),[r,e,o,t,a]);return(0,i.useMemo)(()=>({...n,startInteraction:s}),[n,s])}(),s=j({recordEvent:r,recordProto:o,startInteraction:a});return(0,n.Y)(x.zI,{callback:s,children:t})}function ea(e){let{tags:t,id:r,context:i,children:o}=e;return(0,n.Y)(el,{tags:t,id:r,context:i,override:!1,children:o})}let es=()=>({});function el(e){let{tags:t,id:r,context:o=es,children:a,override:s}=e,{contextChain:l,tags:c,contextList:p}=(0,i.useContext)(u),m=(0,i.useMemo)(()=>[...l,r],[r,l]),f=function(){let e=(0,i.useRef)(E);if(e.current===E){let t=v.n.generateUuidV4();return e.current=t,t}return e.current}(),g=(0,i.useRef)(0),h=(0,i.useMemo)(()=>{g.current+=1;let e=`${f}:${g.current}`;return{tags:{...c,...t,activeRecordEventContextId:e},contextChain:m,contextList:[...p,{recordProtoContextFunc:t=>{let r=o(t);return{...r,context:{...r.context,client_context:{...r.context?.client_context,page_info_context:{...r.context?.client_context?.page_info_context,active_record_event_context_id:e}}}}},id:r}]}},[c,t,m,p,o,r,f,g]),x=y(m,"DuplicateRecordEventContextTag"),{activeRecordEventContextId:b,...T}=c;return(0,i.useEffect)(()=>{s||x(t,T)},[s,x,T,t]),d()(s||!l.includes(r),`Record event context ${r} cannot be redefined in the current chain ${m.join(",")}`),(0,n.Y)(u.Provider,{value:h,children:(0,n.Y)(eo,{children:a})})}let ec=()=>(0,T.W)("databricks.fe.mlflow.enableTracingUI",!1);var ed=r(76363),eu=r(23807),ep=r(51918);let em=(0,ep.fH)("Dubois::NotificationOpen");(0,ep.fH)("Dubois::NotificationClose"),(0,eu.g)("Dubois::notificationChanged");let ef="mlflow.trace_schema.version",eg="response",eh="trace";var ey=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.UNKNOWN="UNKNOWN",e}({}),eE=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e}({}),ev=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.UNKNOWN="UNKNOWN",e}({}),ex=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e}({}),eb=r(66984),eT=r(66239),e_=r(71700),eS=r(90009),eI=r(13226),eA=r(10600),eR=r(17790),eY=r(87408),ew=r(85101),eN=r(49309),eM=r(39271),eC=r(41697),eO=r(35775),eD=r(54743);let ek=e=>{let t,{type:r=eE.CONNECT,isInTooltip:i=!1,hasException:o=!1,isRootSpan:s=!1}=e,{theme:l}=(0,a.wn)();s?t="ai":o&&(t="danger");let c={[eE.MODELS]:(0,n.Y)(eb.A,{color:t}),[eE.DOCUMENT]:(0,n.Y)(eT.A,{color:t}),[eE.CONNECT]:(0,n.Y)(e_.A,{color:t}),[eE.CODE]:(0,n.Y)(eS.A,{color:t}),[eE.FUNCTION]:(0,n.Y)(eI.A,{color:t}),[eE.NUMBERS]:(0,n.Y)(eA.A,{color:t}),[eE.SEARCH]:(0,n.Y)(eR.A,{color:t}),[eE.SORT]:(0,n.Y)(eY.A,{color:t}),[eE.UNKNOWN]:(0,n.Y)(ew.A,{color:t}),[eE.WRENCH]:(0,n.Y)(eN.A,{color:t}),[eE.AGENT]:(0,n.Y)(eM.A,{color:t}),[eE.CHAIN]:(0,n.Y)(eC.A,{color:t}),[eE.USER]:(0,n.Y)(eO.A,{color:t}),[eE.SYSTEM]:(0,n.Y)(eD.A,{color:t})},d=l.colors.actionDefaultIconDefault,u=l.colors.actionPrimaryIcon,p=l.colors.backgroundSecondary;switch(r){case eE.SEARCH:d=l.colors.textValidationSuccess,u=l.colors.green500,p=l.isDarkMode?l.colors.green800:l.colors.green100;break;case eE.MODELS:d=l.isDarkMode?l.colors.blue500:l.colors.turquoise,u=l.isDarkMode?l.colors.turquoise:l.colors.blue500,p=l.isDarkMode?l.colors.blue800:l.colors.blue100;break;case eE.WRENCH:d=l.isDarkMode?l.colors.red500:l.colors.red700,u=l.isDarkMode?l.colors.red700:l.colors.red500,p=l.isDarkMode?l.colors.red800:l.colors.red100}return(0,n.FD)("div",{css:{position:"relative",width:l.general.iconSize,height:l.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:l.borders.borderRadiusSm,background:i?l.colors.tooltipBackgroundTooltip:p,color:i?u:d,svg:{width:l.general.iconFontSize,height:l.general.iconFontSize},flexShrink:0},children:[o&&(0,n.Y)("div",{css:{position:"absolute",top:-l.spacing.xs,right:-l.spacing.xs,height:l.spacing.sm,width:l.spacing.sm,borderRadius:l.borders.borderRadiusSm,backgroundColor:l.colors.actionDangerPrimaryBackgroundDefault,zIndex:5}}),c[r]]})},eL=()=>(0,ed.d)("user_new",""),eP=e=>{em.call({isCloseable:!0,root:{componentId:"shared.model-trace-explorer.assessment-create-error",duration:5e3,severity:"error"},title:{value:e}})};function eF(e){switch(e){case ey.LLM:return eE.MODELS;case ey.CHAIN:return eE.CHAIN;case ey.AGENT:return eE.AGENT;case ey.TOOL:return eE.WRENCH;case ey.CHAT_MODEL:return eE.MODELS;case ey.RETRIEVER:return eE.SEARCH;case ey.PARSER:return eE.CODE;case ey.EMBEDDING:return eE.NUMBERS;case ey.RERANKER:return eE.SORT;case ey.FUNCTION:return eE.FUNCTION;case ey.UNKNOWN:return eE.UNKNOWN;default:return eE.FUNCTION}}function eU(e){try{return JSON.parse(e)}catch(t){return e}}let eB=(e,t)=>{if(t)try{return(e=>{let t=atob(e),r=t.length,n="";for(let e=0;e<r;e++)n+=t.charCodeAt(e).toString(16).padStart(2,"0");return n})(e)}catch(t){return e}if(e.startsWith("0x"))return e.slice(2);return e};function ej(e){return"trace_metadata"in e}function eW(e){return"start_time_unix_nano"in e}function ez(e){return eW(e)?eB(e.span_id,!0):eB(e.context?.span_id??"",!1)}function e$(e){return eW(e)?eB(e.parent_span_id,!0):eB(e.parent_id??"",!1)}function eH(e){return eW(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function eK(e){return eW(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function eG(e){return ej(e.info)?e.info.trace_id:e.info.request_id??""}let eV=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map(e=>{let[t,r]=e;return{key:t,value:r}})).filter(e=>{let{key:t}=e;return t.startsWith("mlflow.assessment.")}).map(e=>{let{value:t}=e;return JSON.parse(t)})};function eZ(e){if(!e)return;if((0,G.isArray)(e))return e.find(e=>e.key===ef)?.value;return e[ef]}let eJ=e=>{let t=e?.info,r=e?.data;if(!t||!r||!r?.spans)return!1;let n=t?.request_metadata??t?.trace_metadata;if(n&&eZ(n))return!0;let i=t?.tags;if(i&&eZ(i))return!0;return!1},eq=e=>{if((0,G.isNil)(e))return[];if(Array.isArray(e)||(0,G.isString)(e)||(0,G.isNumber)(e)||(0,G.isBoolean)(e))return[{key:"",value:JSON.stringify(e,null,2)}];return Object.entries(e).map(e=>{let[t,r]=e;return{key:t,value:JSON.stringify(r,null,2)}})},eX=e=>(0,G.has)(e,"page_content"),eQ=(e,t,r)=>`${e}-${t}-${r}`,e0=e=>(e.events??[]).filter(e=>"exception"===e.name),e1=e=>e0(e).length,e2=e=>{let t;switch(e.type){case"user":case"human":t="user";break;case"assistant":case"ai":t="assistant";break;case"system":t="system";break;case"tool":t="tool";break;case"function":t="function";break;default:return null}let r={content:e.content,role:t},n=e.tool_calls,i=e.additional_kwargs?.tool_calls;return!(0,G.isNil)(n)&&Array.isArray(n)&&n.length>0&&n.every(tt)?r.tool_calls=(0,G.compact)(n.map(e3)):!(0,G.isNil)(i)&&Array.isArray(i)&&i.length>0&&i.every(e4)&&(r.tool_calls=i.map(ts)),(0,G.isNil)(e.tool_call_id)||(r.tool_call_id=e.tool_call_id),r},e3=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),e5=e=>{if((0,G.isNil)(e)||!(0,G.isNil)(e.type)&&!(0,G.isString)(e.type)||!(0,G.isNil)(e.description)&&!(0,G.isString)(e.description)||!(0,G.isNil)(e.enum)&&!Array.isArray(e.enum))return!1;return!0},e6=e=>{if((0,G.isNil)(e)||"function"!==e.type||!(0,G.has)(e,"function.name"))return!1;let t=e.function?.parameters;if(!(0,G.isNil)(t)){let e=t.required;if(!(0,G.isNil)(e)&&(!Array.isArray(e)||!e.every(G.isString)))return!1;let r=t.properties;if(!(0,G.isNil)(r)&&!Object.values(r).every(e5))return!1}return!0},e4=e=>e&&(0,G.isString)(e.id)&&(0,G.isString)(e.function?.arguments)&&(0,G.isString)(e.function?.name),e7=e=>{if(!e9(e))return!1;return(0,G.isNil)(e.content)||(0,G.isString)(e.content)},e9=e=>{if(!e||e.tool_calls&&(!Array.isArray(e.tool_calls)||!e.tool_calls.every(e4)))return!1;if("reasoning"===e.type)return!0;if(!(e=>{if((0,G.isNil)(e)||(0,G.isString)(e))return!0;if((0,G.isArray)(e))return e.every(e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,G.isString)(e.text);case"image_url":let{image_url:t}=e;if((0,G.isNil)(t))return!1;return(0,G.isString)(t.url)&&((0,G.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":let{input_audio:r}=e;if((0,G.isNil)(r))return!1;return(0,G.isString)(r.data)&&((0,G.isNil)(r.format)||["wav","mp3"].includes(r.format));default:return!1}})(e));return!1})(e.content))return!1;return"user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role},e8=e=>Array.isArray(e)&&e.length>0&&e.every(e=>(0,G.has)(e,"message")&&e7(e.message)),te=e=>{if(!e||!(0,G.isNil)(e.content)&&!(0,G.isString)(e.content))return!1;return["human","user","assistant","ai","system","tool","function"].includes(e.type)},tt=e=>e&&(0,G.isString)(e.name)&&(0,G.has)(e,"args")&&(0,G.isString)(e.id),tr=e=>e&&te(e.message),tn=e=>{try{if(Array.isArray(e)&&e.length>0&&e.every(e9))return(0,G.compact)(e.map(tl));let t=ti(e);if(t)return t;let r=tc(e);if(r)return r;let n=ta(e);if(n)return n;let i=td(e);if(i)return i;let o=tm(e);if(o)return o;let a=tf(e);if(a)return a;return null}catch(e){return null}},ti=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(te)){let t=e[0].map(e2);if(t.some(e=>null===e))return null;return t}if(Array.isArray(e?.messages)&&e.messages.length>0&&e.messages.every(te)){let t=e.messages.map(e2);if(t.some(e=>null===e))return null;return t}return null},to=e=>{let t=e.map(e=>e2(e.message));if(t.some(e=>null===e))return null;return t},ta=e=>{if((e=>{if(!Array.isArray(e)||e.length<1||!Array.isArray(e[0])||e[0].length<1)return!1;return e[0].every(tr)})(e))return to(e[0]);if(!Array.isArray(e?.generations)||!(e.generations.length>0)||!e.generations[0].every(tr))return null;return to(e.generations[0])},ts=e=>{let t=e.function?.arguments;try{t=JSON.stringify(JSON.parse(t),null,2)}catch(e){}return{id:e.id,function:{arguments:t,name:e.function.name}}},tl=e=>{if("reasoning"===e.type)return null;return{...e,content:(e=>{if((0,G.isNil)(e)||(0,G.isString)(e))return e;return e.map(e=>{switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":return"[image]";case"input_audio":return"[audio]"}}).join("\n")})(e.content),tool_calls:e.tool_calls?.map(ts)}},tc=e=>{if(!e)return null;let t=e.messages??e.input;if(!Array.isArray(t)||0===t.length||!t.every(e9))return null;return(0,G.compact)(t.map(tl))},td=e=>{if(e8(e))return e.map(e=>({...e.message,tool_calls:e.message.tool_calls?.map(ts)}));if(!(e=>e&&e8(e.choices))(e))return null;return e.choices.map(e=>({...e.message,tool_calls:e.message.tool_calls?.map(ts)}))},tu=e=>{if(!e)return!1;if("message"===e.type)return e9(e);if("function_call"===e.type)return(0,G.isString)(e.call_id)&&(0,G.isString)(e.name)&&(0,G.isString)(e.arguments);if("function_call_output"===e.type)return(0,G.isString)(e.call_id)&&(0,G.isString)(e.output);return!1},tp=e=>{if("message"===e.type)return tl(e);if("function_call"===e.type)return{role:"assistant",tool_calls:[ts({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]};if("function_call_output"===e.type)return{role:"tool",tool_call_id:e.call_id,content:e.output};return null},tm=e=>{if(!e)return null;if(Array.isArray(e)&&e.length>0&&e.every(tu))return(0,G.compact)(e.map(tp));if(Array.isArray(e)&&e.length>0&&e.every(e=>"response.output_item.done"===e.type&&tu(e.item)))return(0,G.compact)(e.map(e=>tp(e.item)));return null},tf=e=>{if(!(e=>e&&e7(e.message))(e))return null;return[e.message]};var tg=r(97768),th=r(92693);function ty(e){let{ref:t,debounceTimeMs:r}=e,n=(0,i.useRef)({width:-1,height:-1}),o=(0,i.useRef)(),[a,s]=(0,i.useState)(null),l=(0,i.useCallback)(e=>{if(0===e.length)return;let t=e[0].contentRect;if(-1===n.current.width){n.current={width:t.width,height:t.height},s(n.current);return}if(t.width!==n.current.width||t.height!==n.current.height){if(n.current.width=t.width,n.current.height=t.height,!r)return void s({...n.current});clearTimeout(o.current),o.current=setTimeout(()=>{s({...n.current})},r)}},[r]),c=(0,i.useRef)();return c.current||(c.current=new ResizeObserver(l)),(0,i.useEffect)(()=>{let e="function"==typeof t?t():t.current;if(e){let t=c.current;return t.observe(e),()=>t.unobserve(e)}}),a}let tE=(0,i.forwardRef)((e,t)=>{let{initialRatio:r,paneWidth:o,setPaneWidth:s,leftChild:l,leftMinWidth:c,rightChild:d,rightMinWidth:u}=e,[p,m]=(0,i.useState)(!1),f=(0,i.useRef)(null),g=ty({ref:f})?.width,h=(g??1/0)-u,y=(0,i.useRef)(r),{theme:E}=(0,a.wn)(),v=(0,i.useCallback)(e=>{g&&(y.current=e/g)},[g]);return(0,i.useImperativeHandle)(t,()=>({updateRatio:v})),(0,i.useLayoutEffect)(()=>{g&&s((0,G.clamp)(g*y.current,c,h))},[g,h,c,u,s]),(0,n.FD)("div",{ref:f,css:{display:"flex",flex:1,overflow:"hidden",flexDirection:"row"},children:[p&&(0,n.Y)(tg.mL,{styles:[{"body, :host":{userSelect:"none"}}]}),(0,n.Y)(th.ResizableBox,{axis:"x",width:o,css:{display:"flex",flex:`0 0 ${o}px`},handle:(0,n.Y)("div",{css:{width:0,position:"relative"},children:(0,n.Y)("div",{css:{position:"relative",width:E.spacing.sm,marginLeft:-E.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}}})}),onResize:(e,t)=>{let{size:r}=t,n=(0,G.clamp)(r.width,c,h);s(n),g&&(y.current=n/g)},onResizeStart:()=>m(!0),onResizeStop:()=>m(!1),minConstraints:[c,1/0],maxConstraints:[h,1/0],children:l}),d]})});var tv=r(80084),tx=r(65555),tb=r(54487),tT=r(73325),t_=r(86892),tS=r(51839);let tI=e=>{let{searchFilter:t,setSearchFilter:r,matchData:o,handleNextSearchMatch:s,handlePreviousSearchMatch:l}=e,[c,d]=(0,i.useState)(t),u=(0,tv.YQ)(r,350),{theme:p}=(0,a.wn)();return(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:p.spacing.sm},children:[(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:c,onClear:()=>{r(""),d("")},onChange:e=>{d(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,n.Y)(eR.A,{}),css:{width:"100%",boxSizing:"border-box"}}),o.match&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",marginLeft:p.spacing.xs,marginRight:p.spacing.sm,alignItems:"center"},children:[(0,n.FD)(tb.o.Text,{css:{whiteSpace:"nowrap",marginRight:p.spacing.sm},children:[o.currentMatchIndex+1," / ",o.totalMatches]}),(0,n.Y)(tT.$n,{"data-testid":"prev-search-match",icon:(0,n.Y)(t_.A,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,n.Y)(tT.$n,{"data-testid":"next-search-match",icon:(0,n.Y)(tS.A,{}),onClick:s,componentId:"shared.model-trace-explorer.next-search-match"})]})]})},tA=1/0,tR={HIGH:5,NORMAL:3,LOW:1},tY=e=>{let t=[],r=e=>{if(!e)return;t.push(e),e.children?.forEach(r)};return e.forEach(r),t},tw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={},n=(e,i)=>{if(!e||i>t)return;r[e.key]=e,e.children?.forEach(e=>n(e,i+1))};return e.forEach(n,0),r},tN=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,i.useState)(()=>{if(e.rootNodes)return new Set((0,G.values)(tw(e.rootNodes,e.initialExpandDepth)).map(e=>e.key));return new Set});return{expandedKeys:t,setExpandedKeys:r}},tM=e=>{if(0===e)return"0s";if(e>=60*1e6)return`${(e/1e6/60).toFixed(2)}m`;if(e>=1e5)return`${(e/1e6).toFixed(2)}s`;return`${(e/1e3).toFixed(2)}ms`},tC=(e,t)=>{if(e.key===t)return 0;return(e.children??[]).findIndex(e=>tC(e,t)>-1)},tO=e=>{if(!e.children||e.children?.length===0)return 0;return Math.max(...e.children.map(tO))+1},tD=(0,i.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),tk=()=>(0,i.useContext)(tD),tL=e=>{let{modelTrace:t,initialActiveView:r,selectedSpanIdOnRender:o,assessmentsPaneEnabled:a,children:s}=e,l=(0,i.useMemo)(()=>(function(e){let t=eG(e),r=e.trace_data?.spans??e.data.spans,i={},o={};r.forEach(e=>{let t=ez(e);i[t]=e,o[t]=[]}),r.forEach(e=>{let t=ez(e),r=e$(e);if(r){if(!o[r])throw Error("Tree structure is malformed!");o[r].push(t)}});let a=r.find(e=>!e$(e));if((0,G.isNil)(a))return null;return function r(s){let l=i[s],c=Number(eH(a)),d=Number(eK(a)),u=o[s].map(r),p=(e=>{let t=[];t=ej(e)?e.assessments??[]:eV(e.tags);let r=(0,G.keyBy)(t,"assessment_id");Object.values(r).forEach(e=>{if(e.overrides){let t=r[e.overrides];e.overriddenAssessment=t}});let n=(t=Object.values(r)).reduce((e,t)=>{let r=t.span_id??"";return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(n).forEach(e=>{n[e].sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())}),n})(e.info);if(eW(l)||"parent_id"in l)return((e,t,r,i,o,a)=>{let s=eU(e.attributes?.["mlflow.spanType"]),l=eU(e.attributes?.["mlflow.spanInputs"]),c=eU(e.attributes?.["mlflow.spanOutputs"]),d=e$(e),u=ez(e),p=o[u]??[];d||p.push(...o[""]??[]);let m=((e,t,r)=>{if(Array.isArray(e)&&e.every(e9))return(0,G.compact)(e.map(tl));let n=tn(t)??[],i=tn(r)??[];if(0===n.length||0===i.length)return;return n.concat(i)})(eU(e.attributes?.["mlflow.chat.messages"]),l,c),f=((e,t)=>{if(Array.isArray(e)&&e.every(e6))return e;if(Array.isArray(t?.tools)&&t?.tools?.every(e6))return t.tools})(eU(e.attributes?.["mlflow.chat.tools"]),l),g=(0,G.mapValues)((0,G.omitBy)(e.attributes,(e,t)=>t.startsWith("mlflow.")),e=>eU(e)),h=e.events,y=(Number(eH(e))-t)/1e3,E=(Number(eK(e)??r)-t)/1e3;return{title:e.name,icon:(0,n.Y)(ek,{type:eF(s),hasException:e1(e)>0,isRootSpan:!d}),type:s,key:u,start:y,end:E,children:i,inputs:l,outputs:c,attributes:g,events:h,chatMessages:m,chatTools:f,parentId:d,assessments:p,traceId:a}})(l,c,d,u,p,t);let m=l.span_type??ey.UNKNOWN;return{title:l.name,icon:(0,n.Y)(ek,{type:eF(m)}),type:m,key:l.context.span_id,start:Number(l.start_time)-c,end:Number(l.end_time??d)-c,children:u,inputs:l.inputs,outputs:l.outputs,attributes:l.attributes,events:l.events,parentId:l.parent_id??l.parent_span_id,assessments:[],traceId:t}}(ez(a))})(t),[t]),c=(0,i.useMemo)(()=>l?tw([l]):{},[l]),d=function e(t,r){if((0,G.isNil)(r)||(0,G.isNil)(t))return;if(t.key===r)return t;for(let n of t.children??[]){let t=e(n,r);if(t)return t}}(l,o)??l??void 0,u=(d?.assessments?.length??0)>0,[p,m]=(0,i.useState)(r),[f,g]=(0,i.useState)(d),[h,y]=(0,i.useState)(f?.chatMessages?"chat":"content"),[E,v]=(0,i.useState)(!1),[x,b]=(0,i.useState)(u),T=(0,i.useMemo)(()=>({rootNode:l,nodeMap:c,activeView:p,setActiveView:m,activeTab:h,setActiveTab:y,selectedNode:f,setSelectedNode:g,showTimelineTreeGantt:E,setShowTimelineTreeGantt:v,assessmentsPaneExpanded:x,setAssessmentsPaneExpanded:b,assessmentsPaneEnabled:a}),[p,c,h,l,f,E,v,x,b,a]);return(0,n.Y)(tD.Provider,{value:T,children:s})},tP=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}};var tF=r(23535),tU=r(84301),tB=r(81959);let tj="yellow500",tW="yellow200",tz=e=>{let{searchFilter:t,data:r,activeMatch:o,containsActiveMatch:s}=e,{theme:l}=(0,a.wn)(),c=(0,i.useCallback)(e=>{e?.scrollIntoView({block:"nearest",inline:"nearest"})},[]),d=(0,i.useMemo)(()=>{if(!t)return[];return(e=>{let{searchFilter:t,data:r,activeMatchBackgroundColor:i,inactiveMatchBackgroundColor:o,containsActiveMatch:a,activeMatch:s,scrollToActiveMatch:l}=e,c=RegExp(`(${(0,G.escapeRegExp)(t.trim())})`,"gi"),d=r.split(c),u=[],p=0;for(let e=0;e<d.length;e++)if(d[e].toLowerCase().includes(t.toLowerCase().trim())){let t=a&&s.matchIndex===p,r=t?i:o,c=(0,n.Y)("span",{ref:t?l:null,css:{backgroundColor:r,scrollMarginTop:50},children:d[e]},e);p++,u.push(c)}else u.push(d[e]);return u})({data:r,searchFilter:t,activeMatchBackgroundColor:l.colors[tj],inactiveMatchBackgroundColor:l.colors[tW],containsActiveMatch:s,activeMatch:o,scrollToActiveMatch:c})},[t,r,l,s,o,c]);return(0,n.Y)("pre",{css:{whiteSpace:"pre-wrap",backgroundColor:l.colors.backgroundSecondary,padding:l.spacing.sm,fontSize:l.typography.fontSizeSm},children:d})};var t$=r(86926),tH=r(27503),tK=r(51169),tG=r(68226),tV=r(33037),tZ=r(55738),tJ=r(96543),tq=r(73706),tX=r(22701),tQ=r(61986),t0=r(74675),t1=r(88179),t2=r(53322);let t3=(0,tg.AH)("margin-right:16px;text-align:right;position:absolute;right:0;padding-top:2px;padding-right:2px;");function t5(e){let{children:t,style:r}=e;return(0,n.Y)("div",{css:t3,style:r,children:t})}let t6=o().createContext({});function t4(e){let{children:t,theme:r={}}=e;return(0,n.Y)(t6.Provider,{value:r,children:t})}function t7(e){let{theme:t="light",actions:r,children:i,style:o}=e;return(0,n.FD)(n.FK,{children:[(0,n.Y)(t5,{style:o,children:(0,n.Y)(t4,{theme:"duotoneDark"===t?{color:"rgba(255, 255, 255, 0.84)",hoverColor:"#8ccbffcc",backgroundColor:"rgba(140, 203, 255, 0)",hoverBackgroundColor:"rgba(140, 203, 255, 0.08)"}:void 0,children:r})}),i]})}function t9(e){e.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:BASE64|PARSE_URL|UPPER|LOWER|INITCAP|FORMAT_NUMBER|FORMAT_STRING|TRIM|UNBASE64|CONCAT|MAP|MAP_KEYS|MAP_VALUES|MAP_ENTRIES|MAP_FILTER|MAP_FROM_ARRAYS|MAP_FROM_ENTRIES|MAP_ZIP_WITH|ARRAY|AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:COPY|DESCRIBE HISTORY|DESCRIBE DETAIL|STORAGE CREDENTIALS?|URL|CACHE|UNCACHE|VACUUM|MSCK|CATALOGS?|CREDENTIALS?|FILES?|RECIPIENTS?|PROVIDERS?|TBLPROPERTIES|SHARES|VIEWS|EXTERNAL|REPAIR|REFRESH|COMMENT|LIST|PARQUET|LOCATIONS?|OPTIONS|JAR|ARCHIVE|ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR|AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?/i,punctuation:/[;[\]()`,.]/}}t9.displayName="databricks-runtime-sql",t9.aliases=["sql","dbr-sql","dbsql","databricks-sql"],tZ.A.registerLanguage("sql",t9),tZ.A.registerLanguage("java",tX.A),tZ.A.registerLanguage("python",t1.A),tZ.A.registerLanguage("go",tJ.A),tZ.A.registerLanguage("javascript",tQ.A),tZ.A.registerLanguage("yaml",t2.A),tZ.A.registerLanguage("json",t0.A),tZ.A.registerLanguage("hcl",tq.A);let t8={light:{'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"'Menlo', 'Monaco', 'Consolas', 'Ubuntu Mono', 'Source Code Pro', monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"'Menlo', 'Monaco', 'Consolas', 'Ubuntu Mono', 'Source Code Pro', monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}},duotoneDark:{'code[class*="language-"]':{fontFamily:"'Menlo', 'Monaco', 'Consolas', 'Ubuntu Mono', 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', 'Courier New', 'Courier', 'Source Code Pro', monospace",fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:"'Menlo', 'Monaco', 'Consolas', 'Ubuntu Mono', 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', 'Courier New', 'Courier', 'Source Code Pro', monospace",fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}}};function re(e){let{theme:t="light",language:r,actions:i,style:o,children:a,...s}=e,l={border:"none",borderRadius:0,margin:0,padding:"24px",...o};return(0,n.Y)(t7,{theme:t,actions:i,children:(0,n.Y)(tZ.A,{language:r,style:t8[t],customStyle:l,codeTagProps:{style:(0,G.pick)(o,"backgroundColor")},...s,children:a})})}var rt=r(97255);function rr(e){return e&&`${e} !important`}function rn(e){let{tooltipMessage:t,...r}=e,{color:o,hoverColor:a,hoverBackgroundColor:s,backgroundColor:l,borderColor:c}=(0,i.useContext)(t6),d=(0,tg.AH)({zIndex:1,color:rr(o),borderColor:rr(c),backgroundColor:rr(l),":hover":{color:rr(a),backgroundColor:rr(s)}});return(0,n.Y)(rt.p,{title:t,children:(0,n.Y)(tT.$n,{componentId:"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_33",...r,css:d})})}var ri=r(67825),ro=r(39902),ra=r(65737);function rs(e){let{copyText:t,onClick:r,...o}=e,{actionIcon:a,tooltipMessage:s,copy:c}=function(e,t,r){let o=(0,l.tz)(),a=o.formatMessage({id:"hBAhI8",defaultMessage:"Copy"}),s=o.formatMessage({id:"g4hHzO",defaultMessage:"Copied"}),c=(0,ri.useClipboard)(),d=(0,i.useRef)(),[u,p]=(0,i.useState)(!1),[m,f]=(0,i.useState)(!1);return(0,i.useEffect)(()=>()=>{window.clearTimeout(d.current)},[]),{actionIcon:u?(0,n.Y)(ro.A,{}):(0,n.Y)(ra.A,{}),tooltipMessage:u?s:a,copy:()=>{c.copy(e),window.clearTimeout(d.current),p(!0),d.current=window.setTimeout(()=>{p(!1)},3e3)},copied:u,ariaLabel:a,tooltipOpen:m||u,handleTooltipOpenChange:f}}(t);return(0,n.Y)(rn,{tooltipMessage:s,icon:a,onClick:e=>{c(),r?.(e)},...o})}let rl=e=>{let{children:t,href:r}=e,i=function(e){let t=function(e){if(!(0,T.W)("databricks.fe.genai.markdownPDFPreview.enable",!1))return null;try{let t=new URL(e),r=t.pathname.match(/^\/ajax-api\/2\.0\/fs\/files\/(Volumes\/[^/]+\/[^/]+\/[^/]+)\/(.+\.pdf)$/);if(r){let e=t.searchParams.get("page"),n=e?parseInt(e):NaN;return{volumePath:r[1],filename:r[2],page:isNaN(n)?void 0:n}}}catch{}return null}(e);if(t)return{type:"pdf",href:e,filename:t.filename,volumePath:t.volumePath,page:t.page};return{type:"url",href:e}}(r??""),o=i.type;switch(o){case"pdf":return(0,n.Y)("p",{"data-testid":"pdf-link",children:"WIP"});case"url":let{href:a}=i;return(0,n.Y)(tb.o.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:a,id:a?.startsWith("#user-content-fn-")?a.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:a?.startsWith("."),children:a?.startsWith("#user-content-fn-")?(0,n.FD)(n.FK,{children:["[",t,"]"]}):t,openInNewTab:!(a&&a.startsWith("#"))});default:return console.warn(`Expected ${o} to be never`),null}};var rc=r(87173),rd=r(17701);let ru=()=>(0,T.W)("databricks.fe.genai.enable-virtualized-markdown-tables",!1),rp=e=>{let{children:t}=e;return(0,n.Y)("div",{"data-testid":"basic-table",css:{overflow:"auto"},children:(0,n.Y)(rd.X,{scrollable:!0,css:{height:"auto",minHeight:"initial",display:"inline-flex",minWidth:"100%",zIndex:0},children:t})})},rm=e=>{let{children:t,node:r}=e,{header:i,rows:a,isValid:s}=function(e){let{children:t}=e;if(!t)return{header:void 0,rows:[],isValid:!1};let r=o().Children.toArray(t);return{header:r[0]??void 0,rows:r.slice(1).flatMap(e=>{if(o().isValidElement(e))return o().Children.toArray(e.props.children).filter(e=>o().isValidElement(e));return[]}),isValid:!0}}({children:t,node:r});if(!s)return(0,n.Y)(rp,{children:t,node:r});return ru()?(0,n.Y)(rf,{header:i,rows:a}):(0,n.Y)(rp,{children:t,node:r})},rf=e=>{let{header:t,rows:r}=e,{theme:i}=(0,a.wn)(),s=o().useRef(null),{virtualItems:l,totalSize:c}=(0,rc.z)({size:r.length,parentRef:s,overscan:20});return(0,n.Y)("div",{"data-testid":"virtualized-table",ref:s,css:{overflow:"auto",maxHeight:420,border:"1px solid",borderColor:i.colors.border,borderRadius:i.borders.borderRadiusMd,marginBottom:i.spacing.md,zIndex:0},children:(0,n.FD)(rd.X,{css:{height:"auto",minHeight:"initial",display:"inline-flex",minWidth:"100%"},children:[t,(0,n.Y)("div",{css:{position:"relative",height:`${c}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},children:l.map(e=>{let t=e.index,i=r[t];return(0,n.Y)("div",{ref:e.measureRef,css:{position:"absolute",top:`${e.start}px`,width:"100%"},children:i},t)})})]})})},rg=e=>{let{children:t,node:r}=e,i=r?.children.some(e=>"th"===e.tagName),{theme:o}=(0,a.wn)();return(0,n.Y)(tK.H,{style:i?{position:"sticky",top:0,zIndex:1,backgroundColor:o.colors.backgroundPrimary}:void 0,children:t,isHeader:i})},rh=e=>{let{children:t,node:r}=e,i=r?.tagName==="th",{theme:o}=(0,a.wn)();if(i)return(0,n.Y)(tG.A,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:{paddingLeft:o.spacing.sm,borderColor:o.colors.border,color:o.colors.textPrimary},children:t});return(0,n.Y)(tV.n,{children:t})},ry=e=>{let t=(0,i.useMemo)(()=>rT({extensions:e.components}),[e.components]);return(0,n.Y)(t$.oz,{components:t,remarkPlugins:rb,children:e.children})},rE=e=>{let{codeBlock:t,codeInline:r,node:n,...i}=e,a=o().useMemo(()=>{let e=/language-(\w+)/.exec(i.className??"");return e&&e[1]?e[1]:void 0},[i.className]);if(n?.position?.start.line===n?.position?.end.line)return o().createElement(r,i);return o().createElement(t,{...i,language:a})},rv=e=>{let{children:t}=e;return(0,n.Y)(tb.o.Text,{code:!0,children:t})},rx=o().memo(e=>{let{children:t,language:r}=e,{theme:i}=(0,a.wn)(),o=String(t).replace(/\n$/,"");return(0,n.Y)("div",{css:{position:"relative"},children:(0,n.Y)(re,{actions:(0,n.Y)(rs,{componentId:"genai.util.markdown-copy-code-block",copyText:o}),theme:i.isDarkMode?"duotoneDark":"light",children:o,language:r&&r_(r)?r:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})}),rb=[tH.A],rT=e=>({a:e=>{let{href:t,children:r}=e;return(0,n.Y)(rl,{href:t,children:r})},code:t=>(0,n.Y)(rE,{...t,codeBlock:e.extensions?.codeBlock??rx,codeInline:e.extensions?.codeInline??rv}),p:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Paragraph,{children:t})},h1:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Title,{level:1,children:t})},h2:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Title,{level:2,children:t})},h3:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Title,{level:3,children:t})},h4:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Title,{level:4,children:t})},h5:e=>{let{children:t}=e;return(0,n.Y)(tb.o.Title,{level:5,children:t})},table:e=>{let{children:t,node:r}=e;return(0,n.Y)(rm,{children:t,node:r})},tr:e=>{let{children:t,node:r}=e;return ru()?(0,n.Y)(rg,{children:t,node:r}):(0,n.Y)(tK.H,{children:t,isHeader:r?.children.some(e=>"th"===e.tagName)})},th:e=>{let{children:t,node:r}=e;return ru()?(0,n.Y)(rh,{children:t,node:r}):(0,n.Y)(tG.A,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_90",children:t})},td:e=>{let{children:t}=e;return(0,n.Y)(tV.n,{children:t,multiline:!0})},thead:e=>{let{children:t}=e;return(0,n.Y)(n.FK,{children:t})},tbody:e=>{let{children:t}=e;return(0,n.Y)(n.FK,{children:t})},img:e=>{let{src:t,alt:r}=e;return(0,n.Y)("img",{src:t,alt:r,css:{maxWidth:"100%"}})}}),r_=e=>{switch(e){case"go":case"hcl":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}};function rS(e){let{data:t,searchFilter:r="",activeMatch:o=null,containsActiveMatch:s=!1,renderMode:c=ex.JSON}=e,d=!!r&&!(0,G.isNil)(o)&&t.toLowerCase().includes(r),{theme:u}=(0,a.wn)(),[p,m]=(0,i.useState)("json"===c),[f,g]=(0,i.useState)(d),h=(0,i.useRef)(null),y=(0,i.useMemo)(()=>{if("json"===c)return t;let e=JSON.parse(t);if((0,G.isString)(e))return e;return t},[t,c]),E=p||y.split("\n").length>4||y.length>300,v=(0,i.useMemo)(()=>{if(E&&!f){let e=y.split("\n").slice(0,4).join("\n");return e.length>300?e.slice(0,300):e}return y},[y,E,f]);(0,i.useEffect)(()=>{h.current&&m(h.current.scrollWidth>h.current.clientWidth)},[t]);let x=(0,i.useCallback)(e=>(0,n.Y)("pre",{...e,ref:h}),[]);if(d)return(0,n.Y)(tz,{data:t,searchFilter:r,activeMatch:o,containsActiveMatch:!o.isKeyMatch&&s});return(0,n.FD)("div",{css:{position:"relative"},children:["markdown"===c?(0,n.Y)("div",{css:{padding:u.spacing.md,backgroundColor:u.colors.backgroundSecondary,marginBottom:-u.spacing.md},children:(0,n.Y)(ry,{children:v})}):(0,n.FD)(n.FK,{children:[(0,n.Y)(rs,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:t,size:"small",css:{position:"absolute",top:u.spacing.xs,right:u.spacing.xs,zIndex:1}},"copy-snippet"),(0,n.Y)(re,{PreTag:x,showLineNumbers:!0,language:c,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:f,theme:u.isDarkMode?"duotoneDark":"light",style:{backgroundColor:u.colors.backgroundSecondary,padding:u.spacing.sm,paddingBottom:E?0:u.spacing.sm,paddingRight:2*u.spacing.md,overflow:f?"auto":"hidden",textOverflow:"ellipsis",fontSize:u.typography.fontSizeSm,lineHeight:u.typography.lineHeightBase},children:v})]}),E&&(0,n.Y)("div",{css:{backgroundColor:u.colors.backgroundSecondary},children:(0,n.Y)(tT.$n,{css:{width:"100%",padding:0},componentId:f?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:f?(0,n.Y)(t_.A,{}):(0,n.Y)(tS.A,{}),type:"tertiary",onClick:()=>g(!f),children:f?(0,n.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,n.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}let rI=e=>{let{title:t,searchFilter:r,isActiveMatch:o}=e,{theme:s}=(0,a.wn)(),l=(0,i.useCallback)(e=>{e?.scrollIntoView({block:"nearest",inline:"nearest"})},[]),c=t.toLowerCase();if(!c.includes(r))return(0,n.Y)("div",{children:t});let d=c.indexOf(r),u=d+r.length,p=o?s.colors[tj]:s.colors[tW];return(0,n.FD)("div",{children:[t.slice(0,d),(0,n.Y)("span",{ref:o?l:null,css:{backgroundColor:p,scrollMarginTop:50},children:t.slice(d,u)}),t.slice(u)]})};function rA(e,t){if(t)return t;if(e)return ex.MARKDOWN;return ex.JSON}function rR(e){switch(e){case ex.JSON:return"JSON";case ex.TEXT:return"Text";case ex.MARKDOWN:return"Markdown"}}function rY(e){let{title:t,tokens:r,data:o,searchFilter:s="",activeMatch:l=null,containsActiveMatch:c=!1,initialRenderMode:d}=e,u=(0,i.useMemo)(()=>JSON.parse(o),[o]),p=(0,G.isString)(u),{theme:m}=(0,a.wn)(),[f,g]=(0,i.useState)(rA(p,d)),h=c&&(l?.isKeyMatch??!1),y=p&&!s;return(0,i.useEffect)(()=>{g(rA(p,d))},[p,d]),(0,n.Y)("div",{css:{position:"relative"},children:(0,n.FD)("div",{css:{borderRadius:m.borders.borderRadiusSm,border:`1px solid ${m.colors.border}`,overflow:"hidden"},children:[(t||y)&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:m.spacing.sm},children:[(0,n.Y)(tb.o.Title,{css:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},level:4,color:"secondary",withoutMargins:!0,children:(0,n.Y)(rI,{title:t,searchFilter:s,isActiveMatch:h})}),(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center"},children:y&&(0,n.FD)(tU.Root,{children:[(0,n.Y)(tU.Trigger,{asChild:!0,children:(0,n.Y)(tB.v,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:{height:"min-content",margin:0},children:(0,n.FD)("div",{css:{paddingLeft:m.spacing.xs,marginRight:m.spacing.xs,cursor:"pointer"},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:rR(f)}),(0,n.Y)(tS.A,{})]})})}),(0,n.FD)(tU.Content,{children:[(0,n.Y)(tU.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:f,onValueChange:e=>g(e),children:Object.values(ex).map(e=>(0,n.FD)(tU.RadioItem,{value:e,children:[(0,n.Y)(tU.ItemIndicator,{}),rR(e)]},e))}),(0,n.Y)(tU.Arrow,{})]})]})})]}),(0,n.Y)(rS,{data:o,searchFilter:s,activeMatch:l,containsActiveMatch:c,renderMode:f})]})})}function rw(e){let{activeSpan:t,searchFilter:r,activeMatch:i}=e,{theme:o}=(0,a.wn)(),{attributes:s}=t,c=(0,G.keys)(s).length>0,d=!(0,G.isNil)(i)&&i.span.key===t.key;if(!c||(0,G.isNil)(s))return(0,n.Y)("div",{css:{marginTop:o.spacing.md},children:(0,n.Y)(tF.S,{description:(0,n.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})});return(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm,padding:o.spacing.md},children:Object.entries(s).map(e=>{let[t,o]=e;return(0,n.Y)(rY,{title:t,data:JSON.stringify(o,null,2),searchFilter:r,activeMatch:i,containsActiveMatch:d&&"attributes"===i.section&&i.key===t},t)})})}var rN=r(97831);function rM(e){let{paramName:t,paramProperties:r,isRequired:i}=e,{theme:o}=(0,a.wn)(),{type:s,description:c,enum:d}=r,u=s||c||d,p=u?{borderTopLeftRadius:o.borders.borderRadiusMd,borderTopRightRadius:o.borders.borderRadiusMd,borderBottom:`1px solid ${o.colors.border}`}:{borderRadius:o.borders.borderRadiusMd};return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",width:"100%",borderRadius:o.borders.borderRadiusMd,border:`1px solid ${o.colors.border}`},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:o.colors.backgroundSecondary,padding:`${o.spacing.sm}px ${o.spacing.md}px`,gap:o.spacing.sm,...p},children:[(0,n.Y)(tb.o.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:t}),i&&(0,n.Y)(tb.o.Text,{withoutMargins:!0,color:"error",children:(0,n.Y)(l.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,n.FD)("div",{css:{display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:o.spacing.md,padding:`${o.spacing.sm}px ${o.spacing.md}px`},children:[s&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{withoutMargins:!0,bold:!0,children:(0,n.Y)(l.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,n.Y)(tb.o.Text,{withoutMargins:!0,code:!0,children:s})]}),c&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{withoutMargins:!0,bold:!0,children:(0,n.Y)(l.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,n.Y)(tb.o.Text,{withoutMargins:!0,children:c})]}),d&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{withoutMargins:!0,bold:!0,children:(0,n.Y)(l.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",gap:o.spacing.sm,flexWrap:"wrap"},children:d.map(e=>(0,n.Y)(tb.o.Text,{withoutMargins:!0,code:!0,children:e},e))})]})]})]})}function rC(e){let{tool:t}=e,{theme:r}=(0,a.wn)(),[o,s]=(0,i.useState)(!1),l=t.function.description,c=t.function.parameters?.properties,d=t.function.parameters?.required??[],u=l||c,p=u?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusMd,border:`1px solid ${r.colors.border}`,backgroundColor:r.colors.backgroundPrimary},"data-testid":"model-trace-explorer-chat-tool",children:[(0,n.FD)("div",{role:"button",css:{display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center",borderBottom:u&&o?`1px solid ${r.colors.border}`:"none",padding:r.spacing.sm,...p},onClick:()=>s(!o),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[u&&(o?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{})),(0,n.Y)(tb.o.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:t.function.name})]}),u&&o&&(0,n.FD)("div",{css:{padding:r.spacing.sm},children:[l&&(0,n.Y)(tb.o.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:r.spacing.sm,padding:`0px ${r.spacing.xs}px`},children:t.function.description}),c&&(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.sm},children:Object.keys(c).map(e=>(0,n.Y)(rM,{paramName:e,paramProperties:c[e],isRequired:d.includes(e)},e))})]})]})}var rO=r(92715);let rD=e=>{switch(e.role){case"system":return(0,n.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,n.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,n.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":if(e.name)return e.name;return(0,n.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,n.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}},rk=e=>{let{isExpandable:t,expanded:r,setExpanded:i,message:o}=e,{theme:s}=(0,a.wn)(),c=t?{":hover":{backgroundColor:s.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,n.FD)("div",{role:"button",css:{display:"flex",flexDirection:"row",alignItems:"center",padding:s.spacing.sm,gap:s.spacing.sm,...c},onClick:()=>i(!r),children:[t&&(r?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{})),(e=>{switch(e){case"system":return(0,n.Y)(ek,{type:eE.SYSTEM});case"user":return(0,n.Y)(ek,{type:eE.USER});case"tool":case"function":return(0,n.Y)(ek,{type:eE.WRENCH});default:return(0,n.Y)(ek,{type:eE.MODELS})}})(o.role),o.tool_call_id?(0,n.Y)(tb.o.Text,{color:"secondary",css:{whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",flex:1,minWidth:0},children:(0,n.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,n.Y)(tb.o.Text,{css:{marginRight:s.spacing.xs},bold:!0,children:rD(o)}),toolCallId:(0,n.Y)(rO.m,{componentId:"test",content:o.tool_call_id,children:(0,n.Y)("div",{css:{display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:s.spacing.xs},children:(0,n.Y)(tb.o.Text,{css:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},code:!0,children:o.tool_call_id})})})}})}):(0,n.Y)(tb.o.Text,{bold:!0,children:rD(o)})]})};function rL(e){let{toolCall:t}=e,{theme:r}=(0,a.wn)();return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.sm},children:[(0,n.Y)(tb.o.Text,{color:"secondary",css:{display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${r.spacing.sm+r.spacing.xs}px`},children:(0,n.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,n.FD)(tB.v,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:{margin:`0px ${r.spacing.xs}px`},children:[(0,n.Y)(eI.A,{}),(0,n.Y)(tb.o.Text,{css:{whiteSpace:"nowrap",marginLeft:r.spacing.xs},children:t.function.name})]}),toolCallId:(0,n.Y)(rO.m,{componentId:"test",content:t.id,children:(0,n.Y)("div",{css:{display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},children:(0,n.Y)(tb.o.Text,{css:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},code:!0,color:"secondary",children:t.id})})})}})}),(0,n.Y)(rS,{data:t.function.arguments})]},t.id)}function rP(e){let{content:t,shouldDisplayCodeSnippet:r}=e,{theme:i}=(0,a.wn)();if(!t)return null;if(r)return(0,n.Y)(rS,{data:t,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:ex.JSON});return(0,n.Y)("div",{css:{padding:i.spacing.sm,paddingTop:0,marginBottom:-i.typography.fontSizeBase},children:(0,n.Y)(ry,{children:t})})}function rF(e){let{message:t,className:r}=e,{theme:o}=(0,a.wn)(),[s,c]=(0,i.useState)(!1),{content:d,isJson:u}=(e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}})(t.content??""),p=u&&("tool"===t.role||"function"===t.role),m=!p&&d.length>300,f=m&&!s?`${d.slice(0,300)}...`:d;return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",width:"100%",borderRadius:o.borders.borderRadiusSm,border:`1px solid ${o.colors.border}`,backgroundColor:o.colors.backgroundPrimary,overflow:"hidden"},className:r,children:[(0,n.Y)(rk,{isExpandable:m,expanded:s,setExpanded:c,message:t}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm},children:[!(0,G.isNil)(t.tool_calls)&&t.tool_calls.map(e=>(0,n.Y)(rL,{toolCall:e},e.id)),(0,n.Y)(rP,{content:f,shouldDisplayCodeSnippet:p})]}),m&&(0,n.Y)(tT.$n,{componentId:s?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:s?(0,n.Y)(t_.A,{}):(0,n.Y)(tS.A,{}),type:"tertiary",onClick:()=>c(!s),css:{display:"flex",width:"100%",padding:o.spacing.md,borderRadius:"0px !important"},children:s?(0,n.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,n.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function rU(e){let{messages:t}=e,{theme:r}=(0,a.wn)();if((0,G.isNil)(t))return null;return(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.sm},children:t.map((e,t)=>(0,n.Y)(rF,{message:e},t))})}let rB=e=>{let{sectionKey:t,title:r,children:o,withBorder:s=!1,className:l}=e,[c,d]=(0,i.useState)(!0),{theme:u}=(0,a.wn)();return(0,n.FD)("div",{className:l,css:{display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},children:[(0,n.FD)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:s?u.spacing.sm:0,background:s?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:c?0:u.borders.borderRadiusMd,borderBottomRightRadius:c?0:u.borders.borderRadiusMd,border:s?`1px solid ${u.colors.border}`:void 0,marginBottom:s?0:u.spacing.sm},children:[(0,n.Y)(tT.$n,{size:"small",componentId:`shared.model-trace-explorer.expand-${t}`,type:"tertiary",icon:c?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),onClick:()=>d(!c)}),(0,n.Y)(tb.o.Title,{withoutMargins:!0,level:4,css:{width:"100%"},children:r})]}),c&&(0,n.Y)("div",{css:{border:s?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:s?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:s?u.borders.borderRadiusMd:void 0,padding:s?u.spacing.sm:0},children:o})]})};function rj(e){let{chatMessages:t,chatTools:r}=e,{theme:i}=(0,a.wn)();return(0,n.FD)("div",{css:{overflowY:"auto",padding:i.spacing.md},"data-testid":"model-trace-explorer-chat-tab",children:[r&&(0,n.Y)(rB,{css:{marginBottom:i.spacing.sm},title:(0,n.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:i.spacing.sm},children:r.map(e=>(0,n.Y)(rC,{tool:e},e.function.name))})}),(0,n.Y)(rB,{title:(0,n.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,n.Y)(rU,{messages:t})})]})}function rW(e){let{activeSpan:t,className:r,searchFilter:o,activeMatch:s}=e,{theme:c}=(0,a.wn)(),d=(0,i.useMemo)(()=>eq(t?.inputs),[t]),u=(0,i.useMemo)(()=>eq(t?.outputs),[t]);if((0,G.isNil)(t))return null;let p=d.length>0,m=u.length>0,f=!(0,G.isNil)(s)&&s.span.key===t.key;return(0,n.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[p&&(0,n.Y)(rB,{withBorder:!0,css:{marginBottom:c.spacing.sm},sectionKey:"input",title:(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"},children:(0,n.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:c.spacing.sm},children:d.map((e,t)=>{let{key:r,value:i}=e;return(0,n.Y)(rY,{title:r,data:i,searchFilter:o,activeMatch:s,containsActiveMatch:f&&"inputs"===s.section&&s.key===r},r||t)})})}),m&&(0,n.Y)(rB,{withBorder:!0,sectionKey:"output",title:(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%"},children:(0,n.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:c.spacing.sm},children:u.map(e=>{let{key:t,value:r}=e;return(0,n.Y)(rY,{title:t,data:r,searchFilter:o,activeMatch:s,containsActiveMatch:f&&"outputs"===s.section&&s.key===t},t)})})})]})}let rz=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},r$=e=>{let{itemKey:t,itemValue:r,charLimit:i=18,maxWidth:o=150,className:a}=e,{shouldTruncateKey:s,shouldTruncateValue:l}=function(e,t,r){let n=e.length+t.length,i=e.length>t.length,o=i?t.length:e.length;if(n<=r)return{shouldTruncateKey:!1,shouldTruncateValue:!1};if(o>r/2)return{shouldTruncateKey:!0,shouldTruncateValue:!0};return{shouldTruncateKey:i,shouldTruncateValue:!i}}(t,r,i);return(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${t}: ${r}`,children:(0,n.Y)(tB.v,{componentId:"shared.model-trace-explorer.key-value-tag",className:a,children:(0,n.FD)("span",{css:{maxWidth:o,display:"inline-flex"},children:[(0,n.Y)(tb.o.Text,{bold:!0,css:rz(s),size:"sm",children:t}),":\xa0",(0,n.Y)(tb.o.Text,{css:rz(l),size:"sm",children:r})]})})})};function rH(e){let{text:t,metadataTags:r,setExpanded:i,logDocumentClick:o}=e,{theme:s}=(0,a.wn)();return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column"},children:[(0,n.Y)("div",{role:"button",onClick:()=>{i(!1),o?.("collapse")},css:{display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${s.spacing.sm}px ${s.spacing.md}px`,height:s.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:s.colors.backgroundSecondary}},children:(0,n.Y)(eT.A,{})}),(0,n.Y)("div",{css:{padding:s.spacing.md,paddingBottom:0},children:(0,n.Y)(ry,{children:t})}),(0,n.Y)("div",{css:{padding:s.spacing.md,paddingTop:0},children:r.map(e=>{let{key:t,value:r}=e;return(0,n.Y)(r$,{itemKey:t,itemValue:r},t)})}),(0,n.Y)(tT.$n,{css:{width:"100%",padding:s.spacing.sm},componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,n.Y)(t_.A,{}),type:"tertiary",onClick:()=>i(!1),children:(0,n.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}function rK(e){let{text:t,metadataTags:r,setExpanded:i,logDocumentClick:o}=e,{theme:s}=(0,a.wn)();return(0,n.FD)("div",{role:"button",onClick:()=>{i(!0),o?.("expand")},css:{display:"flex",flexDirection:"row",padding:`${s.spacing.sm}px ${s.spacing.md}px`,gap:s.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:s.colors.backgroundSecondary}},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",gap:s.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},children:[(0,n.Y)(eT.A,{}),(0,n.Y)(tb.o.Text,{ellipsis:!0,size:"md",children:t})]}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",gap:s.spacing.sm},children:[r.length>0?(0,n.Y)(r$,{css:{margin:0},itemKey:r[0].key,itemValue:r[0].value}):null,r.length>1?(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:r.slice(1).map(e=>{let{key:t,value:r}=e;return(0,n.Y)("span",{css:{display:"inline-block"},children:`${t}: ${r}`},t)}),children:(0,n.FD)(tB.v,{componentId:"shared.model-trace-explorer.tag-count",css:{whiteSpace:"nowrap",margin:0},children:["+",r.length-1]})}):null]})]})}function rG(e){let{text:t,metadata:r}=e,[o,a]=(0,i.useState)(!1),s=eq(r),l=K(),c=er(),d=(0,i.useCallback)(e=>{O(l,c,{eventType:"component_click",eventEntity:{entityType:"component",entitySubType:"div",entityId:`shared.model-trace-explorer.retriever-document-${e}`},eventPayload:{interactionSubject:!0}})},[l,c]);return o?(0,n.Y)(rH,{text:t,metadataTags:s,setExpanded:a,logDocumentClick:d}):(0,n.Y)(rK,{text:t,metadataTags:s,setExpanded:a,logDocumentClick:d})}var rV=r(5895),rZ=r(99090),rJ=r(75319);function rq(e){let{shouldRenderMarkdown:t,setShouldRenderMarkdown:r}=e,{theme:i}=(0,a.wn)();return(0,n.FD)(rV.d,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!t}`,value:t,onChange:e=>{r(e.target.value)},children:[(0,n.Y)(rV.E,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,n.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,n.Y)("div",{css:{display:"flex",alignItems:"center"},children:(0,n.Y)(rZ.A,{css:{fontSize:i.typography.fontSizeLg}})})})}),(0,n.Y)(rV.E,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,n.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,n.Y)("div",{css:{display:"flex",alignItems:"center"},children:(0,n.Y)(rJ.A,{css:{fontSize:i.typography.fontSizeLg}})})})})]})}function rX(e){let{activeSpan:t,className:r,searchFilter:o,activeMatch:s}=e,{theme:c}=(0,a.wn)(),[d,u]=(0,i.useState)(!0),p=(0,i.useMemo)(()=>eq(t.inputs),[t]),m=t.outputs,f=p.length>0,g=!(0,G.isNil)(s)&&s.span.key===t.key,h=g&&"outputs"===s.section;return(0,n.FD)("div",{className:r,"data-testid":"model-trace-explorer-retriever-span-view",children:[f&&(0,n.Y)(rB,{sectionKey:"input",css:{marginBottom:c.spacing.sm},title:(0,n.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:c.spacing.sm},children:p.map((e,t)=>{let{key:r,value:i}=e;return(0,n.Y)(rY,{title:r,data:i,searchFilter:o,activeMatch:s,containsActiveMatch:g&&"inputs"===s.section&&s.key===r},r||t)})})}),(0,n.Y)(rB,{sectionKey:"output",title:(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",gap:c.spacing.sm},children:[(0,n.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,n.Y)(tB.v,{componentId:"shared.model-trace-explorer.document-count",children:m.length})]}),!h&&(0,n.Y)(rq,{shouldRenderMarkdown:d,setShouldRenderMarkdown:u})]}),children:d&&!h?(0,n.Y)("div",{css:{border:`1px solid ${c.colors.border}`,borderRadius:c.legacyBorders.borderRadiusMd},children:m.map((e,t)=>(0,n.Y)("div",{css:{borderBottom:t!==m.length-1?`1px solid ${c.colors.border}`:""},children:(0,n.Y)(rG,{text:e.page_content,metadata:e.metadata},t)},t))}):(0,n.Y)("div",{css:{border:`1px solid ${c.colors.border}`,borderRadius:c.legacyBorders.borderRadiusMd,padding:c.spacing.md},children:(0,n.Y)(rY,{title:"",data:JSON.stringify(m,null,2),searchFilter:o,activeMatch:s,containsActiveMatch:g&&"outputs"===s.section})})})]})}function rQ(e){let{activeSpan:t,className:r,searchFilter:i,activeMatch:o}=e,{theme:s}=(0,a.wn)();if(!(0,G.isNil)(t)&&t.type===ey.RETRIEVER&&Array.isArray(t.outputs)&&t.outputs.length>0&&(0,G.every)(t.outputs,eX))return(0,n.Y)("div",{css:{overflowY:"auto",padding:s.spacing.md},className:r,"data-testid":"model-trace-explorer-content-tab",children:(0,n.Y)(rX,{activeSpan:t,className:r,searchFilter:i,activeMatch:o})});return(0,n.Y)("div",{css:{overflowY:"auto",padding:s.spacing.md},className:r,"data-testid":"model-trace-explorer-content-tab",children:(0,n.Y)(rW,{activeSpan:t,className:r,searchFilter:i,activeMatch:o})})}var r0=r(39106);function r1(e){let{activeSpan:t,searchFilter:r,activeMatch:i}=e,{theme:o}=(0,a.wn)(),{events:s}=t,c=!(0,G.isNil)(i)&&i.span.key===t.key;if(!Array.isArray(s)||0===s.length)return(0,n.Y)("div",{css:{marginTop:o.spacing.md},children:(0,n.Y)(tF.S,{description:(0,n.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})});return(0,n.Y)("div",{css:{padding:o.spacing.md},children:s.map((e,t)=>{let a=e.attributes,s="exception"===e.name?(0,n.FD)(n.FK,{children:[(0,n.Y)(r0.A,{css:{marginRight:o.spacing.sm},color:"danger"}),(0,n.Y)(tb.o.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;if(!a)return null;return(0,n.Y)(rB,{sectionKey:e.name,title:s,withBorder:!0,children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm},children:Object.keys(a).map(o=>{let s=eQ(e.name,t,o);return(0,n.Y)(rY,{title:o,data:JSON.stringify(a[o],null,2),searchFilter:r,activeMatch:i,containsActiveMatch:c&&"events"===i.section&&i.key===s,initialRenderMode:ex.TEXT},s)})})},`${e.name}-${t}`)})})}function r2(e){let{count:t}=e,{theme:r}=(0,a.wn)();return(0,n.Y)("div",{css:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:r.typography.fontSizeBase,height:r.typography.fontSizeBase,backgroundColor:r.colors.actionDangerPrimaryBackgroundDefault,padding:r.spacing.xs,marginLeft:r.spacing.xs,boxSizing:"border-box"},children:(0,n.Y)("span",{css:{color:r.colors.actionPrimaryTextDefault,fontSize:11},children:t})})}var r3=r(6383);let r5=()=>{let{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:r}=tk();return(0,n.Y)(rV.d,{css:{display:"block"},name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,n.Y)(rV.E,{value:!0,disabled:!r,icon:(0,n.Y)(r3.A,{}),onClick:()=>t?.(!e),css:{"& > span":{display:"flex",alignItems:"center"}},children:!e&&(0,n.Y)(l.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var r6=r(12738),r4=r(16730),r7=r(33107),r9=r(19382),r8=r(94013),ne=r(61964),nt=r(4698),nr=r(21184),nn=r(68657),ni=r(11199);let no=Symbol();function na(e,t,r){let n,i=function(){for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];if(void 0===n&&(n=e()),!n)return t(...o);return r(...o)};return i[no]=function(){n=void 0},i}var ns=function(e){return e.AccountsConsoleMonolithUi="accounts-console-monolith-ui",e.DbsqlUi="dbsql-ui",e.JobsUi="jobs-ui",e.MonolithUi="monolith-ui",e.NotSet="not-set",e}({});let nl=o().createContext({uiDeployableId:"not-set"}),nc=(0,i.createContext)({currentUserActionError:null,handleError:()=>{},handlePromise:()=>{},clearUserActionError:()=>{},renderErrorAlert:()=>{},UNSAFE_logUserActionError:()=>{}});var nd=r(82723),nu=r(17629),np=r(65856),nm=r(18936),nf=r.n(nm),ng=r(87224),nh=r.n(ng),ny=r(27279),nE=r.n(ny),nv=r(10045),nx=r.n(nv),nb=function(e){return e.Axios="unifiedFetchData-axios",e.Fetch="unifiedFetchData-fetch",e}({}),nT=function(e){return e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e.PATCH="PATCH",e.HEAD="HEAD",e}({}),n_=function(e){return e.TEXT="TEXT",e.JSON="JSON",e.BLOB="BLOB",e.STREAM="STREAM",e}({}),nS=function(e){return e.EXPIRED_SESSION="expired-session",e.EXPIRED_CSRF_TOKEN="expired-csrf-token",e.JSON_PARSE="json-parse",e}({});let nI=(0,ep.fH)("Data::fetch");var nA=r(61479),nR=r(93614),nY=r(2140);let nw={EXPIRED_SESSION:"Fetch request failed due expired user session"};class nN extends nd.ZR{errorLogType=nA.ZQ.SessionError;isUserError=!0;displayMessage;errorName;constructor(e,t){super(t),this.displayMessage=(0,n.Y)(l.sA,{id:"c/KhOk",defaultMessage:"Your session have expired. Please refresh the page or login again."}),this.errorName=e}}class nM extends nd.ZR{errorLogType=nA.ZQ.UnknownError;errorName=nR.U.GenericFetchDataError;displayMessage;isUserError=!1;fetchErrorType;constructor(e){super(`Fetch request failed due to unexpected error: ${e}`),this.displayMessage=(0,n.Y)(l.sA,{id:"EprwHD",defaultMessage:"Fetch request failed due to unexpected error"}),this.fetchErrorType=e}}function nC(e,t){let{status:r,statusText:n,body:i,text:o,errorType:a,headers:s,url:l,redirected:c}=e;if(a){let e;switch(a){case nS.EXPIRED_CSRF_TOKEN:e=new nN(nR.U.CsrfTokenExpiredError,"Fetch request failed due to expired CSRF token");break;case nS.EXPIRED_SESSION:e=new nN(nR.U.SessionExpiredError,nw.EXPIRED_SESSION);break;default:e=new nM(a)}throw(0,nY.wV)(e,t),e}let d=new Response((0,T.W)("databricks.fe.wexp.enableStreamSupportAtMfeFetch",!0)&&null!=i&&!i.locked?i:o,{status:r,statusText:n,headers:new Headers(s)});return Object.defineProperty(d,"url",{value:l}),Object.defineProperty(d,"redirected",{value:c}),d}function nO(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let nD=()=>({ABORTED_MSG:"Aborted",NETWORK_ERROR_MSG:"Network Error",NETWORK_ERROR_CODE:"ERR_NETWORK"});function nk(e,t){let{status:r,statusText:n,text:i,blob:o,headers:a}=e;return{config:t,status:r,statusText:n,data:"blob"===t.responseType?o:i,headers:a}}let nL=e=>t=>{var r;return(r=function*(){let r=(0,T.W)("databricks.fe.infra.useCustomAxiosErrorProcessing",!1);try{let{method:n=nT.GET,data:i,headers:o,onUploadProgress:a}=t,s=yield nI.call({resource:function(e){let{url:t,baseURL:r,params:n,paramsSerializer:i}=e;d()(void 0!==t,"URL must be specified");let o=nh()(r,t);return nx()(o,n,i)}(t),options:{method:function(e){let t=e.toUpperCase();if(!Object.values(nT).includes(t))throw Error(`Fetch request method ${e} is not supported. Only ${Object.values(nT).join(", ")} are supported.`);return t}(n),body:i,responseFormat:"blob"===t.responseType?n_.BLOB:n_.TEXT,headers:o,onUploadProgress:a,requestContext:e}}),l=new Promise((e,n)=>{if(r){let r=nk(s,t);if(!s.ok){var i;let e=nC(s,function(e){if(e.__initiatorStack)return{stack:e.__initiatorStack};return{}}(t)),o=(i=(0,nd.Jg)(e),Object.defineProperties(i,{config:{value:r.config},isAxiosError:{value:!0},response:{value:r},toJSON:{value:()=>({})}}),i);n(o);return}e(r);return}return nE()(e,n,nk(s,t))});return p.iT.sev2BurnRate(m.Es.Navigation,nb.Axios,nu.i1.P999,nu.Ip.Min10,!0),l}catch(e){throw nK(e)&&(nV(e)?p.iT.log("unifiedFetchData-ignored-axios",m.Es.Navigation,e):p.iT.sev2BurnRate(m.Es.Navigation,nb.Axios,nu.i1.P999,nu.Ip.Min10,!1,e)),e}},function(){var e=this,t=arguments;return new Promise(function(n,i){var o=r.apply(e,t);function a(e){nO(o,n,i,a,s,"next",e)}function s(e){nO(o,n,i,a,s,"throw",e)}a(void 0)})})()},nP=nL();((e,t)=>{let r=e?nL(e):nP;return nf().create({...t,adapter:r}).interceptors.request.use(e=>(e.__initiatorStack=Error().stack,e))})();let nF={currentValue:!1};function nU(){return nF.currentValue}m.Es.DbsqlUi,ns.DbsqlUi,m.Es.WorkflowsAuthoring,ns.JobsUi,m.Es.UiInfra,ns.MonolithUi,m.Es.UiInfra,ns.NotSet,m.Es.CustomerPlatform,ns.AccountsConsoleMonolithUi,ns.AccountsConsoleMonolithUi,ns.DbsqlUi,ns.JobsUi,ns.MonolithUi,ns.NotSet;let nB="Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node",nj="Node.removeChild: The node to be removed is not a child of this node",nW="Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node",nz=[{prefix:["Fetch request failed due to expired CSRF token","Invalid CSRF token"],component:m.Es.UiInfra,eventId:"fetch-after-csrf-token-expired",minFailures:nu.Ip.Min100},{prefix:"Uncaught Error: Minified React error #188",component:m.Es.UiInfra,eventId:"react-error-188"},{prefix:"Uncaught Error: Minified React error #185",component:m.Es.UiInfra,eventId:"react-error-185"},{prefix:"Uncaught Error: Minified React error #311",component:m.Es.UiInfra,eventId:"react-error-311"},{prefix:"Fetch request failed due expired user session",component:m.Es.UiInfra,eventId:"fetch-after-session-expired",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:nB,component:m.Es.UiInfra,eventId:"remove-node-not-child",minFailures:nu.Ip.Min100,predicate:()=>!nU()},{prefix:nj,component:m.Es.UiInfra,eventId:"remove-node-not-child-firefox",minFailures:nu.Ip.Min100,predicate:()=>!nU()},{prefix:nW,component:m.Es.UiInfra,eventId:"insert-before-node-not-child",predicate:()=>!nU()},{prefix:nB,component:m.Es.UiInfra,eventId:"remove-node-not-child-google-translate",minFailures:nu.Ip.Min100,predicate:()=>nU()},{prefix:nj,component:m.Es.UiInfra,eventId:"remove-node-not-child-firefox-google-translate",minFailures:nu.Ip.Min100,predicate:()=>nU()},{prefix:nW,component:m.Es.UiInfra,eventId:"insert-before-node-not-child-google-translate",minFailures:nu.Ip.Min100,predicate:()=>nU()},{prefix:["Failed to fetch","TypeError: Error while fetching /config: Failed to fetch","TypeError: Failed to fetch","ui-flags fetch failed","TypeError: Error while fetching /ui-flags: Failed to fetch","NetworkError when attempting to fetch resource","TypeError: NetworkError when attempting to fetch resource","[Unknown error] TypeError: Failed to fetch"],component:m.Es.UiInfra,eventId:"failed-to-fetch",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"Request Failed",component:m.Es.UiInfra,eventId:"request-failed",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:["Load failed","TypeError: Load failed"],component:m.Es.UiInfra,eventId:"load-failed",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"The object can not be found here.",component:m.Es.UiInfra,eventId:"remove-node-not-child-safari",predicate:(e,t)=>t?.startsWith("removeChild@[native code]")??!1},{prefix:"Loading chunk",component:m.Es.UiInfra,eventId:"chunk-loading-failures",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100,predicate:(e,t)=>/Loading chunk .* failed after .* retries/.test(e)||/Loading chunk .* failed\./.test(e)},{prefix:"timeout of 0ms exceeded",component:m.Es.UiInfra,eventId:"axios-default-timeout-error",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"Request aborted",component:m.Es.UiInfra,eventId:"axios-request-aborted-error",useAlertUtilsLog:!0,predicate:(e,t)=>"Request aborted"===e},{prefix:"Network Error",component:m.Es.UiInfra,eventId:"axios-network-error",minFailures:nu.Ip.Min100,useAlertUtilsLog:!0,predicate:(e,t)=>"Network Error"===e},{prefix:"settings-internal: Request failed with status code 503",component:m.Es.RedashCore,eventId:"sqlgw-settings-internal-503"},{prefix:"null is not an object (evaluating 'localStorage.getItem')",component:m.Es.UiInfra,eventId:"localstorage-obj-is-null-error"},{prefix:"NS_BINDING_ABORTED",component:m.Es.UiInfra,eventId:"ns-binding-aborted"},{prefix:["NetworkError: Load failed","NetworkError: A network error occurred."],component:m.Es.UiInfra,eventId:"network-error-load-failed"},{prefix:"TypeError: undefined is not an object (evaluating '__gCrWeb",component:m.Es.UiInfra,eventId:"chrome-for-ios-undefined-internal-object-error"},{prefix:"The user aborted a request.",component:m.Es.UiInfra,eventId:"user-aborted-request",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"",component:m.Es.UiInfra,eventId:"unifiedFetchData-exception-user-abort",useAlertUtilsLog:!0,predicate:(e,t)=>null!=t&&t.includes("Error: Failed to execute 'fetch' on 'Window': The user aborted a request.")},{prefix:"Response not successful: Received status code",component:m.Es.UiInfra,eventId:"response-not-successful",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"signal is aborted without reason",component:m.Es.UiInfra,eventId:"signal-aborted-without-reason",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"User",component:m.Es.UiInfra,predicate:(e,t)=>/User .* has insufficient privileges to access object .*/.test(e),eventId:"user-permissions-error"},{prefix:"Error while fetching model version for run",component:m.Es.UiInfra,eventId:"mlflow-error-while-fetching-model-version",minFailures:nu.Ip.Min100},{prefix:"Uncaught NetworkError: Failed to execute 'importScripts' on 'WorkerGlobalScope'",component:m.Es.UiInfra,eventId:"worker-importscripts-failed",minFailures:nu.Ip.Min100},{prefix:"Error: Attempted to get command that was not found",component:m.Es.UiInfra,eventId:"command-not-found"},{prefix:"Error: Current session is invalid",component:m.Es.UiInfra,eventId:"current-session-invalid"},{prefix:"Error: Failed to convert invalid state",component:m.Es.UiInfra,eventId:"convert-invalid-state"},{prefix:"Error: Action",component:m.Es.UiInfra,eventId:"action-already-defined",predicate:(e,t)=>/Error: Action .* is already defined for id/.test(e)},{prefix:"Error: Talisman extension has not been configured yet",component:m.Es.UiInfra,eventId:"talisman-extension-not-configured",useAlertUtilsLog:!0},{prefix:["Error: Unexpected token '<'","Error: <!doctype html><html>","Error: <html>",'<!doctype "... is not valid JSON',"Failed to parse JSON response","Unexpected token '<'","Unexpected '<'","Unexpected ''"],component:m.Es.UiInfra,eventId:"unexpected-token-html",useAlertUtilsLog:!0},{prefix:"Unexpected end of JSON input",component:m.Es.UiInfra,eventId:"unexpected-end-of-json",useAlertUtilsLog:!0,predicate:(e,t)=>null!==t&&/ServerParseError/.test(t)},{prefix:"Loading script failed",component:m.Es.UiInfra,eventId:"loading-script-failed"},{prefix:"Error: INKApi Error",component:m.Es.UiInfra,eventId:"inkapi-error"},{prefix:"TypeError: Cannot redefine property: googletag",component:m.Es.UiInfra,eventId:"cannot-redefine-property-googletag"},{prefix:"SyntaxError: Unexpected end of input",component:m.Es.UiInfra,eventId:"syntax-error-unexpected-end-of-input"},{prefix:"Uncaught SyntaxError: Identifier",component:m.Es.UiInfra,eventId:"identifier-has-already-been-declared",predicate:(e,t)=>/Uncaught SyntaxError: Identifier .* has already been declared/.test(e)},{prefix:["TEMPORARILY_UNAVAILABLE","Error: TEMPORARILY_UNAVAILABLE"],component:m.Es.UiInfra,eventId:"service-temporarily-unavailable",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"",component:m.Es.MlFlow,eventId:"mlflow-ui-error-legacy",predicate:(e,t,r,n)=>null!==n&&"string"!=typeof n&&"isMlflowUiError"in n&&!0===n.isMlflowUiError},{prefix:["Uncaught TypeError: Cannot redefine property: hidden","TypeError: Cannot redefine property: hidden"],component:m.Es.UiInfra,eventId:"cannot-redefine-property-hidden",minFailures:nu.Ip.Min10,predicate:(e,t)=>!t?.includes(".js"),useAlertUtilsLog:!0},{prefix:"Cannot destructure property 'ok' of 'e' as it is undefined.",component:m.Es.Navigation,eventId:"cannot-destructure-property-ok",minFailures:nu.Ip.Min100},{prefix:'["objectsPermissions",{"name""dashboardsv3',component:m.Es.Lakeview,eventId:"lakeview-dashboards-objects-permissions-error",predicate:(e,t)=>t?.includes("data is undefined")??!1},{prefix:'["revisionHistory"',component:m.Es.Notebooks,eventId:"notebooks-revision-history-error",predicate:(e,t)=>(t?.includes("data is undefined")??!1)||e.includes("data is undefined")},{prefix:"Restricted access",component:m.Es.DataExplorer,eventId:"data-explorer-restricted-access-error",useAlertUtilsLog:!0,predicate:(e,t)=>t?.includes("chunk.js")??!1},{prefix:"timeout of 15000ms exceeded",component:m.Es.Notebooks,eventId:"notebooks-timeout-error",predicate:(e,t)=>t?.includes("chunk.js")??!1},{prefix:"Request failed to send. Check your internet connection",component:m.Es.Notebooks,eventId:"notebooks-request-failed-internet-error",useAlertUtilsLog:!0},{prefix:"Call failed to /ajax-api/2.0/preview/admin/scim/v2/",component:m.Es.UiInfra,eventId:"ajax-api-undefined-response",predicate:e=>e.includes("Response text: undefined"),useAlertUtilsLog:!0},{prefix:["RBAC: access denied","Unexpected token 'R'"],component:m.Es.UiInfra,eventId:"fetch-during-vpn-disconnect",useAlertUtilsLog:!0,minFailures:nu.Ip.Min100},{prefix:"queryKey: dataroom",component:m.Es.DataRooms,eventId:"dataroom-error",predicate:(e,t)=>(t?.includes("data is undefined")??!1)||e.includes("data is undefined")},{prefix:"queryKey: pipeline-root-tree-node",component:m.Es.WorkflowsAuthoring,eventId:"pipeline-root-tree-node-403",useAlertUtilsLog:!0,predicate:e=>e.includes("failed with 403")}];function n$(e){return"object"==typeof e&&null!==e&&"response"in e&&"number"==typeof e.response?.status}function nH(e){if(!e)return!0;if(0===e.status)return!1;let t=e.status>=200&&e.status<300;if("errorType"in e)return e.errorType===nS.JSON_PARSE&&t;var r=e.status;if(0===r||r>=400&&r<600)return!1;return!0}function nK(e){var t;if(!e)return!1;if(!((e=function(e){if(null!==e&&!(e instanceof Error)&&"object"==typeof e&&"message"in e)return Error(`${e.message}, Stringified Non-Error object: ${p.iT.jsonStringifyWithJavaScriptTypes(e)}`);return e}(e))instanceof Error))return!0;if(e instanceof nd.ZR&&e.isUserError)return!1;let r=e?.stack?.toString()||null;if(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;for(let i of nz)if((Array.isArray(i.prefix)?i.prefix:[i.prefix]).some(t=>e.startsWith(t))&&i.predicate?.(e,t,r,n)!==!1)return i?.useAlertUtilsLog?p.iT.log(`[ConvertedToAlert] ${i.eventId}`,i.component,{message:e,stack:t,componentStack:r}):p.iT.sev2BurnRate(i.component,`[ConvertedToAlert] ${i.eventId}`,i.sloTarget||nu.i1.P99,i.minFailures||nu.Ip.Min10,!1,{message:e,stack:t,componentStack:r},!1,!0),!0;return!1}(e.message,r))return!1;if(e instanceof TypeError)return"Failed to fetch"!==e.message&&!e.message.includes("NetworkError");if("object"==typeof(t=e)&&null!==t&&"isAxiosError"in t&&"boolean"==typeof t.isAxiosError&&t.isAxiosError){if(e.message===nD().ABORTED_MSG||e.message===nD().NETWORK_ERROR_MSG||e.code===nD().NETWORK_ERROR_CODE)return!1;return nH(e.response)}if(n$(e))return nH(e.response);return!0}let nG=[e=>e.message?.startsWith("AbortError: Fetch is aborted"),e=>e.message?.startsWith("Aborted")&&e.stack?.includes("ui-assets"),e=>e.message?.startsWith("Content-Length header of network response exceeds response Body.")];function nV(e){if(!e||"object"!=typeof e)return!1;if(!p.iT.isError(e)&&p.iT.isStringRecord(e)&&"{}"===p.iT.jsonStringifyWithJavaScriptTypes(e))return!0;let t="sourceURL"in e&&(e.sourceURL.startsWith("https://ui-assets")||e.sourceURL.startsWith("https://databricks-ui-assets-v2-gsd4bmhzapcyenec.b02.azurefd.net/js"));if("__initiatorStack"in e||t)return!0;if(!(e instanceof Error))return!1;if(nG.some(t=>t(e)))return!0;return!1}class nZ extends Error{constructor(e){super(e),this.name="ReactQueryAppError"}}let nJ=e=>{if(e instanceof nZ)return!1;return nK(e)};function nq(e,t,r){p.iT.sev2IfThrows(m.Es.Navigation,"reactQuery-error-handling-failure",()=>{if(e||nJ(r)){let n=r;if(r instanceof Error){let e=Error(`queryKey: ${t} ${r.message}`);e.name=r.name,e.stack=r.stack,e.cause=r.cause,n=e}else n={error:r,queryKey:t};p.iT.sev2BurnRate(m.Es.Navigation,"reactQuery-query-cache",nu.i1.P99,nu.Ip.Min10,e,n)}})}function nX(e,t){p.iT.sev2IfThrows(m.Es.Navigation,"reactQuery-error-handling-failure",()=>{if(e)p.iT.sev2BurnRate(m.Es.Navigation,"reactQuery-mutation-cache",nu.i1.P99,nu.Ip.Min10,!0);else nJ(t)&&((t instanceof Error||p.iT.isStringRecord(t))&&"string"==typeof t.message&&(0,np.o)(t.message,(0,T.W)("databricks.fe.wexp.uncaughtReactQueryMutationExceptionsToIgnore","[]"),m.Es.Navigation)?p.iT.log("reactQuery-mutation-cache-preexisting",m.Es.Navigation,t):p.iT.sev2BurnRate(m.Es.Navigation,"reactQuery-mutation-cache",nu.i1.P99,nu.Ip.Min10,!1,t))})}new r8.E({...{defaultOptions:{queries:{retry:(e,t)=>(function(e,t){if(n$(t)&&429===t.response.status&&e<=5)return(0,W.y)("clientsideEvent",{eventType:"SharedQueryClientRetry",eventName:"RetryAttempt",retryCount:e}),!0;return!1})(e,t)}}},queryCache:new ne.$(function(){let{onError:e,onSuccess:t,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...r,onError:(t,r)=>{nq(!1,r.queryKey,t);let n=r.meta;return n?.__panelBoundaryLogger&&n.__panelBoundaryLogger(t),e?.(t,r)},onSuccess:(e,r)=>(nq(!0,r.queryKey),t?.(e,r))}}()),mutationCache:new nt.q(function(){let{onError:e,onSuccess:t,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...r,onError:(t,r,n,i)=>{nX(!1,t);let o=i.meta;return o?.__useActionErrorHandlerLogger&&o.__useActionErrorHandlerLogger(t),e?.(t,r,n,i)},onSuccess:(e,r,n,i)=>(nX(!0),t?.(e,r,n,i))}}()),logger:{log:console.log,warn:console.warn,error:()=>{}}});let nQ=na(()=>(0,T.W)("databricks.fe.infra.enableUseQueryReactQueryWrapper",!1),nn.I,function(e,t,r){let n=(0,i.useMemo)(()=>(0,nr.vh)(e,t,r),[e,t,r]),o=function(){let{esComponent:e,errorBoundaryId:t}=g(),{UNSAFE_logErrorInPanelBoundary:r}=(0,i.useContext)(h),n={esComponent:e,errorBoundaryId:t,UNSAFE_logErrorInPanelBoundary:r,recordProto:er()},o=(0,i.useRef)(n);return o.current=n,o}(),a=(0,i.useCallback)(e=>{let t=o.current;if(t?.UNSAFE_logErrorInPanelBoundary&&t?.recordProto&&!n.useErrorBoundary){let r=(0,nd.a$)(e);r instanceof nd.Bk&&p.iT.sev2(m.Es.UiInfra,"[Experimental-misbah.imtiaz] useQuery React-Query categorizing Unknown Error",e),t.UNSAFE_logErrorInPanelBoundary(r,t.recordProto,void 0,!0)}},[o,n.useErrorBoundary]),s=(0,i.useMemo)(()=>({...n.meta,__panelBoundaryLogger:a}),[n.meta,a]);return(0,nn.I)({...n,meta:s})}),n0=na(()=>(0,T.W)("databricks.fe.infra.enableUseMutationReactQueryWrapper",!1),ni.n,function(e,t,r){let n=(0,nr.GR)(e,t,r),o=function(){let{UNSAFE_logUserActionError:e}=(()=>{let{currentUserActionError:e,handleError:t,handlePromise:r,clearUserActionError:n,renderErrorAlert:o,UNSAFE_logUserActionError:a}=(0,i.useContext)(nc),{uiDeployableId:s}=(0,i.useContext)(nl),{esComponent:l,errorBoundaryId:c}=g(),{getCurrentInteraction:d}=ei(),u=(0,i.useCallback)(()=>{let e=d();if(e&&!e?.endTime)return e;let t=P();if(t&&!t?.endTime)return t;let r=`No active interaction found for ${l} at ${c}`;return e&&(r+=`, last RIT interaction was ${e.name}`),t&&(r+=`, last event interaction was ${t.name}`),p.iT.sev2(m.Es.UiInfra,"[Experimental-warren.zhang] UserActionErrorHandler handleError invoked without active interaction",r),null},[d,l,c]),f=(0,i.useCallback)((e,t)=>{let r=u();r?.fail(e,t)},[u]),h=(0,i.useCallback)((e,r,n)=>{let i=u();t(e,f,s,l,c,i?.id,i?.rootInteractionId,n,i?.name,r)},[t,u,s,l,f,c]),y=(0,i.useCallback)((e,r,n,i)=>{let o=F(e);t(r,(e,t)=>{o?.fail(e,t)},s,l,c,o?.id,o?.rootInteractionId,i,o?.name,n)},[t,s,l,c]),E=(0,i.useCallback)((e,t)=>{let n=u();r(e,f,s,l,c,n?.id,n?.rootInteractionId,t,n?.name)},[u,r,f,s,l,c]),v=(0,i.useCallback)((e,t,r)=>{let n=u();a(e,f,s,l,c,n?.id,n?.rootInteractionId,t,n?.name,r)},[u,s,l,f,c,a]);return(0,i.useMemo)(()=>({currentUserActionError:e,handleError:h,handleErrorWithEvent:y,handlePromise:E,clearUserActionError:n,renderErrorAlert:o,UNSAFE_logUserActionError:v}),[n,e,h,y,E,o,v])})(),t={UNSAFE_logUserActionError:e},r=(0,i.useRef)(t);return r.current=t,r}(),a=(0,i.useCallback)(e=>{let t=o.current;if(t?.UNSAFE_logUserActionError&&!n?.useErrorBoundary){let r=(0,nd.a$)(e);r instanceof nd.Bk&&p.iT.sev2(m.Es.UiInfra,"[Experimental-misbah.imtiaz] useMutation React-Query categorizing Unknown Error",e),t.UNSAFE_logUserActionError(r,void 0,!0)}},[o,n?.useErrorBoundary]),s=(0,i.useMemo)(()=>({...n?.meta,__useActionErrorHandlerLogger:a}),[n?.meta,a]);return(0,ni.n)({...n,meta:s})}),n1=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=Math.max(0,Math.floor((t.getTime()-e)/1e3)),i=Math.floor(r/31536e3);if(i>=1)return(0,n.Y)(l.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:i}});if((i=Math.floor(r/2592e3))>=1)return(0,n.Y)(l.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:i}});if((i=Math.floor(r/86400))>=1)return(0,n.Y)(l.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:i}});if((i=Math.floor(r/3600))>=1)return(0,n.Y)(l.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:i}});if((i=Math.floor(r/60))>=1)return(0,n.Y)(l.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:i}});return(0,n.Y)(l.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:r}})},n2=e=>{let{formValue:t,dataType:r,isFeedback:n}=e;if(n)return{feedback:{value:t}};if("json"===r)return{expectation:{serialized_value:{value:String(t),serialization_format:"JSON_FORMAT"}}};return{expectation:{value:t}}};function n3(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}function n5(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let n6=function(e,t){var r;return(r=function*(){try{let r="string"==typeof e?e:e instanceof URL?e.toString():e.url,n=(0,nY.wE)(),i=yield nI.call({resource:r,options:function(e){if(void 0===e)return{responseFormat:n_.STREAM};let t=function(e){if(!e)return e;let t=e.method?e.method:nT.GET,r=Array.isArray(e.headers)?new Headers(e.headers):e.headers;return{...e,headers:r,method:t,signal:e.signal??void 0}}(e);return{...t,method:t.method,responseFormat:t.responseFormat??n_.STREAM}}(t)}),o=nC(i,n);return p.iT.sev2BurnRate(m.Es.Navigation,nb.Fetch,nu.i1.P999,nu.Ip.Min10,!0),o}catch(e){throw nK(e)&&(nV(e)?p.iT.log("unifiedFetchData-ignored-fetch",m.Es.Navigation,e):p.iT.sev2BurnRate(m.Es.Navigation,nb.Fetch,nu.i1.P999,nu.Ip.Min10,!1,e)),e}},function(){var e=this,t=arguments;return new Promise(function(n,i){var o=r.apply(e,t);function a(e){n3(o,n,i,a,s,"next",e)}function s(e){n3(o,n,i,a,s,"throw",e)}a(void 0)})})()},n4=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0;return(t=function*(){let t=yield n6(e,{method:r,body:function(e){if(void 0===e)return;return"string"==typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}(n),headers:n?{"Content-Type":"application/json"}:{}});if(!t.ok){let e=(0,nd.a$)(t);if(e){try{e.message=(yield t.json()).message??e.message}catch{}throw e}}return t.json()},function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(e){n5(o,n,i,a,s,"next",e)}function s(e){n5(o,n,i,a,s,"throw",e)}a(void 0)})})()},n7=e=>{let{payload:t}=e;return n4(`/ajax-api/3.0/mlflow/traces/${t.assessment.trace_id}/assessments`,"POST",t)},n9=(0,i.createContext)({refetchTraceInfo:null}),n8=()=>(0,i.useContext)(n9);function ie(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let it=e=>{let{assessmentName:t,spanId:r,traceId:o,setExpanded:s}=e,c=(0,l.tz)(),{theme:d}=(0,a.wn)(),[u,p]=(0,i.useState)(""),[m,f]=(0,i.useState)("feedback"),[g,h]=(0,i.useState)("boolean"),[y,E]=(0,i.useState)(!0),[v,x]=(0,i.useState)(""),[b,T]=(0,i.useState)(null),{refetchTraceInfo:_}=n8(),{mutate:S,isLoading:I}=n0({mutationFn:e=>n7({payload:e}),onSuccess:()=>{_?.()},onError:e=>{eP(c.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{s(!1)}}),A=!(0,G.isNil)(t),R=(0,i.useCallback)(()=>{var e;return(e=function*(){if("json"===g)try{JSON.parse(y)}catch(e){T((0,n.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}));return}let e=n2({formValue:y,dataType:g,isFeedback:"feedback"===m}),i={assessment:{assessment_name:A?t:u,trace_id:o,source:{source_type:"HUMAN",source_id:eL()},span_id:r,rationale:v,...e}};yield S(i)},function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){ie(o,n,i,a,s,"next",e)}function s(e){ie(o,n,i,a,s,"throw",e)}a(void 0)})})()},[g,y,m,A,t,u,o,r,v,S]);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:d.spacing.xs,marginTop:d.spacing.sm,border:`1px solid ${d.colors.border}`,padding:d.spacing.sm,borderRadius:d.borders.borderRadiusSm},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,n.FD)(r7.XA,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:m,disabled:I,onChange:e=>f(e.target.value),children:[(0,n.Y)(r7.wS,{value:"feedback",children:(0,n.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,n.Y)(r7.wS,{value:"expectation",children:(0,n.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,n.Y)(tb.o.Text,{css:{marginTop:d.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),A?(0,n.Y)(tb.o.Text,{children:t}):(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.assessment-name-input",value:u,disabled:I,onKeyDown:e=>e.stopPropagation(),onChange:e=>p(e.target.value)}),(0,n.Y)(tb.o.Text,{css:{marginTop:d.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,n.FD)(r7.XA,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:g,disabled:I,onChange:e=>{h(e.target.value),T(null)},children:["expectation"===m&&(0,n.Y)(r7.wS,{value:"json",children:(0,n.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,n.Y)(r7.wS,{value:"string",children:(0,n.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,n.Y)(r7.wS,{value:"boolean",children:(0,n.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,n.Y)(r7.wS,{value:"number",children:(0,n.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,n.Y)(tb.o.Text,{css:{marginTop:d.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),"json"===g&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tx.p.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(y),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value),T(null)},validationState:b?"error":void 0,disabled:I}),b&&(0,n.Y)(r9.D.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:b,type:"error"})]}),"string"===g&&(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value),T(null)},disabled:I,allowClear:!0}),"boolean"===g&&(0,n.FD)(rV.d,{componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:y,disabled:I,onChange:e=>{E(e.target.value),T(null)},children:[(0,n.Y)(rV.E,{value:!0,children:"True"}),(0,n.Y)(rV.E,{value:!1,children:"False"})]}),"number"===g&&(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value?Number(e.target.value):""),T(null)},type:"number",disabled:I,allowClear:!0}),(0,n.Y)(tb.o.Text,{css:{marginTop:d.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,n.Y)(tx.p.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:v,autoSize:{minRows:1,maxRows:5},disabled:I,onKeyDown:e=>e.stopPropagation(),onChange:e=>x(e.target.value)}),(0,n.FD)("div",{css:{display:"flex",justifyContent:"flex-end",marginTop:d.spacing.xs},children:[(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:I,onClick:()=>s(!1),children:(0,n.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,n.Y)(tT.$n,{css:{marginLeft:d.spacing.sm},type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:R,loading:I,children:(0,n.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})},ir=e=>{let{title:t,assessmentName:r,spanId:o,traceId:a}=e,[s,l]=(0,i.useState)(!1);return(0,n.FD)("div",{children:[(0,n.Y)(tT.$n,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,n.Y)(r4.A,{}),onClick:()=>l(!0),children:t}),s&&(0,n.Y)(it,{assessmentName:r,spanId:o,traceId:a,setExpanded:l})]})};var ii=r(54340),io=r(69425),ia=r(74220);let is=e=>{let{assessment:t,setIsEditing:r,setShowDeleteModal:i}=e,o="feedback"in t,a=eL(),s=(0,T.W)("databricks.fe.traceExplorer.enableAssessmentEditing",!1),c=a===t.source.source_id||o&&"HUMAN"!==t.source.source_type;return(0,n.FD)(tU.Root,{children:[(0,n.Y)(tU.Trigger,{asChild:!0,children:(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,n.Y)(ii.A,{}),size:"small"})}),(0,n.FD)(tU.Content,{minWidth:100,children:[s&&c&&r&&(0,n.FD)(tU.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>r?.(!0),children:[(0,n.Y)(tU.IconWrapper,{children:(0,n.Y)(io.A,{})}),(0,n.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,n.FD)(tU.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>i(!0),children:[(0,n.Y)(tU.IconWrapper,{children:(0,n.Y)(ia.A,{})}),(0,n.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})};var il=r(52043);function ic(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let id=e=>{let{assessment:t,isModalVisible:r,setIsModalVisible:o}=e,a=(0,l.tz)(),{refetchTraceInfo:s}=n8(),{mutate:c,isLoading:d}=n0({mutationFn:()=>(e=>{let{traceId:t,assessmentId:r}=e;return n4(`/ajax-api/3.0/mlflow/traces/${t}/assessments/${r}`,"DELETE")})({traceId:t.trace_id,assessmentId:t.assessment_id}),onSuccess:()=>{s?.()},onError:e=>{eP(a.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{o(!1)}}),u=(0,i.useCallback)(()=>{var e;return(e=function*(){yield c()},function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){ic(o,n,i,a,s,"next",e)}function s(e){ic(o,n,i,a,s,"throw",e)}a(void 0)})})()},[c]);return(0,n.Y)(il.aF,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:r,onOk:u,okButtonProps:{danger:!0,loading:d},okText:(0,n.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{o(!1)},cancelText:(0,n.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:d,title:(0,n.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,n.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};function iu(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let ip=e=>{let{assessment:t,onSuccess:r,onSettled:o,onCancel:s}=e,c="feedback"in t,d=(e=>{if("feedback"in e)return e.feedback.value;if("value"in e.expectation)return e.expectation.value;return e.expectation.serialized_value.value})(t),u=((e,t)=>{if("string"==typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(e){return"string"}}if("boolean"==typeof e||"number"==typeof e)return typeof e;return"boolean"})(d,c),p=(e=>{if("string"==typeof e)return e||null;if("boolean"==typeof e||"number"==typeof e)return e;return null})(d),m=eL(),{theme:f}=(0,a.wn)(),[g,h]=(0,i.useState)(u),[y,E]=(0,i.useState)(p),[v,x]=(0,i.useState)(t.rationale),[b,T]=(0,i.useState)(null),{refetchTraceInfo:_}=n8(),{updateAssessmentMutation:S,isLoading:I}=(e=>{let{assessment:t,refetchTraceInfo:r,onSuccess:n,onError:i,onSettled:o}=e,a=(0,l.tz)(),{mutate:s,isLoading:c}=n0({mutationFn:e=>(e=>{let{traceId:t,assessmentId:r,payload:n}=e;return n4(`/ajax-api/3.0/mlflow/traces/${t}/assessments/${r}`,"PATCH",n)})({traceId:t.trace_id,assessmentId:t.assessment_id,payload:e}),onError:e=>{eP(a.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),i?.(e)},onSuccess:()=>{r?.(),n?.()},onSettled:()=>{o?.()}});return{updateAssessmentMutation:s,isLoading:c}})({assessment:t,refetchTraceInfo:_,onSuccess:r,onSettled:o}),{overrideAssessmentMutation:A,isLoading:R}=(e=>{let{refetchTraceInfo:t,onSuccess:r,onError:n,onSettled:i}=e,o=(0,l.tz)(),{mutate:a,isLoading:s}=n0({mutationFn:e=>{let{oldAssessment:t,value:r,rationale:n}=e,i={...t,...r,rationale:n,source:{source_id:eL(),source_type:"HUMAN"},overrides:t.assessment_id};return n7({payload:{assessment:(0,G.omit)(i,"assessment_id","create_time","last_update_time","overriddenAssessments")}})},onError:e=>{eP(o.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),n?.(e)},onSuccess:()=>{t?.(),r?.()},onSettled:()=>{i?.()}});return{overrideAssessmentMutation:a,isLoading:s}})({refetchTraceInfo:_,onSuccess:r,onSettled:o}),Y=I||R,w=(0,i.useCallback)(()=>{var e;return(e=function*(){if("json"===g)try{JSON.parse(y)}catch(e){T((0,n.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}));return}let e=n2({formValue:y,dataType:g,isFeedback:c});if(m!==t.source.source_id&&c)yield A({oldAssessment:t,value:e,...v?{rationale:v}:{}});else{let t={assessment:{...e,rationale:v},update_mask:`${c?"feedback":"expectation"},rationale`};yield S(t)}},function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){iu(o,n,i,a,s,"next",e)}function s(e){iu(o,n,i,a,s,"throw",e)}a(void 0)})})()},[g,y,c,m,t,v,S,A]);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:f.spacing.xs,marginTop:f.spacing.sm,border:`1px solid ${f.colors.border}`,padding:f.spacing.sm,borderRadius:f.borders.borderRadiusSm},children:[(0,n.Y)(tb.o.Text,{css:{marginTop:f.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,n.FD)(r7.XA,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:g,disabled:Y,onChange:e=>{h(e.target.value),T(null)},children:[!c&&(0,n.Y)(r7.wS,{value:"json",children:(0,n.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,n.Y)(r7.wS,{value:"string",children:(0,n.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,n.Y)(r7.wS,{value:"boolean",children:(0,n.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,n.Y)(r7.wS,{value:"number",children:(0,n.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,n.Y)(tb.o.Text,{css:{marginTop:f.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===g&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tx.p.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(y),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value),T(null)},validationState:b?"error":void 0,disabled:Y}),b&&(0,n.Y)(r9.D.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:b,type:"error"})]}),"string"===g&&(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value),T(null)},disabled:Y,allowClear:!0}),"boolean"===g&&(0,n.FD)(rV.d,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:y,disabled:Y,onChange:e=>{E(e.target.value),T(null)},children:[(0,n.Y)(rV.E,{value:!0,children:"True"}),(0,n.Y)(rV.E,{value:!1,children:"False"})]}),"number"===g&&(0,n.Y)(tx.p,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{E(e.target.value?Number(e.target.value):""),T(null)},type:"number",disabled:Y,allowClear:!0}),(0,n.Y)(tb.o.Text,{css:{marginTop:f.spacing.xs},size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,n.Y)(tx.p.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:v,autoSize:{minRows:1,maxRows:5},disabled:Y,onKeyDown:e=>e.stopPropagation(),onChange:e=>x(e.target.value)}),(0,n.FD)("div",{css:{display:"flex",justifyContent:"flex-end",marginTop:f.spacing.xs},children:[(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:Y,onClick:s,children:(0,n.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,n.Y)(tT.$n,{css:{marginLeft:f.spacing.sm},type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:w,loading:Y,children:(0,n.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})},im=e=>{let{objectKey:t,value:r}=e,{theme:i}=(0,a.wn)(),o=(0,G.isString)(r)?r:JSON.stringify(r);return(0,n.Y)(rO.m,{content:o,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,n.Y)(tB.v,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:{width:"min-content",maxWidth:"100%"},children:(0,n.FD)(tb.o.Text,{css:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t&&(0,n.FD)(tb.o.Text,{bold:!0,css:{marginRight:i.spacing.xs},children:[t,":"]}),o]})})})},ig=e=>{let{node:t}=e,{theme:r}=(0,a.wn)(),{setSelectedNode:i,setActiveView:o,setShowTimelineTreeGantt:s}=tk(),l=e1(t)>0;return(0,n.FD)("div",{css:{display:"flex",alignItems:"center",marginRight:r.spacing.xs,gap:r.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?r.colors.actionDangerDefaultTextDefault:r.colors.actionDefaultTextDefault,cursor:"pointer"}},onClick:()=>{i(t),o("detail"),s(!1)},children:[(0,n.Y)(ek,{hasException:l,type:eF(t.type??ey.UNKNOWN)}),(0,n.Y)(tb.o.Text,{color:l?"error":"primary",css:{marginLeft:r.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title})]})},ih=e=>{let{expectation:t}=e,{theme:r}=(0,a.wn)(),[o,s]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),{nodeMap:u,activeView:p}=tk(),m=t.span_id?u[t.span_id]:null,f="summary"===p&&m,g=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(t.expectation);return(0,n.FD)("div",{css:{padding:r.spacing.sm+r.spacing.xs,paddingTop:r.spacing.sm,border:`1px solid ${r.colors.border}`,borderRadius:r.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:r.spacing.sm},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.Y)(tb.o.Text,{bold:!0,css:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.assessment_name}),(0,n.Y)(is,{assessment:t,setIsEditing:s,setShowDeleteModal:d}),(0,n.Y)(id,{assessment:t,isModalVisible:c,setIsModalVisible:d})]}),o?(0,n.Y)(ip,{assessment:t,onSuccess:()=>s(!1),onCancel:()=>s(!1)}):(e=>{if(Array.isArray(e))return e.map((e,t)=>(0,n.Y)(im,{value:e},t));if((0,G.isObject)(e))return Object.entries(e).map(e=>{let[t,r]=e;return(0,n.Y)(im,{objectKey:t,value:r},t)});return(0,n.Y)(im,{value:e})})(g),f&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.xs},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,n.Y)(ig,{node:m})]})]})};var iy=r(2147),iE=r(2534);let iv=e=>{let t,{jsonValue:r}=e,{theme:i}=(0,a.wn)();if(!r||'""'===r)return null;try{t=JSON.parse(r)}catch(e){t=r}let o="default",s=JSON.stringify(t,null,2);return"yes"===t?(o="lime",s=(0,n.FD)(n.FK,{children:[(0,n.Y)(iE.A,{css:{marginRight:i.spacing.xs}}),(0,n.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===t?(o="coral",s=(0,n.FD)(n.FK,{children:[(0,n.Y)(r0.A,{css:{marginRight:i.spacing.xs}}),(0,n.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"==typeof t?s=t:null===t?(o="coral",s=(0,n.FD)(n.FK,{children:[(0,n.Y)(iy.A,{css:{marginRight:i.spacing.xs}}),(0,n.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===t?(o="lime",s=(0,n.FD)(n.FK,{children:[(0,n.Y)(iE.A,{css:{marginRight:i.spacing.xs}}),(0,n.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===t&&(o="coral",s=(0,n.FD)(n.FK,{children:[(0,n.Y)(r0.A,{css:{marginRight:i.spacing.xs}}),(0,n.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:s,children:(0,n.Y)(tB.v,{css:{display:"inline-flex",maxWidth:"100%",minWidth:i.spacing.md,marginRight:0},componentId:"shared.model-trace-explorer.assesment-value-tag",color:o,children:(0,n.Y)("span",{css:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},children:s})})})};var ix=r(21416);let ib=e=>{let{source:t}=e,{theme:r}=(0,a.wn)();return(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.assessment-source-name",content:t.source_id,children:(0,n.Y)("span",{css:{flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:r.spacing.sm,minWidth:r.spacing.md},children:(0,n.Y)(tb.o.Text,{children:(0,n.Y)("span",{css:{color:r.colors.blue500},children:t.source_id})})})})},iT=e=>{let{renderConnector:t=!0,assessment:r,setIsEditing:o}=e,{theme:s}=(0,a.wn)(),[l,c]=(0,i.useState)(!1),d=(e=>{switch(e.source_type){case"HUMAN":return eO.A;case"LLM_JUDGE":return ix.A;default:return eS.A}})(r.source);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center"},children:[t&&(0,n.Y)("div",{css:{position:"absolute",left:-1,top:0,width:10,height:s.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:s.borders.borderRadiusMd,borderBottom:`1px solid ${s.colors.border}`,borderLeft:`1px solid ${s.colors.border}`}}),(0,n.Y)(d,{size:s.typography.fontSizeSm,css:{padding:2,backgroundColor:s.colors.actionIconBackgroundHover,borderRadius:s.borders.borderRadiusFull}}),(0,n.Y)(ib,{source:r.source}),(0,n.FD)("div",{css:{marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:s.spacing.xs},children:[r.last_update_time&&(0,n.Y)(tb.o.Text,{color:"secondary",size:"sm",css:{marginLeft:s.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},children:n1(new Date(r.last_update_time))}),(0,n.Y)(is,{assessment:r,setIsEditing:o,setShowDeleteModal:c}),(0,n.Y)(id,{assessment:r,isModalVisible:l,setIsModalVisible:c})]})]})};var i_=r(11871);let iS=e=>{let{error:t}=e,{theme:r}=(0,a.wn)(),[o,s]=(0,i.useState)(!1);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.xs},children:[(0,n.Y)(i_.F,{type:"error",closable:!1,message:t.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.xs},children:[(0,n.Y)("span",{children:t.error_message}),t.stack_trace&&(0,n.Y)(tb.o.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>s(!0),children:(0,n.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),t.stack_trace&&(0,n.Y)(il.aF,{title:(0,n.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:o,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>s(!1),children:(0,n.Y)(rY,{data:JSON.stringify(t.stack_trace),title:"",initialRenderMode:ex.TEXT})})]})},iI=e=>{let{feedback:t}=e,{theme:r}=(0,a.wn)(),i=t.feedback.value;return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",position:"relative"},children:[(0,n.Y)(iT,{renderConnector:!1,assessment:t}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.xs,marginLeft:10,paddingLeft:r.spacing.md,paddingTop:r.spacing.sm,paddingBottom:r.spacing.md,paddingRight:r.spacing.lg,borderLeft:`1px solid ${r.colors.border}`},children:[(0,G.isNil)(t.feedback.error)?(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,n.Y)("div",{children:(0,n.Y)(iv,{jsonValue:JSON.stringify(i)})})]}):(0,n.Y)(iS,{error:t.feedback.error}),t.rationale&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",css:{marginTop:r.spacing.xs},children:(0,n.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,n.Y)(ry,{children:t.rationale})]})]})]})},iA=e=>{let{isModalVisible:t,setIsModalVisible:r,feedback:o}=e,a=(0,i.useMemo)(()=>(e=>{let t=new Set,r=[],n=e;for(;n&&!t.has(n.assessment_id);)t.add(n.assessment_id),r.push(n),n=n.overriddenAssessment;return r})(o),[o]);return(0,n.Y)(il.aF,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:t,footer:null,onCancel:()=>{r(!1)},title:(0,n.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:a.map(e=>"feedback"in e?(0,n.Y)(iI,{feedback:e},e.assessment_id):null)})},iR=e=>{let{feedback:t}=e,[r,o]=(0,i.useState)(!1),{theme:s}=(0,a.wn)(),{nodeMap:c,activeView:d}=tk(),u=t.feedback.value,p=t.span_id?c[t.span_id]:null,m="summary"===d&&p;return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:s.spacing.sm,marginLeft:s.spacing.lg},children:[!(0,G.isNil)(t.feedback.error)&&(0,n.Y)(iS,{error:t.feedback.error}),m&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:s.spacing.xs},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,n.Y)(ig,{node:p})]}),(0,G.isNil)(t.feedback.error)&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:s.spacing.xs},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,n.FD)("div",{css:{display:"flex",gap:s.spacing.xs},children:[(0,n.Y)(iv,{jsonValue:JSON.stringify(u)}),t.overriddenAssessment&&(0,n.FD)(n.FK,{children:[(0,n.Y)("span",{onClick:()=>o(!0),children:(0,n.Y)(tb.o.Text,{css:{"&:hover":{textDecoration:"underline",cursor:"pointer"}},color:"secondary",children:(0,n.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,n.Y)(iA,{isModalVisible:r,setIsModalVisible:o,feedback:t})]})]})]}),t.rationale&&(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:s.spacing.xs},children:[(0,n.Y)(tb.o.Text,{size:"sm",color:"secondary",children:(0,n.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,n.Y)("div",{css:{"& > div:last-of-type":{marginBottom:0}},children:(0,n.Y)(ry,{children:t.rationale})})]})]})},iY=e=>{let{feedback:t}=e,{theme:r}=(0,a.wn)(),[o,s]=(0,i.useState)(!1);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.xs,paddingLeft:r.spacing.lg/2,marginLeft:r.spacing.lg/2,paddingTop:r.spacing.sm,paddingBottom:r.spacing.sm,borderLeft:`1px solid ${r.colors.border}`,position:"relative"},children:[(0,n.Y)(iT,{assessment:t,setIsEditing:s}),o?(0,n.Y)(ip,{assessment:t,onSuccess:()=>s(!1),onCancel:()=>s(!1)}):(0,n.Y)(iR,{feedback:t})]})},iw=e=>{let{feedbacks:t}=e,{theme:r}=(0,a.wn)();if(t.length<2)return null;let i=(0,G.countBy)(t,e=>e.source.source_type);return(0,n.Y)("div",{css:{display:"flex",gap:r.spacing.xs,alignItems:"center",marginLeft:r.spacing.xs},children:Object.entries(i).map(e=>{let[t,i]=e;return(0,n.Y)(tB.v,{componentId:`shared.model-trace-explorer.feedback-source-count-${t}`,css:{margin:0},children:(0,n.FD)("div",{css:{display:"flex",alignItems:"center",gap:r.spacing.xs},children:[(e=>{let t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,n.Y)(eO.A,{css:t});case"LLM_JUDGE":return(0,n.Y)(ix.A,{css:t});case"CODE":return(0,n.Y)(eS.A,{css:t});default:return null}})(t),(0,n.Y)(tb.o.Text,{children:i})]})},t)})})},iN=e=>{let{jsonValue:t,feedbacks:r}=e,{theme:o}=(0,a.wn)(),[s,l]=(0,i.useState)(!1);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column"},children:[(0,n.FD)("div",{css:{display:"flex",gap:o.spacing.xs,alignItems:"center"},children:[(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:{flexShrink:0},size:"small",icon:s?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),onClick:()=>l(!s)}),(0,n.Y)(iv,{jsonValue:t}),(0,n.Y)(iw,{feedbacks:r})]}),s&&(0,n.Y)("div",{css:{display:"flex",flexDirection:"column"},children:r.map(e=>e?.valid===!1?null:(0,n.Y)(iY,{feedback:e},e.assessment_id))})]})},iM=e=>{let{name:t,valuesMap:r,traceId:o,activeSpanId:s}=e,{theme:l}=(0,a.wn)(),c=(e=>{let t=e.split("/");if(1===t.length)return e;if(2===t.length)return t[1];return t.slice(2).join("/")})(t),[d,u]=(0,i.useState)(!1),p=Object.values(r).flat().some(e=>!(0,G.isNil)(e.feedback.error));return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},children:[(0,n.Y)(tb.o.Text,{bold:!0,css:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},children:c}),p&&(0,n.Y)(iy.A,{css:{flexShrink:0},color:"danger"})]}),(0,n.Y)(rO.m,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.add-feedback",css:{flexShrink:0,marginRight:-l.spacing.xs},size:"small",icon:(0,n.Y)(r4.A,{}),onClick:()=>u(!0)})})]}),Object.entries(r).map(e=>{let[t,r]=e;return(0,n.Y)(iN,{jsonValue:t,feedbacks:r},t)}),d&&(0,n.Y)(it,{assessmentName:t,spanId:s,traceId:o,setExpanded:u})]})},iC=e=>{let{assessments:t,traceId:r,activeSpanId:o}=e,{theme:s}=(0,a.wn)(),{setAssessmentsPaneExpanded:c}=tk(),[d,u]=(0,i.useMemo)(()=>(0,G.partition)(t,e=>"feedback"in e),[t]),p=(0,i.useMemo)(()=>(e=>{let t={};return e.forEach(e=>{if(!1===e.valid)return;let r=null;""!==e.feedback.value&&(r=JSON.stringify(e.feedback.value));let{assessment_name:n}=e;t[n]||(t[n]={});let i=t[n];(0,G.isNil)(r)||(i[r]||(i[r]=[]),i[r].push(e))}),t})(d),[d]);return(0,n.FD)("div",{"data-testid":"assessments-pane",css:{display:"flex",flexDirection:"column",padding:s.spacing.sm,paddingTop:s.spacing.xs,height:"100%",borderLeft:`1px solid ${s.colors.border}`,overflowY:"scroll",minWidth:250,width:"100%",boxSizing:"border-box"},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,n.Y)(tb.o.Text,{css:{marginBottom:s.spacing.sm},bold:!0,children:(0,n.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),c&&(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,n.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,n.Y)(tT.$n,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,n.Y)(r6.A,{}),onClick:()=>c(!1)})})]}),Object.entries(p).map(e=>{let[t,i]=e;return(0,n.Y)(iM,{name:t,valuesMap:i,traceId:r,activeSpanId:o},t)}),u.length>0&&(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Text,{color:"secondary",css:{marginBottom:s.spacing.sm},children:(0,n.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:s.spacing.sm,marginBottom:s.spacing.sm},children:u.map(e=>(0,n.Y)(ih,{expectation:e},e.assessment_id))})]}),(0,n.Y)(ir,{title:"Add new assessment",spanId:o,traceId:r})]})},iO=o().memo(function(e){let{activeSpan:t,searchFilter:r,activeMatch:o,activeTab:c,setActiveTab:d}=e,{theme:u}=(0,a.wn)(),[p,m]=(0,i.useState)(500),f={flex:1,marginTop:-u.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:g,assessmentsPaneEnabled:h}=tk();if((0,G.isNil)(t))return(0,n.Y)(tF.S,{description:"Please select a span to view more information"});let y=e1(t),E=(0,n.FD)(s.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:{display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${u.colors.border}`,minWidth:200,position:"relative"},value:c,onValueChange:e=>d(e),children:[(0,n.Y)("div",{css:{position:"absolute",right:g?u.spacing.xs:u.spacing.md,top:u.spacing.xs},children:(0,n.Y)(r5,{})}),(0,n.FD)(s.List,{css:{padding:0,paddingLeft:u.spacing.md,paddingRight:u.spacing.sm,boxSizing:"border-box",width:"100%"},children:[t.chatMessages&&(0,n.Y)(s.Trigger,{value:"chat",children:(0,n.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),(0,n.Y)(s.Trigger,{value:"content",children:(0,n.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,n.Y)(s.Trigger,{value:"attributes",children:"Attributes"}),(0,n.FD)(s.Trigger,{value:"events",children:["Events ",y>0&&(0,n.Y)(r2,{count:y})]})]}),t.chatMessages&&(0,n.Y)(s.Content,{css:f,value:"chat",children:(0,n.Y)(rj,{chatMessages:t.chatMessages,chatTools:t.chatTools})}),(0,n.Y)(s.Content,{css:f,value:"content",children:(0,n.Y)(rQ,{activeSpan:t,searchFilter:r,activeMatch:o})}),(0,n.Y)(s.Content,{css:f,value:"attributes",children:(0,n.Y)(rw,{activeSpan:t,searchFilter:r,activeMatch:o})}),(0,n.Y)(s.Content,{css:f,value:"events",children:(0,n.Y)(r1,{activeSpan:t,searchFilter:r,activeMatch:o})})]});return h&&g?(0,n.Y)(tE,{initialRatio:.7,paneWidth:p,setPaneWidth:m,leftChild:E,leftMinWidth:250,rightChild:(0,n.Y)(iC,{assessments:t.assessments,traceId:t.traceId,activeSpanId:t.parentId?String(t.key):void 0}),rightMinWidth:250}):E});var iD=r(58736),ik=r(7356),iL=r(8783),iP=r(56632),iF=r(74359),iU=r(27935);let iB=e=>{let{spanFilterState:t,setSpanFilterState:r}=e,{theme:i}=(0,a.wn)();return(0,n.FD)(iL.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,n.Y)(iL.Trigger,{asChild:!0,children:(0,n.Y)(tT.$n,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,n.Y)(iP.A,{}),size:"small",children:(0,n.Y)(l.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,n.Y)(iL.Content,{align:"start",children:(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:i.spacing.sm,paddingBottom:i.spacing.xs},children:[(0,n.Y)(tb.o.Text,{bold:!0,children:(0,n.Y)(l.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,n.Y)(tb.o.Text,{color:"secondary",children:(0,n.Y)(l.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(t.spanTypeDisplayState).map(e=>{let[o,a]=e,s=(0,n.Y)(ek,{type:eF(o)});return(0,n.FD)(iF.Sc,{componentId:`shared.model-trace-explorer.toggle-span-filter_${o}-${!a}`,style:{width:"100%"},isChecked:a,onChange:()=>r({...t,spanTypeDisplayState:{...t.spanTypeDisplayState,[o]:!a}}),children:[s,(0,n.Y)(tb.o.Text,{css:{marginLeft:i.spacing.xs},children:function(e){switch(e){case ey.LLM:return"LLM";case ey.CHAIN:return"Chain";case ey.AGENT:return"Agent";case ey.TOOL:return"Tool";case ey.CHAT_MODEL:return"Chat model";case ey.RETRIEVER:return"Retriever";case ey.PARSER:return"Parser";case ey.EMBEDDING:return"Embedding";case ey.RERANKER:return"Reranker";case ey.FUNCTION:return"Function";case ey.UNKNOWN:return"Unknown";default:return e}}(o)})]},o)}),(0,n.Y)(tb.o.Text,{color:"secondary",children:(0,n.Y)(l.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,n.FD)(iF.Sc,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!t.showParents}`,style:{width:"100%"},isChecked:t.showParents,onChange:()=>r({...t,showParents:!t.showParents}),children:[(0,n.Y)(tb.o.Text,{css:{marginRight:i.spacing.xs},children:(0,n.Y)(l.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,n.Y)(iU.I,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,n.Y)(l.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,n.FD)(iF.Sc,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!t.showExceptions}`,style:{width:"100%"},isChecked:t.showExceptions,onChange:()=>r({...t,showExceptions:!t.showExceptions}),children:[(0,n.Y)(tb.o.Text,{css:{marginRight:i.spacing.xs},children:(0,n.Y)(l.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,n.Y)(iU.I,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,n.Y)(l.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},ij=e=>{let{showTimelineInfo:t,setShowTimelineInfo:r,spanFilterState:i,setSpanFilterState:o}=e,{theme:s}=(0,a.wn)();return(0,n.FD)("div",{css:{padding:`${s.spacing.xs}px ${s.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${s.colors.border}`,boxSizing:"border-box",paddingLeft:s.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},children:[(0,n.Y)(tb.o.Text,{bold:!0,children:(0,n.Y)(l.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",gap:s.spacing.sm},children:[(0,n.Y)(iB,{spanFilterState:i,setSpanFilterState:o}),(0,n.FD)(rV.d,{name:"size-story",value:t,onChange:e=>{r(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,n.Y)(rV.E,{"data-testid":"hide-timeline-info-button",icon:(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,n.Y)(l.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,n.Y)(iD.A,{})}),value:!1}),(0,n.Y)(rV.E,{"data-testid":"show-timeline-info-button",icon:(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,n.Y)(l.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,n.Y)(ik.A,{})}),value:!0})]})]})]})},iW=e=>{let{active:t}=e,{theme:r}=(0,a.wn)(),i=t?r.colors.blue500:r.colors.border;return(0,n.Y)("div",{css:{position:"absolute",left:"100%",bottom:0,width:9,height:r.spacing.md,boxSizing:"border-box",borderTopRightRadius:r.borders.borderRadiusMd,borderTop:`1px solid ${i}`,borderRight:`1px solid ${i}`,zIndex:tR.LOW}})},iz=e=>{let{active:t}=e,{theme:r}=(0,a.wn)(),i=t?r.colors.blue500:r.colors.border;return(0,n.Y)("div",{css:{position:"absolute",left:"50%",top:0,width:8,height:r.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${i}`,borderLeft:`1px solid ${i}`,zIndex:t?tR.NORMAL:tR.LOW}})},i$=e=>{let{active:t}=e,{theme:r}=(0,a.wn)(),i=t?r.colors.blue500:r.colors.border;return(0,n.Y)("div",{css:{position:"absolute",width:8,left:"50%",height:32,borderLeft:`1px solid ${i}`,boxSizing:"border-box",zIndex:t?tR.NORMAL:tR.LOW}})},iH=e=>{let{isActiveSpan:t,isInActiveChain:r,linesToRender:i,hasChildren:o,isExpanded:a}=e;if(0===i.length)return(0,n.Y)("div",{css:{width:0,height:32,boxSizing:"border-box",position:"relative"},children:o&&(0,n.Y)(iW,{active:r&&!t})});return(0,n.Y)(n.FK,{children:i.map((e,s)=>{let{shouldRender:l,isActive:c}=e;return(0,n.FD)("div",{css:{width:16,height:32,boxSizing:"border-box",position:"relative"},children:[l&&(0,n.Y)(i$,{active:c}),s===i.length-1&&(0,n.FD)(n.FK,{children:[(0,n.Y)(iz,{active:r}),o&&a&&(0,n.Y)(iW,{active:r&&!t})]})]},s)})})},iK=e=>{let{span:t,children:r}=e,{theme:i}=(0,a.wn)(),o=eF(t.type??ey.UNKNOWN),s=i.isDarkMode?i.colors.grey800:i.colors.grey100,c=i.isDarkMode?i.colors.grey500:i.colors.grey350;return(0,n.Y)(rO.m,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,n.FD)("div",{css:{display:"flex",flexDirection:"column"},children:[(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",gap:i.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},children:[(0,n.Y)(ek,{type:o,isInTooltip:!0}),(0,n.Y)("span",{css:{color:s},children:t.title}),(0,n.Y)("span",{css:{marginLeft:i.spacing.xs,color:c,fontSize:i.typography.fontSizeSm},children:tM(t.end-t.start)})]}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",color:s},children:[(0,n.Y)(l.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",tM(t.start)," | ",(0,n.Y)(l.sA,{id:"q90jVU",defaultMessage:"End:"})," ",tM(t.end)]})]}),side:"right",maxWidth:700,children:r})},iG=e=>{let{node:t,selectedKey:r,expandedKeys:i,setExpandedKeys:o,traceStartTime:s,traceEndTime:l,onSelect:c,linesToRender:d}=e,u=i.has(t.key),{theme:p}=(0,a.wn)(),m=(t.children??[]).length>0,{setAssessmentsPaneExpanded:f}=tk(),g=r===t.key,h=tC(t,String(r)),y=e1(t)>0,E=g?p.colors.actionDefaultBackgroundHover:"transparent";return(0,n.FD)(n.FK,{children:[(0,n.Y)(iK,{span:t,children:(0,n.Y)("div",{"data-testid":`timeline-tree-node-${t.key}`,css:{display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:E,":hover":{backgroundColor:p.colors.actionDefaultBackgroundHover},":active":{backgroundColor:p.colors.actionDefaultBackgroundPress}},onClick:()=>{c?.(t)},children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${p.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},children:(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",alignItems:"center",overflow:"hidden",flex:1},children:[m?(0,n.Y)(tT.$n,{size:"small","data-testid":`toggle-span-expanded-${t.key}`,css:{flexShrink:0,marginRight:p.spacing.xs},icon:u?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),onClick:e=>{e.stopPropagation();let r=new Set(i);u?r.delete(t.key):r.add(t.key),o(r)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,n.Y)("div",{css:{width:24,marginRight:p.spacing.xs}}),(0,n.Y)(iH,{isActiveSpan:g,isInActiveChain:h>-1,linesToRender:d,hasChildren:m,isExpanded:u}),(0,n.Y)("span",{css:{flexShrink:0,marginRight:p.spacing.xs,borderRadius:p.borders.borderRadiusSm,border:`1px solid ${h>-1?p.colors.blue500:p.colors.backgroundSecondary}`,zIndex:tR.NORMAL},children:t.icon}),(0,n.Y)(tb.o.Text,{color:y?"error":"primary",css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flex:1},children:t.title}),t.assessments.length>0&&(0,n.FD)(tB.v,{color:"indigo","data-testid":`assessment-tag-${t.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:{margin:0,borderRadius:p.borders.borderRadiusSm},onClick:()=>f?.(!0),children:[(0,n.Y)(r3.A,{}),(0,n.Y)(tb.o.Text,{css:{marginLeft:p.spacing.xs},children:t.assessments.length})]})]})})})}),u&&t.children?.map((e,a)=>(0,n.Y)(iG,{node:e,expandedKeys:i,setExpandedKeys:o,selectedKey:r,traceStartTime:s,traceEndTime:l,onSelect:c,linesToRender:d.concat({shouldRender:a<(t.children?.length??0)-1,isActive:a<h})},e.key))]})},iV=e=>{let{node:t,selectedKey:r,leftOffset:o,width:s,onSelect:l,expandedKeys:c,setExpandedKeys:d}=e,{theme:u}=(0,a.wn)(),p=(0,i.useRef)(null),m=(0,i.useRef)(null),f=r===t.key?u.colors.actionDefaultBackgroundHover:"transparent",g=(t.children??[]).length>0,h=c.has(t.key);return(0,i.useLayoutEffect)(()=>{if(!p.current||!m.current)return;Math.max(p.current.offsetWidth,m.current.offsetWidth)<s-u.spacing.sm?(p.current.style.display="inline",m.current.style.display="none"):(p.current.style.display="none",m.current.style.display="inline")},[u.spacing.sm,s]),(0,n.Y)(iK,{span:t,children:(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:u.spacing.xs,paddingRight:u.spacing.sm,paddingTop:u.spacing.xs,paddingBottom:u.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:u.colors.actionDefaultBackgroundHover},":active":{backgroundColor:u.colors.actionDefaultBackgroundPress},zIndex:tR.NORMAL},onClick:()=>l?.(t),children:[g?(0,n.Y)(tT.$n,{size:"small","data-testid":`toggle-timeline-span-expanded-${t.key}`,css:{flexShrink:0,marginRight:u.spacing.xs},icon:h?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),onClick:e=>{e.stopPropagation();let r=new Set(c);h?r.delete(t.key):r.add(t.key),d(r)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,n.Y)("div",{css:{width:24,marginRight:u.spacing.xs}}),(0,n.Y)("div",{css:{width:o,flexShrink:0}}),(0,n.Y)("div",{css:{position:"relative",width:s,height:u.typography.lineHeightBase,backgroundColor:u.colors.blue600,borderRadius:u.borders.borderRadiusSm,flexShrink:0},children:(0,n.Y)(tb.o.Text,{children:(0,n.Y)("span",{ref:p,css:{marginLeft:u.spacing.xs,color:u.colors.white,display:"none"},children:t.title})})}),(0,n.FD)("div",{css:{flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[(0,n.Y)(tb.o.Text,{children:(0,n.Y)("span",{ref:m,css:{marginLeft:u.spacing.xs,color:u.colors.textPrimary},children:t.title})}),(0,n.Y)(tb.o.Text,{css:{marginLeft:u.spacing.xs},color:"secondary",children:tM(t.end-t.start)})]})]},t.key)})},iZ=e=>{let{nodes:t,selectedKey:r,onSelect:o,traceStartTime:s,traceEndTime:l,expandedKeys:c,setExpandedKeys:d}=e,{theme:u}=(0,a.wn)(),p=(0,i.useRef)(null),m=ty({ref:p})?.width??0,f=(0,i.useMemo)(()=>(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:60,i=t-e;if(i<=0||r<=0)return[];let o=Math.floor(r/n);if(o<1)return[];let a=i/o,s=Math.pow(10,Math.floor(Math.log10(a))),l=a/s,c=(l<=1?1:l<=2?2:l<=5?5:10)*s,d=t+2*c,u=Math.ceil(e/c)*c,p=[];for(let e=u;e<=d;e+=c)p.push(Number(e.toFixed(10)));return p})(s,l,m),[l,s,m]),g=Math.min(...f),h=(f[f.length-1]+f[f.length-2])/2,y=f.slice(0,-1),E=e=>(e-g)/(h-g)*m;return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",position:"relative",boxSizing:"border-box"},children:[(0,n.Y)("div",{ref:p,css:{display:"flex",width:"100%",flexDirection:"row",height:u.typography.lineHeightBase,paddingLeft:32,paddingRight:u.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:u.colors.backgroundPrimary,zIndex:tR.HIGH},children:(0,n.Y)("div",{"data-testid":"time-marker-area",css:{position:"relative"},children:y.map(e=>(0,n.Y)(tb.o.Text,{css:{position:"absolute",transform:"translateX(-50%)",left:E(e),whiteSpace:"nowrap"},children:tM(e)},e))})}),(0,n.Y)("div",{css:{flex:1,pointerEvents:"none",zIndex:tR.LOW},children:(0,n.Y)("div",{css:{position:"absolute",height:"100%",width:"100%"},children:y.map(e=>(0,n.Y)("div",{css:{position:"absolute",left:E(e)+32,borderRight:`1px solid ${u.colors.border}`,height:"100%"}},e))})}),t.map(e=>{let t=E(e.start),i=E(e.end)-t;return(0,n.Y)(iV,{selectedKey:r,onSelect:o,node:e,leftOffset:t,width:i,expandedKeys:c,setExpandedKeys:d},e.key)})]})},iJ=e=>{let{rootNodes:t,selectedNode:r,setSelectedNode:o,traceStartTime:s,traceEndTime:c,expandedKeys:d,setExpandedKeys:u,spanFilterState:p,setSpanFilterState:m,className:f}=e,{theme:g}=(0,a.wn)(),h=K(),y=er(),E=(0,i.useCallback)(e=>{O(h,y,{eventType:"component_click",eventEntity:{entityType:"component",entitySubType:"div",entityId:`shared.model-trace-explorer.${e.type}-span-click`},eventPayload:{interactionSubject:!0}})},[h,y]),v=(0,i.useCallback)(e=>{o?.(e),E?.(e)},[E,o]),{showTimelineTreeGantt:x,setShowTimelineTreeGantt:b}=tk(),T=(0,i.useMemo)(()=>((e,t)=>{let r=[],n=e=>{if(!e)return;r.push(e),t.has(e.key)&&e.children?.forEach(n)};return e.forEach(n),r})(t,d),[t,d]),_=(0,i.useMemo)(()=>(0,n.Y)("div",{css:{flex:1,overflow:"auto",minHeight:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column"},children:x?(0,n.Y)(iZ,{nodes:T,selectedKey:r?.key??"",onSelect:v,traceStartTime:s,traceEndTime:c,expandedKeys:d,setExpandedKeys:u}):t.map(e=>(0,n.Y)(iG,{node:e,expandedKeys:d,setExpandedKeys:u,selectedKey:r?.key??"",traceStartTime:s,traceEndTime:c,onSelect:v,linesToRender:[]},e.key))}),[x,T,r?.key,v,s,c,t,d,u]);return(0,n.Y)("div",{css:{height:"100%",borderRadius:g.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},className:f,children:(0,n.Y)("div",{css:{overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,n.Y)(ij,{showTimelineInfo:x,setShowTimelineInfo:b,spanFilterState:p,setSpanFilterState:m}),t.length>0?(0,n.Y)("div",{css:{flex:1,overflowY:"auto",display:"flex"},children:_}):(0,n.Y)("div",{css:{flex:1,display:"flex",justifyContent:"center",padding:g.spacing.md,paddingTop:g.spacing.lg},children:(0,n.Y)(l.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})},iq=e=>{let{modelTrace:t,className:r,selectedSpanId:o,onSelectSpan:s}=e,{theme:l}=(0,a.wn)(),c=(()=>{if(window.innerWidth<=768)return .33;return .25})(),d=(0,i.useRef)(null),[u,p]=(0,i.useState)(500),{rootNode:m,selectedNode:f,setSelectedNode:g,activeTab:h,setActiveTab:y}=tk(),{expandedKeys:E,setExpandedKeys:v}=tN({rootNodes:m?[m]:[],initialExpandDepth:tA}),{matchData:x,searchFilter:b,setSearchFilter:T,spanFilterState:_,setSpanFilterState:S,filteredTreeNodes:I,handleNextSearchMatch:A,handlePreviousSearchMatch:R}=(e=>{let{treeNode:t,selectedNode:r,setSelectedNode:n,setActiveTab:o,setExpandedKeys:a,modelTraceInfo:s}=e,[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(()=>(e=>{let t={};return e&&(0,G.compact)(tY([e]).map(e=>e.type)).forEach(e=>{t[e]=!0}),{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(t)),[p,m]=(0,i.useState)(0),{filteredTreeNodes:f,matches:g}=(0,i.useMemo)(()=>{if((0,G.isNil)(t))return{filteredTreeNodes:[],matches:[]};return function e(t,r,n){let i=r.toLowerCase().trim(),o=Object.values(n.spanTypeDisplayState).every(e=>e);if(""===i&&o)return{filteredTreeNodes:[t],matches:[]};let a=t.children??[],s=[],l=[];a.forEach(t=>{let{filteredTreeNodes:r,matches:o}=e(t,i,n);s.push(...r),l.push(...o)});let c=(t.title??"").toLowerCase(),d=((e,t)=>{if(!t)return[];let r=[],n={inputs:e?.inputs,outputs:e?.outputs,attributes:e?.attributes,events:e?.events};return(0,G.map)(n,(n,i)=>{if("events"===i)return void r.push(...((e,t)=>{let r=e.events;if(!r)return[];let n=[];return r.forEach((r,i)=>{let o=r.attributes;if(!o)return;Object.keys(o).forEach(a=>{let s=a.toLowerCase().includes(t),l=eQ(r.name,i,a);s&&n.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});let c=JSON.stringify(o[a]).toLowerCase().split(t).length-1;for(let t=0;t<c;t++)n.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})})}),n})(e,t));eq(n).forEach(n=>{n.key.toLowerCase().includes(t)&&r.push({span:e,section:i,key:n.key,isKeyMatch:!0,matchIndex:0});let o=n.value.toLowerCase().split(t).length-1;for(let t=0;t<o;t++)r.push({span:e,section:i,key:n.key,isKeyMatch:!1,matchIndex:t})})}),r})(t,i),u=d.length>0||c.includes(i),p=!t.type||n.spanTypeDisplayState[t.type],m=s.length>0,f=e1(t)>0;if(u&&p||n.showParents&&m||n.showExceptions&&f)return{filteredTreeNodes:[{...t,children:s}],matches:d.concat(l)};return{filteredTreeNodes:s,matches:l}}(t,l,d)},[t?.key,l,d,s]),h=(0,i.useMemo)(()=>tw(f),[f]),y=(0,i.useCallback)(e=>{if(e>=g.length||e<0)return;m(e);let t=g[e];n(t.span),o(tP(t));let r=((e,t)=>{let r=new Set,n=e;for(;n&&n.parentId;)r.add(n.parentId),n=t[n.parentId];return r})(t.span,h);a(e=>new Set([...e,...r]))},[g,n,o,h,a]),E=(0,i.useCallback)(()=>{y(p+1)},[p,y]),v=(0,i.useCallback)(()=>{y(p-1)},[p,y]);return(0,i.useLayoutEffect)(()=>{if(0===f.length)return;if(0===g.length){let e=r?.key??"";if(e in h)n(h[e]);else{let e=f[0];n(e),o(e?.chatMessages?"chat":"content")}return}m(0),n(g[0].span),o(tP(g[0]))},[f,g,n]),{matchData:{match:g[p]??null,totalMatches:g.length,currentMatchIndex:p},searchFilter:l.toLowerCase().trim(),setSearchFilter:c,spanFilterState:d,setSpanFilterState:u,filteredTreeNodes:f,handleNextSearchMatch:E,handlePreviousSearchMatch:v}})({treeNode:m,selectedNode:f,setSelectedNode:g,setActiveTab:y,setExpandedKeys:v,modelTraceInfo:t?.info});(0,i.useLayoutEffect)(()=>{v(new Set((0,G.values)(tw(I,tA)).map(e=>e.key)))},[I,v]);let Y=(0,i.useMemo)(()=>Math.max(275,16*Math.max(...I.map(tO))+7*l.spacing.lg),[I,l.spacing.lg]);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",flex:1,minHeight:0},className:r,children:[(0,n.Y)("div",{css:{padding:l.spacing.xs,borderBottom:`1px solid ${l.colors.border}`},children:(0,n.Y)(tI,{searchFilter:b,setSearchFilter:T,matchData:x,handleNextSearchMatch:A,handlePreviousSearchMatch:R})}),(0,n.Y)(tE,{ref:d,initialRatio:c,paneWidth:u,setPaneWidth:p,leftChild:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",flex:1,minWidth:Y},children:(0,n.Y)(iJ,{rootNodes:I,selectedNode:f,traceStartTime:m?.start??0,traceEndTime:m?.end??0,setSelectedNode:e=>{g(e),y(e?.chatMessages?"chat":"content"),(0,G.isString)(e?.key)&&s?.(e?.key)},css:{flex:1},expandedKeys:E,setExpandedKeys:v,spanFilterState:_,setSpanFilterState:S})}),leftMinWidth:Y,rightChild:(0,n.Y)(iO,{activeSpan:f,searchFilter:b,activeMatch:x.match,activeTab:h,setActiveTab:y}),rightMinWidth:500})]})};var iX=r(30331),iQ=r(31281);let i0=e=>{let{title:t,tools:r}=e,{theme:i}=(0,a.wn)();return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:i.spacing.sm,padding:i.spacing.sm,border:`1px solid ${i.colors.border}`,borderRadius:i.borders.borderRadiusSm},children:[t&&(0,n.Y)(tb.o.Text,{css:{marginLeft:i.spacing.xs},bold:!0,children:t}),r.map(e=>(0,n.Y)(rC,{tool:e},e.function.name))]})},i1=e=>{let{title:t,documents:r}=e,{theme:i}=(0,a.wn)();return(0,n.FD)("div",{css:{backgroundColor:i.colors.backgroundPrimary,borderRadius:i.borders.borderRadiusSm,border:`1px solid ${i.colors.border}`},children:[t&&(0,n.Y)("div",{css:{padding:`${i.spacing.xs}px ${i.spacing.sm}px`,borderBottom:`1px solid ${i.colors.border}`},children:(0,n.Y)(tb.o.Text,{bold:!0,children:t})}),r.map((e,t)=>(0,n.Y)("div",{css:{borderBottom:t!==r.length-1?`1px solid ${i.colors.border}`:""},children:(0,n.Y)(rG,{text:e.page_content,metadata:e.metadata},t)},t))]})},i2=e=>{let{title:t,value:r}=e,{theme:o}=(0,a.wn)(),[s,c]=(0,i.useState)(!1),d=r.length>400,u=!s&&r.length>400?r.slice(0,400)+"...":r,p=d?{":hover":{backgroundColor:o.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,n.FD)("div",{css:{border:`1px solid ${o.colors.border}`,borderRadius:o.borders.borderRadiusSm},children:[t&&(0,n.FD)("div",{role:"button",css:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${o.spacing.sm}px ${o.spacing.sm+o.spacing.xs}px`,...p},onClick:()=>c(!s),children:[(0,n.Y)(tb.o.Text,{bold:!0,children:t}),d&&(s?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}))]}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm,paddingLeft:o.spacing.sm+o.spacing.xs,paddingRight:o.spacing.sm+o.spacing.xs,paddingTop:t?0:o.spacing.sm,paddingBottom:o.spacing.sm,"& > div:last-of-type":{marginBottom:0}},children:[(0,n.Y)(ry,{children:u}),d&&(0,n.Y)(tb.o.Link,{onClick:()=>c(!s),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:s?(0,n.Y)(l.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,n.Y)(l.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},i3=e=>{let{title:t,data:r,renderMode:o}=e,a=(0,i.useMemo)(()=>{try{return JSON.parse(r)}catch(e){return r}},[r]),s=(0,G.isString)(a),l=tn(a),c=Array.isArray(a)&&a.length>0&&(0,G.every)(a,e6),d=Array.isArray(a)&&a.length>0&&(0,G.every)(a,eX);if("json"===o)return(0,n.Y)(rY,{title:t,data:r,initialRenderMode:ex.JSON});if("text"===o)return(0,n.Y)(rY,{title:t,data:r,initialRenderMode:ex.TEXT});if(s)return(0,n.Y)(i2,{title:t,value:a});if(l&&l.length>0)return(0,n.Y)(rU,{messages:l});if(c)return(0,n.Y)(i0,{title:t,tools:a});if(d)return(0,n.Y)(i1,{title:t,documents:a});return(0,n.Y)(rY,{title:t,data:r})},i5=e=>{let{node:t}=e,{theme:r}=(0,a.wn)(),i=e0(t),o=!t.parentId,s=i[0];if(!s)return null;return(0,n.Y)(rB,{css:{marginBottom:o?r.spacing.sm:0},withBorder:o,sectionKey:s.name,title:(0,n.FD)("div",{css:{display:"flex",alignItems:"center",gap:r.spacing.sm},children:[(0,n.Y)(r0.A,{color:"danger"}),(0,n.Y)(tb.o.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:r.spacing.sm,paddingBottom:r.spacing.sm,paddingLeft:o?0:r.spacing.lg},children:Object.entries(s.attributes??{}).map(e=>{let[t,r]=e;return(0,n.Y)(i3,{title:t,data:JSON.stringify(r,null,2),renderMode:"text"},t)})})},s.name)},i6=e=>{let{node:t,renderMode:r}=e,{theme:o}=(0,a.wn)(),[s,c]=(0,i.useState)(!1),d=(0,i.useMemo)(()=>eq(t.inputs),[t]),u=(0,i.useMemo)(()=>eq(t.outputs),[t]),p=e0(t).length>0,m=d.length>0,f=u.length>0,{setSelectedNode:g,setActiveView:h,setShowTimelineTreeGantt:y}=tk();return(0,n.FD)("div",{css:{display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},children:[(0,n.Y)("div",{css:{height:48,display:"flex",alignItems:"center"},children:(0,n.Y)(tT.$n,{size:"small","data-testid":`toggle-span-expanded-${t.key}`,css:{flexShrink:0,marginRight:o.spacing.xs},icon:s?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),onClick:()=>c(!s),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,n.Y)("div",{css:{position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${o.colors.border}`,width:12},children:(0,n.Y)("div",{css:{position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:o.borders.borderRadiusMd,borderBottom:`2px solid ${o.colors.border}`,borderLeft:`2px solid ${o.colors.border}`}})}),(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",flex:1,minWidth:0},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.Y)(tb.o.Text,{color:"secondary",css:{display:"inline-flex",alignItems:"center",height:48},children:(0,n.Y)(l.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,n.Y)(ig,{node:t})}})}),(0,n.Y)("span",{onClick:()=>{g(t),h("detail"),y(!0)},children:(0,n.Y)(tb.o.Text,{css:{"&:hover":{textDecoration:"underline",cursor:"pointer"}},color:"secondary",children:tM(t.end-t.start)})})]}),s&&(0,n.FD)("div",{children:[p&&(0,n.Y)(i5,{node:t}),m&&(0,n.Y)(rB,{sectionKey:"input",title:(0,n.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm,paddingLeft:o.spacing.lg,marginBottom:f?0:o.spacing.sm},children:d.map((e,t)=>{let{key:i,value:o}=e;return(0,n.Y)(i3,{title:i,data:o,renderMode:r},i||t)})})}),f&&(0,n.Y)(rB,{sectionKey:"output",title:(0,n.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm,paddingLeft:o.spacing.lg,marginBottom:o.spacing.sm},children:u.map(e=>{let{key:t,value:i}=e;return(0,n.Y)(i3,{title:t,data:i,renderMode:r},t)})})})]})]})]})},i4=e=>{let{rootNode:t,intermediateNodes:r}=e,{theme:o}=(0,a.wn)(),[s,c]=(0,i.useState)("default"),d=t.inputs,u=t.outputs,p=e0(t),m=r.length>0,f=p.length>0,g=eq(d),h=eq(u);return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:o.spacing.md,paddingTop:o.spacing.sm,overflow:"auto",minWidth:400},children:[(0,n.Y)("div",{css:{display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:o.spacing.sm},children:(0,n.FD)("div",{css:{display:"flex",gap:o.spacing.sm},children:[(0,n.FD)(rV.d,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:s,size:"small",onChange:e=>c(e.target.value),children:[(0,n.Y)(rV.E,{value:"default",children:(0,n.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,n.Y)(rV.E,{value:"json",children:(0,n.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,n.Y)(r5,{})]})}),f&&(0,n.Y)(i5,{node:t}),(0,n.Y)(rB,{withBorder:!0,title:(0,n.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:{marginBottom:m?0:o.spacing.md},sectionKey:"summary-inputs",children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm},children:g.map((e,t)=>{let{key:r,value:i}=e;return(0,n.Y)(i3,{title:r,data:i,renderMode:s},r||t)})})}),m&&r.map(e=>(0,n.Y)(i6,{node:e,renderMode:s},e.key)),(0,n.Y)(rB,{withBorder:!0,title:(0,n.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",gap:o.spacing.sm},children:h.map((e,t)=>{let{key:r,value:i}=e;return(0,n.Y)(i3,{title:r,data:i,renderMode:s},r||t)})})})]})},i7=e=>{if(!e.parentId)return!1;return[ey.AGENT,ey.RETRIEVER,ey.CHAT_MODEL,ey.TOOL,ey.LLM].includes(e.type??ey.UNKNOWN)||e1(e)>0},i9=e=>{let{modelTrace:t}=e,{theme:r}=(0,a.wn)(),[o,s]=(0,i.useState)(500),{rootNode:c,nodeMap:d,assessmentsPaneEnabled:u,assessmentsPaneExpanded:p}=tk(),m=(0,i.useMemo)(()=>Object.values(d).flatMap(e=>e.assessments),[d]),f=(0,i.useMemo)(()=>{if(!c)return[];return tY([c]).filter(i7)},[c]);if(!c)return(0,n.Y)("div",{css:{marginTop:r.spacing.lg},children:(0,n.Y)(tF.S,{description:(0,n.Y)(l.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});return u&&p?(0,n.Y)(tE,{initialRatio:.75,paneWidth:o,setPaneWidth:s,leftChild:(0,n.Y)(i4,{rootNode:c,intermediateNodes:f}),rightChild:(0,n.Y)(iC,{assessments:m,traceId:c.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:250}):(0,n.Y)(i4,{rootNode:c,intermediateNodes:f})},i8=e=>{let{modelTrace:t,className:r,selectedSpanId:i,onSelectSpan:o}=e,{theme:c}=(0,a.wn)(),d=(0,T.W)("databricks.fe.traceExplorer.enableSummaryView",!1),{activeView:u,setActiveView:p}=tk();if(!d)return(0,n.Y)("div",{css:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:(0,n.Y)(iq,{modelTrace:t,className:r,selectedSpanId:i,onSelectSpan:o})});return(0,n.FD)(s.Root,{componentId:"model-trace-explorer",value:u,onValueChange:e=>p(e),css:{"& > div:first-of-type":{marginBottom:0,flexShrink:0},display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[(0,n.FD)(s.List,{css:{paddingLeft:c.spacing.md,flexShrink:0},children:[(0,n.Y)(s.Trigger,{value:"summary",children:(0,n.Y)(l.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,n.Y)(s.Trigger,{value:"detail",children:(0,n.Y)(l.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,n.Y)(s.Content,{value:"summary",css:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:(0,n.Y)(i9,{modelTrace:t})}),(0,n.Y)(s.Content,{value:"detail",css:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:(0,n.Y)(iq,{modelTrace:t,className:r,selectedSpanId:i,onSelectSpan:o})})]})},oe=e=>{let{traceId:t,refetchContextValue:r,children:i}=e;return(0,n.Y)(n9.Provider,{value:r,children:(0,n.Y)(ea,{id:Z.MLFLOW_CONTEXT,tags:{tagTracesRequestId:t??""},children:i})})},ot=e=>{let{modelTrace:t,className:r,initialActiveView:o="summary",selectedSpanId:a,onSelectSpan:s}=e,[l,c]=(0,i.useState)(t),[d,u]=(0,i.useState)(!0),p=eG(t),{refetch:m}=(e=>{let{traceId:t,setModelTrace:r,setAssessmentsPaneEnabled:n}=e;return nQ({queryFn:()=>(e=>{let{traceId:t}=e;return n4(`/ajax-api/3.0/mlflow/traces/${t}`)})({traceId:t}),onSuccess:e=>{r(t=>({data:t.data,info:e?.trace?.trace_info??{}})),n(!0)},onError:()=>{n(!1)}})})({traceId:p,setModelTrace:c,setAssessmentsPaneEnabled:u}),f=(0,i.useMemo)(()=>({refetchTraceInfo:m}),[m]);return(0,i.useEffect)(()=>{c(t),m()},[p]),(0,n.Y)(oe,{traceId:p,refetchContextValue:f,children:(0,n.Y)(tL,{modelTrace:l,initialActiveView:o,selectedSpanIdOnRender:a,assessmentsPaneEnabled:d,children:(0,n.Y)(i8,{modelTrace:l,className:r,selectedSpanId:a,onSelectSpan:s})})})};ot.Skeleton=e=>{let{label:t}=e,{theme:r}=(0,a.wn)();return(0,n.FD)("div",{css:{display:"flex",height:"100%"},children:[(0,n.FD)("div",{css:{flex:1},children:[(0,n.Y)("div",{css:{padding:r.spacing.sm,borderBottom:`1px solid ${r.colors.border}`},children:(0,n.Y)(iX.o,{label:t})}),(0,n.FD)("div",{css:{borderRadius:r.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},children:[(0,n.Y)("div",{css:{flex:1,padding:r.spacing.sm,borderRight:`1px solid ${r.colors.border}`},children:(0,n.Y)(iQ.Q,{lines:5})}),(0,n.Y)("div",{css:{flex:2,padding:r.spacing.sm},children:(0,n.Y)(iQ.Q,{lines:5})})]})]}),(0,n.Y)("div",{css:{padding:r.spacing.md,overflowY:"auto",flex:1},children:(0,n.Y)(iQ.Q,{lines:12})})]})};var or=r(95649);function on(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}function oi(e){var t;return(t=function*(){try{let t=yield fetch(`/ajax-api/2.0/mlflow/get-trace-artifact?request_id=${e}`),r=yield t.text(),n=JSON.parse(r);if(n.spans)return{info:{request_id:e},data:n};if(n.error_code)return n.message;return"Unknown error occurred"}catch(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;return"Unknown error occurred"}},function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(e){on(o,n,i,a,s,"next",e)}function s(e){on(o,n,i,a,s,"throw",e)}a(void 0)})})()}function oo(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}let oa=()=>{let e=(0,i.useMemo)(()=>new URLSearchParams(window.location.search).getAll("trace_id"),[]),t=(0,i.useMemo)(()=>new URLSearchParams(window.location.search).getAll("experiment_id"),[]),[r,o]=(0,i.useState)(e.length>0?0:null),[s,c]=(0,i.useState)(null),[d,u]=(0,i.useState)(!0),[p,m]=(0,i.useState)(null),{theme:f}=(0,a.wn)();if((0,i.useEffect)(()=>{(()=>{var t;return(t=function*(){if(null===r)return;u(!0);let t=e[r],n=yield oi(t);"string"==typeof n?m(n):c(n),u(!1)},function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(e){oo(o,n,i,a,s,"next",e)}function s(e){oo(o,n,i,a,s,"throw",e)}a(void 0)})})()})()},[r,e]),0===e.length||null===r)return null;if(d)return(0,n.Y)("div",{css:{width:"calc(100% - 2px)"},children:(0,n.Y)(tb.o.Text,{color:"secondary",children:(0,n.Y)(l.sA,{id:"JJFZ1V",defaultMessage:"Fetching trace data..."})})});if(!s)return(0,n.Y)("div",{css:{paddingTop:f.spacing.md,width:"calc(100% - 2px)"},children:(0,n.Y)(tF.S,{image:(0,n.Y)(iy.A,{}),description:(0,n.FD)(n.FK,{children:[(0,n.Y)(tb.o.Paragraph,{children:(0,n.Y)(l.sA,{id:"UD4Z+e",defaultMessage:"An error occurred while attempting to fetch trace data (ID: {traceId}). Please ensure that the MLflow tracking server is running, and that the trace data exists. Error details:",values:{traceId:e[r]}})}),p&&(0,n.Y)(tb.o.Paragraph,{children:p})]}),title:(0,n.Y)(l.sA,{id:"md81Lo",defaultMessage:"Error"})})});return(0,n.FD)("div",{css:{display:"flex",flexDirection:"column",border:`1px solid ${f.colors.border}`,height:"calc(100% - 2px)"},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${f.spacing.xs}px ${f.spacing.md}px`},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",gap:f.spacing.sm},children:[(0,n.Y)(tb.o.Title,{level:4,withoutMargins:!0,children:"MLflow Trace UI"}),(0,n.Y)(iU.I,{componentId:"mlflow.notebook.trace-ui-info",iconTitle:"More information",maxWidth:400,content:(0,n.Y)(l.sA,{id:"LED2z5",defaultMessage:"To disable or enable this display, call {disableFunction} or {enableFunction} and re-run the cell",values:{disableFunction:(0,n.Y)("code",{children:"mlflow.tracing.disable_notebook_display()"}),enableFunction:(0,n.Y)("code",{children:"mlflow.tracing.enable_notebook_display()"})}})}),(0,n.Y)(tb.o.Link,{componentId:"mlflow.notebook.trace-ui-learn-more-link",href:"https://mlflow.org/docs/latest/llms/tracing/index.html?ref=jupyter-notebook-widget",openInNewTab:!0,title:"Learn More",children:(0,n.Y)(l.sA,{id:"uIY1qq",defaultMessage:"Learn More"})})]}),(0,n.Y)(tb.o.Link,{componentId:"mlflow.notebook.trace-ui-see-in-mlflow-link",href:((e,t)=>{let r=new URLSearchParams;return r.append("selectedTraceId",e),r.append("compareRunsMode","TRACES"),`/#/experiments/${t}?${r.toString()}`})(e[r],t[r]),openInNewTab:!0,title:"View in MLflow UI",children:(0,n.Y)(l.sA,{id:"4NyhOm",defaultMessage:"View in MLflow UI"})})]}),e.length>1&&(0,n.Y)(or.dK,{componentId:"mlflow.notebook.pagination",currentPageIndex:r+1,dangerouslySetAntdProps:{showQuickJumper:!0},numTotal:e.length,onChange:e=>o(e-1),pageSize:1,style:{marginBottom:f.spacing.sm,paddingLeft:f.spacing.sm,paddingRight:f.spacing.sm}}),(0,n.Y)("div",{css:{flex:1,overflow:"hidden"},children:(0,n.Y)(ot,{modelTrace:s,initialActiveView:"detail"})})]})};var os=r(31602),ol=function(e){return e[e.FORM_FEEDBACK=0]="FORM_FEEDBACK",e[e.FORM_ERROR_REPORT=1]="FORM_ERROR_REPORT",e[e.METADATA=2]="METADATA",e}({});let oc=(0,ep.fH)("Feedback::OpenDrawer");function od(e){let{"aria-describedby":t,debugRpc:r,mode:o=ol.FORM_FEEDBACK,...a}=e;if(!(e=>{let t=e||oc,[r,n]=(0,i.useState)(t.isAvailable());return(0,i.useEffect)(()=>{let e;if(r)return;t.isAvailable()&&n(!0);let i=500,o=()=>{t.isAvailable()?n(!0):((i*=2)>5e3&&(i=5e3),e=setTimeout(o,i))};return e=setTimeout(o,i),()=>clearTimeout(e)},[r,t]),r})(r))return null;return(0,n.Y)(tT.$n,{componentId:"codegen_web-shared_src_fastfeedback_components_feedbacklink.tsx_54","aria-describedby":t,type:"link",icon:(0,n.Y)(os.A,{}),onClick:()=>{(r||oc).call({...a,mode:o})},children:o===ol.FORM_ERROR_REPORT?(0,n.Y)(l.sA,{id:"URIk/E",defaultMessage:"Report error"}):(0,n.Y)(l.sA,{id:"W96Xb9",defaultMessage:"Send feedback"})})}var ou=function(e){return e.Ready="READY",e.LogError="LOG_ERROR",e.LogEvent="LOG_EVENT",e}({}),op=function(e){return e.UpdateTrace="UPDATE_TRACE",e}({});let om=JSON.parse('{"2":{"path":"/static/lib/ml-model-trace-renderer/2/index.html","commit":"93d4afc7a2e876f74cbba56c2db3d05edc91e872"},"3":{"path":"/static/lib/ml-model-trace-renderer/3/index.html","commit":"93d4afc7a2e876f74cbba56c2db3d05edc91e872"},"current":{"path":"/static/lib/ml-model-trace-renderer/index.html"},"oss":{"path":"/static/lib/ml-model-trace-renderer/oss/index.html","commit":"b5595f5c6263c1c8e3614d85eb1d233d28789bb9"}}'),of=e=>{let{modelTrace:t,height:r=700,useLatestVersion:s=!1}=e,l=(0,i.useRef)(null),[c,d]=o().useState(!0),[u,f]=o().useState(!0),g=s?"current":(e=>{if(ej(e?.info))return eZ(e?.info?.trace_metadata)??"2";let t=eZ(e?.info?.request_metadata);if(t)return t;return eZ(e?.info?.tags)??"2"})(t),h=om[g]?.path??om["2"].path,y=K(),E=er(),{startInteraction:v}=ei(),{theme:x}=(0,a.wn)(),b=j({recordEvent:y,recordProto:E,startInteraction:v});return(0,i.useEffect)(()=>{let e=e=>{let t=l.current?.contentWindow;if(!t||e.source!==t)return;switch(e.data.type){case ou.Ready:d(!1);break;case ou.LogError:{let{error:t}=e.data||{};p.iT.sev2(m.Es.MlExperiments,"ModelTraceExplorerFrameRenderer/Error",t);break}case ou.LogEvent:{let t=e.data.payload.eventDefaultPrevented;b({...e.data.payload,skip:t})}}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[b]),(0,i.useEffect)(()=>{let e=l.current?.contentWindow;if(!e||c)return;e.postMessage({type:op.UpdateTrace,traceData:t})},[t,c]),(0,n.FD)("div",{css:{height:u?r:36,borderTop:`1px solid ${x.colors.border}`},children:[(0,n.FD)("div",{css:{display:"flex",height:36,justifyContent:"space-between",padding:x.spacing.sm},children:[(0,n.FD)("div",{css:{display:"flex",alignItems:"center",gap:x.spacing.sm},children:[(0,n.Y)(tT.$n,{componentId:`mlflow.notebook.trace-ui-${u?"collapse":"expand"}`,icon:u?(0,n.Y)(tS.A,{}):(0,n.Y)(rN.A,{}),size:"small",onClick:()=>f(!u)}),(0,n.Y)(tb.o.Title,{level:4,withoutMargins:!0,children:"MLflow Trace UI"}),(0,n.Y)(tb.o.Link,{componentId:"mlflow.notebook.trace-ui-learn-more-link",href:"https://mlflow.org/docs/latest/llms/tracing/index.html",openInNewTab:!0,title:"Learn More",children:"Learn More"})]}),(0,n.Y)(od,{parentUi:m.Es.MlFlowOSS,origin:"mlflow-notebook-trace-ui"})]}),c&&(0,n.Y)("div",{css:{position:"absolute",width:"100%",height:r},children:(0,n.Y)(ot.Skeleton,{label:"Frame Skeleton"})}),(0,n.Y)("iframe",{title:"Model Trace Explorer",src:h,ref:l,css:{border:"none",width:"100%",height:"calc(100% - 36px)",display:u?"block":"none"}})]})},og=(0,i.createContext)({onSelectRow:()=>{}}),oh=()=>(0,i.useContext)(og),oy=e=>{let{children:t}=e,[r,o]=(0,i.useState)(null),s=(e=>{if((0,G.isNil)(e))return null;if(eJ(e))return e;try{let t=e.spans?.map(e=>({...e,attributes:JSON.parse(e.attributes)}));if((0,G.isNil)(t))return null;return{data:{spans:t},info:{}}}catch(e){return null}})(r),{theme:l}=(0,a.wn)();return(0,n.FD)(og.Provider,{value:{onSelectRow:o},children:[t,!(0,G.isNil)(s)&&(0,n.Y)("div",{css:{borderTop:`1px solid ${l.colors.border}`},children:(0,n.Y)(of,{modelTrace:s})})]})}}}]);
//# sourceMappingURL=https://sourcemaps.dev.databricks.com/ml-model-trace-renderer/js/560.40831c7f.chunk.js.map