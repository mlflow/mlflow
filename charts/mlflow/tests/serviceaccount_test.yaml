suite: Test service account

templates:
  - serviceaccount.yaml

release:
  name: mlflow

tests:
  - it: Should not render service account if serviceAccount.create is false
    set:
      serviceAccount:
        create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: Should render service account if serviceAccount.create is true
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: ServiceAccount
          name: mlflow

  - it: Should use the given name if set
    set:
      serviceAccount:
        name: my-service-account
    asserts:
      - containsDocument:
          apiVersion: v1
          kind: ServiceAccount
          name: my-service-account

  - it: Should add annotations to the service account if set
    set:
      serviceAccount:
        annotations:
          key1: value1
          key2: value2
    asserts:
      - equal:
          path: metadata.annotations.key1
          value: value1
      - equal:
          path: metadata.annotations.key2
          value: value2
